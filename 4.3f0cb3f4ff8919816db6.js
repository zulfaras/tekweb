(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{RKBc:function(t,e,n){var r,i;void 0===(i="function"==typeof(r=function(){"use strict";function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){s(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,o=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(t,o,s){var a=i.URL||i.webkitURL,u=document.createElement("a");u.download=o=o||t.name||"download",u.rel="noopener","string"==typeof t?(u.href=t,u.origin===location.origin?r(u):n(u.href)?e(t,o,s):r(u,u.target="_blank")):(u.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,i,o){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,o),i);else if(n(t))e(t,i,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){r(s)})}}:function(t,n,r,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var a="application/octet-stream"===t.type,u=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&u||o)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var t=h.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},h.readAsDataURL(t)}else{var l=i.URL||i.webkitURL,f=l.createObjectURL(t);s?s.location=f:location.href=f,s=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}});i.saveAs=s.saveAs=s,t.exports=s})?r.apply(e,[]):r)||(t.exports=i)},jkDv:function(t,e,n){"use strict";n.r(e),n.d(e,"AdminModule",function(){return Lp});var r=n("ofXK"),i=n("fXoL"),o=n("H+bZ"),s=n("tyNb"),a=n("/t3+"),u=n("bTqV"),c=n("NFeN"),h=n("XhcP"),l=n("MutI"),f=n("FKr1");let d=(()=>{class t{constructor(t,e){this.api=t,this.router=e,this.mode="side"}ngOnInit(){}chockLogin(){this.api.get("books/status").subscribe(t=>{},t=>{this.router.navigate(["/login"])})}logout(){this.loading=!0,confirm("keluar aplikasi?")&&(localStorage.removeItem("appToken"),this.router.navigate(["/login"]))}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(o.a),i.Ob(s.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-admin"]],decls:35,vars:9,consts:[["color","primary",1,"example-header"],["mat-icon-button","",3,"click"],[1,"uk-width-expand"],["mat-button","",3,"click"],[1,"admin-container"],["mode","side",1,"sidenav-left",3,"position","opened","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],["routerLink","/admin/dashboard"],["matListIcon",""],["matLine",""],["routerLink","/admin/product"],["routerLink","/admin/pinjam"],["mode","side",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-color","#ccc"]],template:function(t,e){if(1&t){const t=i.Vb();i.Sb(0),i.Ub(1,"mat-toolbar",0),i.Ub(2,"button",1),i.bc("click",function(){return i.rc(t),i.pc(14).toggle()}),i.Ub(3,"mat-icon"),i.yc(4,"menu"),i.Tb(),i.Tb(),i.Ub(5,"span"),i.yc(6,"My Anggular"),i.Tb(),i.Pb(7,"div",2),i.Ub(8,"small"),i.yc(9,"Admin"),i.Tb(),i.Ub(10,"button",3),i.bc("click",function(){return e.logout()}),i.yc(11,"logout"),i.Tb(),i.Tb(),i.Ub(12,"mat-sidenav-container",4),i.Ub(13,"mat-sidenav",5,6),i.Ub(15,"mat-nav-list"),i.Ub(16,"mat-list-item",7),i.Ub(17,"mat-icon",8),i.yc(18,"dashboard"),i.Tb(),i.Ub(19,"h3",9),i.yc(20,"Dashboard"),i.Tb(),i.Tb(),i.Ub(21,"mat-list-item",10),i.Ub(22,"mat-icon",8),i.yc(23,"book"),i.Tb(),i.Ub(24,"h3",9),i.yc(25,"Daftar Buku"),i.Tb(),i.Tb(),i.Ub(26,"mat-list-item",11),i.Ub(27,"mat-icon",8),i.yc(28,"ballot"),i.Tb(),i.Ub(29,"h3",9),i.yc(30,"Daftar pinjam"),i.Tb(),i.Tb(),i.Tb(),i.Tb(),i.Pb(31,"mat-sidenav",12,6),i.Ub(33,"mat-sidenav-content",13),i.Pb(34,"router-outlet"),i.Tb(),i.Tb(),i.Rb()}2&t&&(i.Db(13),i.kc("position","start")("opened",!1)("fixedInViewport",!0)("fixedTopGap",65)("fixedBottomGap",0),i.Db(18),i.kc("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0))},directives:[a.a,u.a,c.a,h.b,h.a,l.d,l.b,s.b,l.a,f.j,h.c,s.e],styles:[""]}),t})();var p=n("o8Ft"),y=n("w55g"),g=n("RKBc"),m=n("0IaG");let v=(()=>{class t{constructor(t,e,n){this.api=t,this.dialogRef=e,this.dialogData=n}ngOnInit(){console.log(this.dialogData)}onFileChange(t){t.target.files.length>0&&(this.selectedFile=t.target.files[0],console.log(this.selectedFile))}uploadFile(){let t=new FormData;t.append("file",this.selectedFile),this.loadingUpload=!0,this.api.upload(t).subscribe(t=>{this.updateProduct(t),console.log(t)},t=>{this.loadingUpload=!1,alert("Gagal mengunggah file")})}updateProduct(t){1==t.status?(this.updateBook(t),alert("File berhasil diunggah"),this.loadingUpload=!1,this.dialogRef.close()):alert(t.message)}updateBook(t){this.api.put("books/"+this.dialogData.id,{url:t.url}).subscribe(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(o.a),i.Ob(m.g),i.Ob(m.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-file-uploader"]],decls:13,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"uk-flex","uk-flex-middle","uk-flex-center",2,"height","100px","outline","2px dashed #ccc","margin","10px",3,"click"],["type","file","id","file",2,"display","none",3,"change"],["fileInput",""],["mat-dialog-action","","align","right"],["mat-button","","mat-dialog-close","",2,"margin-right","5px"],["mat-flat-button","","color","primary",3,"disabled","click"]],template:function(t,e){if(1&t){const t=i.Vb();i.Ub(0,"h1",0),i.yc(1,"Unggah File"),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"div",2),i.bc("click",function(){return i.rc(t),i.pc(7).click()}),i.Ub(4,"span"),i.yc(5),i.Tb(),i.Tb(),i.Ub(6,"input",3,4),i.bc("change",function(t){return e.onFileChange(t)}),i.Tb(),i.Tb(),i.Ub(8,"div",5),i.Ub(9,"button",6),i.yc(10,"Cancel"),i.Tb(),i.Ub(11,"button",7),i.bc("click",function(){return e.uploadFile()}),i.yc(12),i.Tb(),i.Tb()}2&t&&(i.Db(5),i.zc(e.selectedFile?e.selectedFile.name:"Pilih File"),i.Db(6),i.kc("disabled",e.loadingUpload),i.Db(1),i.zc(e.loadingUpload?"uploading...":"Upload"))},directives:[m.h,m.e,u.a,m.d],styles:[""]}),t})();var b=n("D0XW"),w=n("HDdC"),T=n("Cfvw"),I=n("LRne"),E=n("JX91"),O=n("Zy1z"),_=n("lJxs"),S=n("Kqap"),D=n("/uUt"),k=n("pLZG"),N=n("pxpQ"),A=n("jmUF"),x=n("Jgta"),j=n("zIRd"),C=n("qOnz"),R=n("q/0M"),P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function U(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var L,M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},F=F||{},V=M||self;function q(){}function B(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function K(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var G="closure_uid_"+(1e9*Math.random()>>>0),z=0;function Q(t,e,n){return t.call.apply(t.bind,arguments)}function H(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function W(t,e,n){return(W=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Q:H).apply(null,arguments)}function Y(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function X(){return Date.now()}function $(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Pb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function J(){this.j=this.j,this.i=this.i}J.prototype.j=!1,J.prototype.ka=function(){!this.j&&(this.j=!0,this.H(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,G)&&t[G]||(t[G]=++z)}(this)},J.prototype.H=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},tt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function et(t){return Array.prototype.concat.apply([],arguments)}function nt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function rt(t){return/^[\s\xa0]*$/.test(t)}var it,ot=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function st(t,e){return-1!=t.indexOf(e)}function at(t,e){return t<e?-1:t>e?1:0}t:{var ut=V.navigator;if(ut){var ct=ut.userAgent;if(ct){it=ct;break t}}it=""}function ht(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function lt(t){var e={};for(var n in t)e[n]=t[n];return e}var ft="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function dt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ft.length;o++)n=ft[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function pt(t){return pt[" "](t),t}pt[" "]=q;var yt,gt,mt=st(it,"Opera"),vt=st(it,"Trident")||st(it,"MSIE"),bt=st(it,"Edge"),wt=bt||vt,Tt=st(it,"Gecko")&&!(st(it.toLowerCase(),"webkit")&&!st(it,"Edge"))&&!(st(it,"Trident")||st(it,"MSIE"))&&!st(it,"Edge"),It=st(it.toLowerCase(),"webkit")&&!st(it,"Edge");function Et(){var t=V.document;return t?t.documentMode:void 0}t:{var Ot="",_t=(gt=it,Tt?/rv:([^\);]+)(\)|;)/.exec(gt):bt?/Edge\/([\d\.]+)/.exec(gt):vt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(gt):It?/WebKit\/(\S+)/.exec(gt):mt?/(?:Version)[ \/]?(\S+)/.exec(gt):void 0);if(_t&&(Ot=_t?_t[1]:""),vt){var St=Et();if(null!=St&&St>parseFloat(Ot)){yt=String(St);break t}}yt=Ot}var Dt={};function kt(t){return function(t,e){var n=Dt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=ot(String(yt)).split("."),r=ot(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=at(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||at(0==s[2].length,0==a[2].length)||at(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var Nt=V.document&&vt&&(Et()||parseInt(yt,10))||void 0,At=!vt||9<=Number(Nt),xt=vt&&!kt("9"),jt=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{V.addEventListener("test",q,e),V.removeEventListener("test",q,e)}catch(n){}return t}();function Ct(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Rt(t,e){if(Ct.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Tt){t:{try{pt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Pt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Ct.prototype.b=function(){this.defaultPrevented=!0},$(Rt,Ct);var Pt={2:"touch",3:"pen",4:"mouse"};Rt.prototype.b=function(){Rt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,xt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Ut="closure_listenable_"+(1e6*Math.random()|0),Lt=0;function Mt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Lt,this.Y=this.Z=!1}function Ft(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Vt(t){this.src=t,this.a={},this.b=0}function qt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Z(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ft(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Bt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Vt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Bt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Mt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Kt="closure_lm_"+(1e6*Math.random()|0),Gt={};function zt(t,e,n,r,i){if(r&&r.once)return Ht(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)zt(t,e[o],n,r,i);return null}return n=ee(n),t&&t[Ut]?t.wa(e,n,K(r)?!!r.capture:!!r,i):Qt(t,e,n,!1,r,i)}function Qt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=K(i)?!!i.capture:!!i;if(s&&!At)return null;var a=Zt(t);if(a||(t[Kt]=a=new Vt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Jt,e=At?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)jt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Xt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ht(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ht(t,e[o],n,r,i);return null}return n=ee(n),t&&t[Ut]?t.xa(e,n,K(r)?!!r.capture:!!r,i):Qt(t,e,n,!0,r,i)}function Wt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Wt(t,e[o],n,r,i);else r=K(r)?!!r.capture:!!r,n=ee(n),t&&t[Ut]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=Bt(o=t.a[e],n,r,i))&&(Ft(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Zt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Bt(e,n,r,i)),(n=-1<t?e[t]:null)&&Yt(n))}function Yt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Ut])qt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Xt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Zt(e))?(qt(n,t),0==n.b&&(n.src=null,e[Kt]=null)):Ft(t)}}}function Xt(t){return t in Gt?Gt[t]:Gt[t]="on"+t}function $t(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Yt(t),n.call(r,e)}function Jt(t,e){if(t.Y)return!0;if(!At){if(!e)t:{e=["window","event"];for(var n=V,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return $t(t,e=new Rt(e,this))}return $t(t,new Rt(e,this))}function Zt(t){return(t=t[Kt])instanceof Vt?t:null}var te="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(t){return"function"==typeof t?t:(t[te]||(t[te]=function(e){return t.handleEvent(e)}),t[te])}function ne(){J.call(this),this.c=new Vt(this),this.J=this,this.D=null}function re(t,e){var n,r=t.D;if(r)for(n=[];r;r=r.D)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Ct(e,t);else if(e instanceof Ct)e.target=e.target||t;else{var i=e;dt(e=new Ct(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=ie(s,r,!0,e)&&i}if(i=ie(s=e.a=t,r,!0,e)&&i,i=ie(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=ie(s=e.a=n[o],r,!1,e)&&i}function ie(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&qt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}$(ne,J),ne.prototype[Ut]=!0,(L=ne.prototype).addEventListener=function(t,e,n,r){zt(this,t,e,n,r)},L.removeEventListener=function(t,e,n,r){Wt(this,t,e,n,r)},L.H=function(){if(ne.X.H.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ft(n[r]);delete e.a[t],e.b--}}this.D=null},L.wa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},L.xa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var oe=V.JSON.stringify;function se(){this.b=this.a=null}var ae,ue=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new he},function(t){t.reset()});function ce(){var t=pe,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function he(){this.next=this.b=this.a=null}function le(t){V.setTimeout(function(){throw t},0)}function fe(t,e){ae||function(){var t=V.Promise.resolve(void 0);ae=function(){t.then(ye)}}(),de||(ae(),de=!0),pe.add(t,e)}se.prototype.add=function(t,e){var n=ue.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},he.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},he.prototype.reset=function(){this.next=this.b=this.a=null};var de=!1,pe=new se;function ye(){for(var t;t=ce();){try{t.a.call(t.b)}catch(n){le(n)}var e=ue;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}de=!1}function ge(t,e){ne.call(this),this.b=t||1,this.a=e||V,this.f=W(this.eb,this),this.g=X()}function me(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ve(t,e,n){if("function"==typeof t)n&&(t=W(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=W(t.handleEvent,t)}return 2147483647<Number(e)?-1:V.setTimeout(t,e||0)}function be(t){t.a=ve(function(){t.a=null,t.c&&(t.c=!1,be(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}$(ge,ne),(L=ge.prototype).aa=!1,L.M=null,L.eb=function(){if(this.aa){var t=X()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),re(this,"tick"),this.aa&&(me(this),this.start()))}},L.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=X())},L.H=function(){ge.X.H.call(this),me(this),delete this.a};var we=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:be(this)},e.prototype.H=function(){t.prototype.H.call(this),this.a&&(V.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(J);function Te(t){J.call(this),this.b=t,this.a={}}$(Te,J);var Ie=[];function Ee(t,e,n,r){Array.isArray(n)||(n&&(Ie[0]=n.toString()),n=Ie);for(var i=0;i<n.length;i++){var o=zt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Oe(t){ht(t.a,function(t,e){this.a.hasOwnProperty(e)&&Yt(t)},t),t.a={}}function _e(){this.a=!0}function Se(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return oe(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}Te.prototype.H=function(){Te.X.H.call(this),Oe(this)},Te.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},_e.prototype.info=function(){};var De={},ke=null;function Ne(){return ke=ke||new ne}function Ae(t){Ct.call(this,De.Ga,t)}function xe(t){var e=Ne();re(e,new Ae(e,t))}function je(t,e){Ct.call(this,De.STAT_EVENT,t),this.stat=e}function Ce(t){var e=Ne();re(e,new je(e,t))}function Re(t){Ct.call(this,De.Ha,t)}function Pe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){t()},e)}De.Ga="serverreachability",$(Ae,Ct),De.STAT_EVENT="statevent",$(je,Ct),De.Ha="timingevent",$(Re,Ct);var Ue={NO_ERROR:0,fb:1,sb:2,rb:3,mb:4,qb:5,tb:6,Ea:7,TIMEOUT:8,wb:9},Le={kb:"complete",Gb:"success",Fa:"error",Ea:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",nb:"downloadprogress",Ob:"uploadprogress"};function Me(){}function Fe(){}Me.prototype.b=null;var Ve,qe={OPEN:"a",jb:"b",Fa:"c",vb:"d"};function Be(){Ct.call(this,"d")}function Ke(){Ct.call(this,"c")}function Ge(){}function ze(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Te(this),this.P=Qe,this.R=new ge(t=wt?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}$(Be,Ct),$(Ke,Ct),$(Ge,Me),Ge.prototype.a=function(){return new XMLHttpRequest},Ge.prototype.c=function(){return{}},Ve=new Ge;var Qe=45e3,He={},We={};function Ye(t,e,n){t.G=1,t.i=vn(fn(e)),t.j=n,t.I=!0,Xe(t,null)}function Xe(t,e){t.u=X(),Ze(t),t.l=fn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),xn(n.b,"t",r),t.D=0,t.a=_r(t.g,t.g.C?e:null),0<t.O&&(t.F=new we(W(t.Da,t,t.a),t.O)),Ee(t.J,t.a,"readystatechange",t.bb),e=t.B?lt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),xe(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function $e(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Je(t,n);if(i==We){4==e&&(t.h=4,Ce(14),r=!1),Se(t.c,t.f,null,"[Incomplete Response]");break}if(i==He){t.h=4,Ce(15),Se(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}Se(t.c,t.f,i,null),on(t,i)}4==e&&0==n.length&&(t.h=1,Ce(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),mr(e),e.F=!0,Ce(11))):(Se(t.c,t.f,n,"[Invalid Chunked Response]"),rn(t),nn(t))}function Je(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?We:(n=Number(e.substring(n,r)),isNaN(n)?He:(r+=1)+n>e.length?We:(e=e.substr(r,n),t.D=r+n,e))}function Ze(t){t.T=X()+t.P,tn(t,t.P)}function tn(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Pe(W(t.$a,t),e)}function en(t){t.o&&(V.clearTimeout(t.o),t.o=null)}function nn(t){0==t.g.v||t.A||wr(t.g,t)}function rn(t){en(t);var e=t.F;e&&"function"==typeof e.ka&&e.ka(),t.F=null,me(t.R),Oe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ka())}function on(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Mn(n.b,t)))if(n.I=t.N,!t.C&&Mn(n.b,t)&&3==n.v){try{var r=n.la.a.parse(e)}catch(Nd){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;br(n),ur(n)}gr(n),Ce(18)}}else n.pa=i[1],0<n.pa-n.P&&37500>i[2]&&n.G&&0==n.o&&!n.m&&(n.m=Pe(W(n.Xa,n),6e3));if(1>=Ln(n.b)&&n.fa){try{n.fa()}catch(Nd){}n.fa=void 0}}else Ir(n,11)}else if((t.C||n.a==t)&&br(n),!rt(e))for(e=r=n.la.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ha=i[2];var o=i[3];null!=o&&(n.ia=o,n.c.info("VER="+n.ia));var s=i[4];null!=s&&(n.qa=s,n.c.info("SVER="+n.qa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(st(h,"spdy")||st(h,"quic")||st(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(Fn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.oa=f,mn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ua(),n.U&&(n.N=X()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).ma=Or(u,u.C?u.ha:null,u.ga),d.C){Vn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(en(p),Ze(p)),u.a=d}else yr(u);0<n.g.length&&lr(n)}else"stop"!=i[0]&&"close"!=i[0]||Ir(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Ir(n,7):ar(n):"noop"!=i[0]&&n.f&&n.f.ta(i),n.o=0);xe(4)}catch(Nd){}}function sn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(B(t)||"string"==typeof t)tt(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(B(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(B(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function an(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof an)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function un(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];cn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)cn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function cn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(L=ze.prototype).setTimeout=function(t){this.P=t},L.bb=function(t){t=t.target;var e=this.F;e&&3==rr(t)?e.f():this.Da(t)},L.Da=function(t){try{if(t==this.a)t:{var e=rr(this.a),n=this.a.va(),r=this.a.W();if(!(3>e||3==e&&!wt&&!this.a.$())){this.A||4!=e||7==n||xe(8==n||0>=r?3:2),en(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!rt(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,Ce(12),rn(this),nn(this);break t}Se(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,on(this,u)}this.I?($e(this,e,o),wt&&this.b&&3==e&&(Ee(this.J,this.R,"tick",this.ab),this.R.start())):(Se(this.c,this.f,o,null),on(this,o)),4==e&&rn(this),this.b&&!this.A&&(4==e?wr(this.g,this):(this.b=!1,Ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Ce(12)):(this.h=0,Ce(13)),rn(this),nn(this)}}}catch(c){}},L.ab=function(){if(this.a){var t=rr(this.a),e=this.a.$();this.D<e.length&&(en(this),$e(this,t,e),this.b&&4!=t&&Ze(this))}},L.cancel=function(){this.A=!0,rn(this)},L.$a=function(){this.o=null;var t=X();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.G&&(xe(3),Ce(17)),rn(this),this.h=2,nn(this)):tn(this,this.T-t)},(L=an.prototype).K=function(){un(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},L.L=function(){return un(this),this.a.concat()},L.get=function(t,e){return cn(this.b,t)?this.b[t]:e},L.set=function(t,e){cn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},L.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var hn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ln(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ln){this.a=void 0!==e?e:t.a,dn(this,t.f),this.j=t.j,pn(this,t.c),yn(this,t.h),this.g=t.g,e=t.b;var n=new Dn;n.c=e.c,e.a&&(n.a=new an(e.a),n.b=e.b),gn(this,n),this.i=t.i}else t&&(n=String(t).match(hn))?(this.a=!!e,dn(this,n[1]||"",!0),this.j=bn(n[2]||""),pn(this,n[3]||"",!0),yn(this,n[4]),this.g=bn(n[5]||"",!0),gn(this,n[6]||"",!0),this.i=bn(n[7]||"")):(this.a=!!e,this.b=new Dn(null,this.a))}function fn(t){return new ln(t)}function dn(t,e,n){t.f=n?bn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function pn(t,e,n){t.c=n?bn(e,!0):e}function yn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function gn(t,e,n){e instanceof Dn?(t.b=e,function(t,e){e&&!t.f&&(kn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Nn(this,e),xn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=wn(e,_n)),t.b=new Dn(e,t.a))}function mn(t,e,n){t.b.set(e,n)}function vn(t){return mn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^X()).toString(36)),t}function bn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function wn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ln.prototype.toString=function(){var t=[],e=this.f;e&&t.push(wn(e,In,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(wn(e,In,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(wn(n,"/"==n.charAt(0)?On:En,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",wn(n,Sn)),t.join("")};var In=/[#\/\?@]/g,En=/[#\?:]/g,On=/[#\?]/g,_n=/[#\?@]/g,Sn=/#/g;function Dn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function kn(t){t.a||(t.a=new an,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Nn(t,e){kn(t),e=jn(t,e),cn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,cn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&un(t)))}function An(t,e){return kn(t),e=jn(t,e),cn(t.a.b,e)}function xn(t,e,n){Nn(t,e),0<n.length&&(t.c=null,t.a.set(jn(t,e),nt(n)),t.b+=n.length)}function jn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(L=Dn.prototype).add=function(t,e){kn(this),this.c=null,t=jn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},L.forEach=function(t,e){kn(this),this.a.forEach(function(n,r){tt(n,function(n){t.call(e,n,r,this)},this)},this)},L.L=function(){kn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},L.K=function(t){kn(this);var e=[];if("string"==typeof t)An(this,t)&&(e=et(e,this.a.get(jn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=et(e,t[n])}return e},L.set=function(t,e){return kn(this),this.c=null,An(this,t=jn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},L.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},L.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Cn=function(){return function(t,e){this.b=t,this.a=e}}();function Rn(t){this.g=t||Pn,t=V.PerformanceNavigationTiming?0<(t=V.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(V.ja&&V.ja.za&&V.ja.za()&&V.ja.za().Qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Pn=10;function Un(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Ln(t){return t.b?1:t.a?t.a.size:0}function Mn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function Fn(t,e){t.a?t.a.add(e):t.b=e}function Vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function qn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=U(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return nt(t.c)}function Bn(){}function Kn(){this.a=new Bn}function Gn(t,e,n){var r=n||"";try{sn(t,function(t,n){var i=t;K(t)&&(i=oe(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Zd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Zd}}function zn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}Rn.prototype.cancel=function(){var t,e;if(this.c=qn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=U(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Bn.prototype.stringify=function(t){return V.JSON.stringify(t,void 0)},Bn.prototype.parse=function(t){return V.JSON.parse(t,void 0)};var Qn=V.JSON.parse;function Hn(t){ne.call(this),this.headers=new an,this.l=t||null,this.b=!1,this.u=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.m=this.A=!1,this.s=0,this.o=null,this.I=Wn,this.F=this.G=!1}$(Hn,ne);var Wn="",Yn=/^https?$/i,Xn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function Jn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Zn(t),er(t)}function Zn(t){t.A||(t.A=!0,re(t,"complete"),re(t,"error"))}function tr(t){if(t.b&&void 0!==F&&(!t.u[1]||4!=rr(t)||2!=t.W()))if(t.m&&4==rr(t))ve(t.Aa,0,t);else if(re(t,"readystatechange"),4==rr(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.C).match(hn)[1]||null;if(!o&&V.self&&V.self.location){var s=V.self.location.protocol;o=s.substr(0,s.length-1)}i=!Yn.test(o?o.toLowerCase():"")}e=i}if(e)re(t,"complete"),re(t,"success");else{t.h=6;try{var a=2<rr(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Zn(t)}}finally{er(t)}}}function er(t,e){if(t.a){nr(t);var n=t.a,r=t.u[0]?q:null;t.a=null,t.u=null,e||re(t,"ready");try{n.onreadystatechange=r}catch(Zd){}}}function nr(t){t.a&&t.F&&(t.a.ontimeout=null),t.o&&(V.clearTimeout(t.o),t.o=null)}function rr(t){return t.a?t.a.readyState:0}function ir(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return ht(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):mn(t,e,n))}function or(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sr(t){this.qa=0,this.g=[],this.c=new _e,this.ha=this.ma=this.B=this.ga=this.a=this.oa=this.A=this.V=this.i=this.O=this.l=null,this.Pa=this.R=0,this.Ma=or("failFast",!1,t),this.G=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.pa=this.P=-1,this.T=this.o=this.u=0,this.Ia=or("baseRetryDelayMs",5e3,t),this.Sa=or("retryDelaySeedMs",1e4,t),this.Na=or("forwardChannelMaxRetries",2,t),this.na=or("forwardChannelRequestTimeoutMs",2e4,t),this.Oa=t&&t.xmlHttpFactory||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Rn(t&&t.concurrentRequestLimit),this.la=new Kn,this.ea=t&&t.fastHandshake||!1,this.Ja=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.ea&&this.S&&t&&t.detectBufferingProxy||!1,this.fa=void 0,this.N=0,this.F=!1,this.s=null,(this.La=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function ar(t){if(cr(t),3==t.v){var e=t.R++,n=fn(t.B);mn(n,"SID",t.J),mn(n,"RID",e),mn(n,"TYPE","terminate"),dr(t,n),(e=new ze(t,t.c,e,void 0)).G=2,e.i=vn(fn(n)),n=!1,V.navigator&&V.navigator.sendBeacon&&(n=V.navigator.sendBeacon(e.i.toString(),"")),!n&&V.Image&&((new Image).src=e.i,n=!0),n||(e.a=_r(e.g,null),e.a.ba(e.i)),e.u=X(),Ze(e)}Er(t)}function ur(t){t.a&&(mr(t),t.a.cancel(),t.a=null)}function cr(t){ur(t),t.j&&(V.clearTimeout(t.j),t.j=null),br(t),t.b.cancel(),t.h&&("number"==typeof t.h&&V.clearTimeout(t.h),t.h=null)}function hr(t,e){t.g.push(new Cn(t.Pa++,e)),3==t.v&&lr(t)}function lr(t){Un(t.b)||t.h||(t.h=!0,fe(t.Ca,t),t.u=0)}function fr(t,e){var n;n=e?e.f:t.R++;var r=fn(t.B);mn(r,"SID",t.J),mn(r,"RID",n),mn(r,"AID",t.P),dr(t,r),t.i&&t.l&&ir(r,t.i,t.l),n=new ze(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=pr(t,n,1e3),n.setTimeout(Math.round(.5*t.na)+Math.round(.5*t.na*Math.random())),Fn(t.b,n),Ye(n,r,e)}function dr(t,e){t.f&&sn({},function(t,n){mn(e,n,t)})}function pr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?W(t.f.Ka,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{Gn(h,s,"req"+c+"_")}catch(ui){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function yr(t){t.a||t.j||(t.T=1,fe(t.Ba,t),t.o=0)}function gr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Pe(W(t.Ba,t),Tr(t,t.o)),t.o++,0))}function mr(t){null!=t.s&&(V.clearTimeout(t.s),t.s=null)}function vr(t){t.a=new ze(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=fn(t.ma);mn(e,"RID","rpc"),mn(e,"SID",t.J),mn(e,"CI",t.G?"0":"1"),mn(e,"AID",t.P),dr(t,e),mn(e,"TYPE","xmlhttp"),t.i&&t.l&&ir(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ha,n.G=1,n.i=vn(fn(e)),n.j=null,n.I=!0,Xe(n,t)}function br(t){null!=t.m&&(V.clearTimeout(t.m),t.m=null)}function wr(t,e){var n=null;if(t.a==e){br(t),mr(t),t.a=null;var r=2}else{if(!Mn(t.b,e))return;n=e.s,Vn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=X()-e.u;var i=t.u;re(r=Ne(),new Re(r,n,e,i)),lr(t)}else yr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Ln(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ma?0:t.Na)||(t.h=Pe(W(t.Ca,t,e),Tr(t,t.u)),t.u++,0)))}(t,e)||2==r&&gr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Ir(t,5);break;case 4:Ir(t,10);break;case 3:Ir(t,6);break;default:Ir(t,2)}}function Tr(t,e){var n=t.Ia+Math.floor(Math.random()*t.Sa);return t.f||(n*=2),n*e}function Ir(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=W(t.cb,t);n||(n=new ln("//www.google.com/images/cleardot.gif"),V.location&&"http"==V.location.protocol||dn(n,"https"),vn(n)),function(t,e){var n=new _e;if(V.Image){var r=new Image;r.onload=Y(zn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Y(zn,n,r,"TestLoadImage: error",!1,e),r.onabort=Y(zn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Y(zn,n,r,"TestLoadImage: timeout",!1,e),V.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ce(2);t.v=0,t.f&&t.f.sa(e),Er(t),cr(t)}function Er(t){t.v=0,t.I=-1,t.f&&(0==qn(t.b).length&&0==t.g.length||(t.b.c.length=0,nt(t.g),t.g.length=0),t.f.ra())}function Or(t,e,n){var r=function(t){return t instanceof ln?fn(t):new ln(t,void 0)}(n);if(""!=r.c)e&&pn(r,e+"."+r.c),yn(r,r.h);else{var i=V.location;r=function(t,e,n,r){var i=new ln(null,void 0);return t&&dn(i,t),e&&pn(i,e),n&&yn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&ht(t.V,function(t,e){mn(r,e,t)}),n=t.oa,(e=t.A)&&n&&mn(r,e,n),mn(r,"VER",t.ia),dr(t,r),r}function _r(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Hn(t.Oa)).G=t.C,e}function Sr(){}function Dr(){if(vt&&!(10<=Number(Nt)))throw Error("Environmental error: no available transport.")}function kr(t,e){ne.call(this),this.a=new sr(e),this.g=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!rt(t)&&(this.a.i=t),this.o=e&&e.supportsCrossDomainXhr||!1,this.m=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!rt(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new xr(this)}function Nr(t){Be.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ar(){Ke.call(this),this.status=1}function xr(t){this.a=t}function jr(t){this.f=t}function Cr(t){ne.call(this),this.u=t,this.h=void 0,this.readyState=Rr,this.status=0,this.responseType=this.responseText=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.o="",this.a=!1,this.m=this.f=this.g=null}(L=Hn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.l?this.l.a():Ve.a(),this.u=function(t){return t.b||(t.b=t.c())}(this.l?this.l:Ve),this.a.onreadystatechange=W(this.Aa,this);try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(o){return void Jn(this,o)}t=n||"";var i=new an(this.headers);r&&sn(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=$n,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=V.FormData&&t instanceof V.FormData,!(0<=Z(Xn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{nr(this),0<this.s&&((this.F=function(t){return vt&&kt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.s,this.a.ontimeout=W(this.ya,this)):this.o=ve(this.ya,this.s,this)),this.m=!0,this.a.send(t),this.m=!1}catch(o){Jn(this,o)}},L.ya=function(){void 0!==F&&this.a&&(this.f="Timed out after "+this.s+"ms, aborting",this.h=8,re(this,"timeout"),this.abort(8))},L.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,re(this,"complete"),re(this,"abort"),er(this))},L.H=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),er(this,!0)),Hn.X.H.call(this)},L.Aa=function(){this.j||(this.B||this.m||this.g?tr(this):this.Za())},L.Za=function(){tr(this)},L.W=function(){try{return 2<rr(this)?this.a.status:-1}catch(gt){return-1}},L.$=function(){try{return this.a?this.a.responseText:""}catch(gt){return""}},L.Qa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Qn(e)}},L.va=function(){return this.h},L.Ra=function(){return"string"==typeof this.f?this.f:String(this.f)},(L=sr.prototype).ia=8,L.v=1,L.Ca=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ze(this,this.c,t,void 0),r=this.l;if(this.O&&(r?dt(r=lt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.ea)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=pr(this,n,e),mn(i=fn(this.B),"RID",t),mn(i,"CVER",22),this.A&&mn(i,"X-HTTP-Session-Id",this.A),dr(this,i),this.i&&r&&ir(i,this.i,r),Fn(this.b,n),this.Ja&&mn(i,"TYPE","init"),this.ea?(mn(i,"$req",e),mn(i,"SID","null"),n.U=!0,Ye(n,i,null)):Ye(n,i,e),this.v=2}}else 3==this.v&&(t?fr(this,t):0==this.g.length||Un(this.b)||fr(this))},L.Ba=function(){if(this.j=null,vr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Pe(W(this.Ya,this),t)}},L.Ya=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.F=!0,Ce(10),ur(this),vr(this))},L.Xa=function(){null!=this.m&&(this.m=null,ur(this),gr(this),Ce(19))},L.cb=function(t){t?(this.c.info("Successfully pinged google.com"),Ce(2)):(this.c.info("Failed to ping google.com"),Ce(1))},(L=Sr.prototype).ua=function(){},L.ta=function(){},L.sa=function(){},L.ra=function(){},L.Ka=function(){},Dr.prototype.a=function(t,e){return new kr(t,e)},$(kr,ne),kr.prototype.h=function(){this.a.f=this.f,this.o&&(this.a.C=!0);var t=this.a,e=this.g,n=this.b||void 0;Ce(0),t.ga=e,t.V=n||{},t.G=t.S,t.B=Or(t,null,t.ga),lr(t)},kr.prototype.close=function(){ar(this.a)},kr.prototype.l=function(t){if("string"==typeof t){var e={};e.__data__=t,hr(this.a,e)}else this.m?((e={}).__data__=oe(t),hr(this.a,e)):hr(this.a,t)},kr.prototype.H=function(){this.a.f=null,delete this.f,ar(this.a),delete this.a,kr.X.H.call(this)},$(Nr,Be),$(Ar,Ke),$(xr,Sr),xr.prototype.ua=function(){re(this.a,"a")},xr.prototype.ta=function(t){re(this.a,new Nr(t))},xr.prototype.sa=function(t){re(this.a,new Ar(t))},xr.prototype.ra=function(){re(this.a,"b")},$(jr,Me),jr.prototype.a=function(){return new Cr(this.f)},jr.prototype.c=function(t){return function(){return t}}({}),$(Cr,ne);var Rr=0;function Pr(t){t.f.read().then(t.Ta.bind(t)).catch(t.ca.bind(t))}function Ur(t){t.readyState=4,t.g=null,t.f=null,t.m=null,Lr(t)}function Lr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(L=Cr.prototype).open=function(t,e){if(this.readyState!=Rr)throw this.abort(),Error("Error reopening a connection");this.s=t,this.o=e,this.readyState=1,Lr(this)},L.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.l,method:this.s,credentials:this.h,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.o,e)).then(this.Wa.bind(this),this.ca.bind(this))},L.abort=function(){this.responseText="",this.l=new Headers,this.status=0,this.f&&this.f.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Ur(this)),this.readyState=Rr},L.Wa=function(t){this.a&&(this.g=t,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=t.headers,this.readyState=2,Lr(this)),this.a&&(this.readyState=3,Lr(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.Ua.bind(this),this.ca.bind(this)):void 0!==V.ReadableStream&&"body"in t?(this.responseText="",this.f=t.body.getReader(),this.m=new TextDecoder,Pr(this)):t.text().then(this.Va.bind(this),this.ca.bind(this)))))},L.Ta=function(t){if(this.a){var e=this.m.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.responseText+=e),t.done?Ur(this):Lr(this),3==this.readyState&&Pr(this)}},L.Va=function(t){this.a&&(this.responseText=t,Ur(this))},L.Ua=function(){this.a&&Ur(this)},L.ca=function(){this.a&&Ur(this)},L.setRequestHeader=function(t,e){this.l.append(t,e)},L.getResponseHeader=function(t){return this.b&&this.b.get(t.toLowerCase())||""},L.getAllResponseHeaders=function(){if(!this.b)return"";for(var t=[],e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Cr.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(t){this.h=t?"include":"same-origin"}}),Dr.prototype.createWebChannel=Dr.prototype.a,kr.prototype.send=kr.prototype.l,kr.prototype.open=kr.prototype.h,kr.prototype.close=kr.prototype.close,Ue.NO_ERROR=0,Ue.TIMEOUT=8,Ue.HTTP_ERROR=6,Le.COMPLETE="complete",Fe.EventType=qe,qe.OPEN="a",qe.CLOSE="b",qe.ERROR="c",qe.MESSAGE="d",ne.prototype.listen=ne.prototype.wa,Hn.prototype.listenOnce=Hn.prototype.xa,Hn.prototype.getLastError=Hn.prototype.Ra,Hn.prototype.getLastErrorCode=Hn.prototype.va,Hn.prototype.getStatus=Hn.prototype.W,Hn.prototype.getResponseJson=Hn.prototype.Qa,Hn.prototype.getResponseText=Hn.prototype.$,Hn.prototype.send=Hn.prototype.ba;var Mr=Ue,Fr=Le,Vr=De,qr=jr,Br=Fe,Kr=Hn,Gr=n("mrSG"),zr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();zr.o=-1;var Qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Hr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Gr.c)(e,t),e}(Error),Wr=new R.b("@firebase/firestore");function Yr(){return Wr.logLevel}function Xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Wr.logLevel<=R.a.DEBUG){var r=e.map(Zr);Wr.debug.apply(Wr,Object(Gr.f)(["Firestore (8.6.8): "+t],r))}}function $r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Wr.logLevel<=R.a.ERROR){var r=e.map(Zr);Wr.error.apply(Wr,Object(Gr.f)(["Firestore (8.6.8): "+t],r))}}function Jr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Wr.logLevel<=R.a.WARN){var r=e.map(Zr);Wr.warn.apply(Wr,Object(Gr.f)(["Firestore (8.6.8): "+t],r))}}function Zr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Zd){return t}}function ti(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.8) INTERNAL ASSERTION FAILED: "+t;throw $r(e),new Error(e)}function ei(t,e){t||ti()}function ni(t,e){return t}function ri(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var ii=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=ri(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function oi(t,e){return t<e?-1:t>e?1:0}function si(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function ai(t){return t+"\0"}var ui=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Hr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Hr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Hr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Hr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?oi(this.nanoseconds,t.nanoseconds):oi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),ci=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ui(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function hi(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function li(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function fi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var di=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&ti(),void 0===n?n=t.length-e:n>t.length-e&&ti(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),pi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(di),yi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,gi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return yi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Hr(Qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Hr(Qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Hr(Qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(di),mi=function(){function t(t){this.fields=t,t.sort(gi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return si(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),vi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return oi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();vi.EMPTY_BYTE_STRING=new vi("");var bi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wi(t){if(ei(!!t),"string"==typeof t){var e=0,n=bi.exec(t);if(ei(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ti(t.seconds),nanos:Ti(t.nanos)}}function Ti(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ii(t){return"string"==typeof t?vi.fromBase64String(t):vi.fromUint8Array(t)}function Ei(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Oi(t){var e=t.mapValue.fields.__previous_value__;return Ei(e)?Oi(e):e}function _i(t){var e=wi(t.mapValue.fields.__local_write_time__.timestampValue);return new ui(e.seconds,e.nanos)}function Si(t){return null==t}function Di(t){return 0===t&&1/t==-1/0}function ki(t){return"number"==typeof t&&Number.isInteger(t)&&!Di(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ni=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(pi.fromString(e))},t.fromName=function(e){return new t(pi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===pi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return pi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new pi(e.slice()))},t}();function Ai(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ei(t)?4:10:ti()}function xi(t,e){var n=Ai(t);if(n!==Ai(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return _i(t).isEqual(_i(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=wi(t.timestampValue),r=wi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ii(t.bytesValue).isEqual(Ii(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ti(t.geoPointValue.latitude)===Ti(e.geoPointValue.latitude)&&Ti(t.geoPointValue.longitude)===Ti(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ti(t.integerValue)===Ti(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ti(t.doubleValue),r=Ti(e.doubleValue);return n===r?Di(n)===Di(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return si(t.arrayValue.values||[],e.arrayValue.values||[],xi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(hi(n)!==hi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!xi(n[i],r[i])))return!1;return!0}(t,e);default:return ti()}}function ji(t,e){return void 0!==(t.values||[]).find(function(t){return xi(t,e)})}function Ci(t,e){var n=Ai(t),r=Ai(e);if(n!==r)return oi(n,r);switch(n){case 0:return 0;case 1:return oi(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ti(t.integerValue||t.doubleValue),r=Ti(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ri(t.timestampValue,e.timestampValue);case 4:return Ri(_i(t),_i(e));case 5:return oi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ii(t),r=Ii(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=oi(n[i],r[i]);if(0!==o)return o}return oi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=oi(Ti(t.latitude),Ti(e.latitude));return 0!==n?n:oi(Ti(t.longitude),Ti(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ci(n[i],r[i]);if(o)return o}return oi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=oi(r[s],o[s]);if(0!==a)return a;var u=Ci(n[r[s]],i[o[s]]);if(0!==u)return u}return oi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw ti()}}function Ri(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return oi(t,e);var n=wi(t),r=wi(e),i=oi(n.seconds,r.seconds);return 0!==i?i:oi(n.nanos,r.nanos)}function Pi(t){return Ui(t)}function Ui(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=wi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ii(t.bytesValue).toBase64():"referenceValue"in t?Ni.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ui(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ui(t.fields[o])}return e+"}"}(t.mapValue):ti();var e}function Li(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Mi(t){return!!t&&"integerValue"in t}function Fi(t){return!!t&&"arrayValue"in t}function Vi(t){return!!t&&"nullValue"in t}function qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Bi(t){return!!t&&"mapValue"in t}function Ki(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},wi(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return li(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Ki(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ki(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Gi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Bi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ki(e)},t.prototype.setAll=function(t){var e=this,n=gi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Ki(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Bi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return xi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Bi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){li(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Ki(this.value))},t}();function zi(t){var e=[];return li(t.fields,function(t,n){var r=new gi([t]);if(Bi(n)){var i=zi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new mi(e)}var Qi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,ci.min(),Gi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Gi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Gi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Gi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Gi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Hi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Wi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Hi(t,e,n,r,i,o,s)}function Yi(t){var e=ni(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Pi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Si(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=uo(e.startAt)),e.endAt&&(n+="|ub:",n+=uo(e.endAt)),e.h=n}return e.h}function Xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!ho(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!xi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!fo(t.startAt,e.startAt)&&fo(t.endAt,e.endAt)}function $i(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ji=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Gr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Zi(t,n,r):"array-contains"===n?new ro(t,r):"in"===n?new io(t,r):"not-in"===n?new oo(t,r):"array-contains-any"===n?new so(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new to(t,n):new eo(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ci(e,this.value)):null!==e&&Ai(this.value)===Ai(e)&&this.m(Ci(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ti()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Zi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ni.fromName(r.referenceValue),i}return Object(Gr.c)(e,t),e.prototype.matches=function(t){var e=Ni.comparator(t.key,this.key);return this.m(e)},e}(Ji),to=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=no(0,n),r}return Object(Gr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ji),eo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=no(0,n),r}return Object(Gr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ji);function no(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Ni.fromName(t.referenceValue)})}var ro=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Gr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Fi(e)&&ji(e.arrayValue,this.value)},e}(Ji),io=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Gr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&ji(this.value.arrayValue,e)},e}(Ji),oo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Gr.c)(e,t),e.prototype.matches=function(t){if(ji(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!ji(this.value.arrayValue,e)},e}(Ji),so=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Gr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Fi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ji(e.value.arrayValue,t)})},e}(Ji),ao=function(t,e){this.position=t,this.before=e};function uo(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Pi(t)}).join(",")}var co=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ho(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function lo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ni.comparator(Ni.fromName(s.referenceValue),n.key):Ci(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function fo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!xi(t.position[n],e.position[n]))return!1;return!0}var po=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function yo(t,e,n,r,i,o,s,a){return new po(t,e,n,r,i,o,s,a)}function go(t){return new po(t)}function mo(t){return!Si(t.limit)&&"F"===t.limitType}function vo(t){return!Si(t.limit)&&"L"===t.limitType}function bo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function wo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function To(t){return null!==t.collectionGroup}function Io(t){var e=ni(t);if(null===e.p){e.p=[];var n=wo(e),r=bo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new co(n)),e.p.push(new co(gi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new co(gi.keyField(),u))}}}return e.p}function Eo(t){var e=ni(t);if(!e.T)if("F"===e.limitType)e.T=Wi(e.path,e.collectionGroup,Io(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Io(e);r<i.length;r++){var o=i[r];n.push(new co(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new ao(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ao(e.startAt.position,!e.startAt.before):null;e.T=Wi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Oo(t,e,n){return new po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function _o(t,e){return Xi(Eo(t),Eo(e))&&t.limitType===e.limitType}function So(t){return Yi(Eo(t))+"|lt:"+t.limitType}function Do(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Pi(e.value);var e}).join(", ")+"]"),Si(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+uo(t.startAt)),t.endAt&&(e+=", endAt: "+uo(t.endAt)),"Target("+e+")"}(Eo(t))+"; limitType="+t.limitType+")"}function ko(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ni.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!lo(t.startAt,Io(t),e)||t.endAt&&lo(t.endAt,Io(t),e))}(t,e)}function No(t){return function(e,n){for(var r=!1,i=0,o=Io(t);i<o.length;i++){var s=o[i],a=Ao(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Ao(t,e,n){var r=t.field.isKeyField()?Ni.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ci(r,i):ti()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ti()}}function xo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Di(e)?"-0":e}}function jo(t){return{integerValue:""+t}}function Co(t,e){return ki(e)?jo(e):xo(t,e)}var Ro=function(){this._=void 0};function Po(t,e,n){return t instanceof Mo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Fo?Vo(t,e):t instanceof qo?Bo(t,e):function(t,e){var n=Lo(t,e),r=Go(n)+Go(t.A);return Mi(n)&&Mi(t.A)?jo(r):xo(t.R,r)}(t,e)}function Uo(t,e,n){return t instanceof Fo?Vo(t,e):t instanceof qo?Bo(t,e):n}function Lo(t,e){return t instanceof Ko?Mi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e}(Ro),Fo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Gr.c)(e,t),e}(Ro);function Vo(t,e){for(var n=zo(e),r=function(t){n.some(function(e){return xi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var qo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Gr.c)(e,t),e}(Ro);function Bo(t,e){for(var n=zo(e),r=function(t){n=n.filter(function(e){return!xi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ko=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Gr.c)(e,t),e}(Ro);function Go(t){return Ti(t.integerValue||t.doubleValue)}function zo(t){return Fi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Qo=function(t,e){this.field=t,this.transform=e},Ho=function(t,e){this.version=t,this.transformResults=e},Wo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Yo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Xo=function(){};function $o(t,e,n){t instanceof ns?function(t,e,n){var r=t.value.clone(),i=os(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof rs?function(t,e,n){if(Yo(t.precondition,e)){var r=os(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(is(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Jo(t,e,n){t instanceof ns?function(t,e,n){if(Yo(t.precondition,e)){var r=t.value.clone(),i=ss(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(es(e),r).setHasLocalMutations()}}(t,e,n):t instanceof rs?function(t,e,n){if(Yo(t.precondition,e)){var r=ss(t.fieldTransforms,n,e),i=e.data;i.setAll(is(t)),i.setAll(r),e.convertToFoundDocument(es(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Yo(t.precondition,e)&&e.convertToNoDocument(ci.min())}(t,e)}function Zo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Lo(o.transform,s||null);null!=a&&(null==n&&(n=Gi.empty()),n.set(o.field,a))}return n||null}function ts(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&si(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Fo&&e instanceof Fo||t instanceof qo&&e instanceof qo?si(t.elements,e.elements,xi):t instanceof Ko&&e instanceof Ko?xi(t.A,e.A):t instanceof Mo&&e instanceof Mo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function es(t){return t.isFoundDocument()?t.version:ci.min()}var ns=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Gr.c)(e,t),e}(Xo),rs=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Gr.c)(e,t),e}(Xo);function is(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function os(t,e,n){var r=new Map;ei(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Uo(s,a,n[i]))}return r}function ss(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Po(a,u,e))}return r}var as,us,cs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Gr.c)(e,t),e}(Xo),hs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Gr.c)(e,t),e}(Xo),ls=function(t){this.count=t};function fs(t){switch(t){case Qr.OK:return ti();case Qr.CANCELLED:case Qr.UNKNOWN:case Qr.DEADLINE_EXCEEDED:case Qr.RESOURCE_EXHAUSTED:case Qr.INTERNAL:case Qr.UNAVAILABLE:case Qr.UNAUTHENTICATED:return!1;case Qr.INVALID_ARGUMENT:case Qr.NOT_FOUND:case Qr.ALREADY_EXISTS:case Qr.PERMISSION_DENIED:case Qr.FAILED_PRECONDITION:case Qr.ABORTED:case Qr.OUT_OF_RANGE:case Qr.UNIMPLEMENTED:case Qr.DATA_LOSS:return!0;default:return ti()}}function ds(t){if(void 0===t)return $r("GRPC error has no .code"),Qr.UNKNOWN;switch(t){case as.OK:return Qr.OK;case as.CANCELLED:return Qr.CANCELLED;case as.UNKNOWN:return Qr.UNKNOWN;case as.DEADLINE_EXCEEDED:return Qr.DEADLINE_EXCEEDED;case as.RESOURCE_EXHAUSTED:return Qr.RESOURCE_EXHAUSTED;case as.INTERNAL:return Qr.INTERNAL;case as.UNAVAILABLE:return Qr.UNAVAILABLE;case as.UNAUTHENTICATED:return Qr.UNAUTHENTICATED;case as.INVALID_ARGUMENT:return Qr.INVALID_ARGUMENT;case as.NOT_FOUND:return Qr.NOT_FOUND;case as.ALREADY_EXISTS:return Qr.ALREADY_EXISTS;case as.PERMISSION_DENIED:return Qr.PERMISSION_DENIED;case as.FAILED_PRECONDITION:return Qr.FAILED_PRECONDITION;case as.ABORTED:return Qr.ABORTED;case as.OUT_OF_RANGE:return Qr.OUT_OF_RANGE;case as.UNIMPLEMENTED:return Qr.UNIMPLEMENTED;case as.DATA_LOSS:return Qr.DATA_LOSS;default:return ti()}}(us=as||(as={}))[us.OK=0]="OK",us[us.CANCELLED=1]="CANCELLED",us[us.UNKNOWN=2]="UNKNOWN",us[us.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",us[us.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",us[us.NOT_FOUND=5]="NOT_FOUND",us[us.ALREADY_EXISTS=6]="ALREADY_EXISTS",us[us.PERMISSION_DENIED=7]="PERMISSION_DENIED",us[us.UNAUTHENTICATED=16]="UNAUTHENTICATED",us[us.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",us[us.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",us[us.ABORTED=10]="ABORTED",us[us.OUT_OF_RANGE=11]="OUT_OF_RANGE",us[us.UNIMPLEMENTED=12]="UNIMPLEMENTED",us[us.INTERNAL=13]="INTERNAL",us[us.UNAVAILABLE=14]="UNAVAILABLE",us[us.DATA_LOSS=15]="DATA_LOSS";var ps=function(){function t(t,e){this.comparator=t,this.root=e||gs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,gs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ys(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ys(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ys(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ys(this.root,t,this.comparator,!0)},t}(),ys=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),gs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw ti();if(this.right.isRed())throw ti();var t=this.left.check();if(t!==this.right.check())throw ti();return t+(this.isRed()?0:1)},t}();gs.EMPTY=null,gs.RED=!0,gs.BLACK=!1,gs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw ti()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw ti()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw ti()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw ti()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw ti()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new gs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ms=function(){function t(t){this.comparator=t,this.data=new ps(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new vs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new vs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),vs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),bs=new ps(Ni.comparator);function ws(){return bs}var Ts=new ps(Ni.comparator);function Is(){return Ts}var Es=new ps(Ni.comparator);function Os(){return Es}var _s=new ms(Ni.comparator);function Ss(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=_s,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ds=new ms(oi);function ks(){return Ds}var Ns=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,As.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(ci.min(),r,ks(),ws(),Ss())},t}(),As=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(vi.EMPTY_BYTE_STRING,n,Ss(),Ss(),Ss())},t}(),xs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},js=function(t,e){this.targetId=t,this.V=e},Cs=function(t,e,n,r){void 0===n&&(n=vi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Rs=function(){function t(){this.S=0,this.D=Ls(),this.C=vi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ss(),e=Ss(),n=Ss();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ti()}}),new As(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Ls()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ps=function(){function t(t){this.W=t,this.G=new Map,this.H=ws(),this.J=Us(),this.Y=new ms(oi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:ti()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if($i(i))if(0===n){var o=new Ni(i.path);this.tt(e,o,Qi.newNoDocument(o,ci.min()))}else ei(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&$i(o.target)){var s=new Ni(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Qi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Ss();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ns(t,n,this.Y,this.H,r);return this.H=ws(),this.J=Us(),this.Y=new ms(oi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Rs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ms(oi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Xr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Rs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Us(){return new ps(Ni.comparator)}function Ls(){return new ps(Ni.comparator)}var Ms={asc:"ASCENDING",desc:"DESCENDING"},Fs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vs=function(t,e){this.databaseId=t,this.I=e};function qs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bs(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ks(t,e){return qs(t,e.toTimestamp())}function Gs(t){return ei(!!t),ci.fromTimestamp(function(t){var e=wi(t);return new ui(e.seconds,e.nanos)}(t))}function zs(t,e){return function(t){return new pi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Qs(t){var e=pi.fromString(t);return ei(ga(e)),e}function Hs(t,e){return zs(t.databaseId,e.path)}function Ws(t,e){var n=Qs(e);if(n.get(1)!==t.databaseId.projectId)throw new Hr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Hr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ni(Js(n))}function Ys(t,e){return zs(t.databaseId,e)}function Xs(t){var e=Qs(t);return 4===e.length?pi.emptyPath():Js(e)}function $s(t){return new pi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Js(t){return ei(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Zs(t,e,n){return{name:Hs(t,e),fields:n.value.mapValue.fields}}function ta(t,e,n){var r=Ws(t,e.name),i=Gs(e.updateTime),o=new Gi({mapValue:{fields:e.fields}}),s=Qi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function ea(t,e){var n;if(e instanceof ns)n={update:Zs(t,e.key,e.value)};else if(e instanceof cs)n={delete:Hs(t,e.key)};else if(e instanceof rs)n={update:Zs(t,e.key,e.data),updateMask:ya(e.fieldMask)};else{if(!(e instanceof hs))return ti();n={verify:Hs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Mo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Fo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof qo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ko)return{fieldPath:e.field.canonicalString(),increment:n.A};throw ti()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ks(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ti()}(t,e.precondition)),n}function na(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Wo.updateTime(Gs(t.updateTime)):void 0!==t.exists?Wo.exists(t.exists):Wo.none()}(e.currentDocument):Wo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(ei("REQUEST_TIME"===e.setToServerValue),n=new Mo):"appendMissingElements"in e?n=new Fo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new qo(e.removeAllFromArray.values||[]):"increment"in e?n=new Ko(t,e.increment):ti();var r=gi.fromServerFormat(e.fieldPath);return new Qo(r,n)}(t,e)}):[];if(e.update){var i=Ws(t,e.update.name),o=new Gi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new mi((t.fieldPaths||[]).map(function(t){return gi.fromServerFormat(t)}))}(e.updateMask);return new rs(i,o,s,n,r)}return new ns(i,o,n,r)}if(e.delete){var a=Ws(t,e.delete);return new cs(a,n)}if(e.verify){var u=Ws(t,e.verify);return new hs(u,n)}return ti()}function ra(t,e){return{documents:[Ys(t,e.path)]}}function ia(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ys(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ys(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(qi(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NAN"}};if(Vi(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(qi(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NOT_NAN"}};if(Vi(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:la(t.field),op:ha(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:la(t.field),direction:ca(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Si(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=aa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=aa(e.endAt)),n}function oa(t){var e=Xs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ei(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=sa(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new co(fa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Si(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ua(n.startAt));var h=null;return n.endAt&&(h=ua(n.endAt)),yo(e,i,a,s,u,"F",c,h)}function sa(t){return t?void 0!==t.unaryFilter?[pa(t)]:void 0!==t.fieldFilter?[da(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return sa(t)}).reduce(function(t,e){return t.concat(e)}):ti():[]}function aa(t){return{before:t.before,values:t.position}}function ua(t){return new ao(t.values||[],!!t.before)}function ca(t){return Ms[t]}function ha(t){return Fs[t]}function la(t){return{fieldPath:t.canonicalString()}}function fa(t){return gi.fromServerFormat(t.fieldPath)}function da(t){return Ji.create(fa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ti()}}(t.fieldFilter.op),t.fieldFilter.value)}function pa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=fa(t.unaryFilter.field);return Ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=fa(t.unaryFilter.field);return Ji.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=fa(t.unaryFilter.field);return Ji.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=fa(t.unaryFilter.field);return Ji.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ti()}}function ya(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ga(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ma(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ba(e)),e=va(t.get(n),e);return ba(e)}function va(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ba(t){return t+"\x01\x01"}function wa(t){var e=t.length;if(ei(e>=2),2===e)return ei("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),pi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&ti(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:ti()}o=s+2}return new pi(r)}var Ta=function(t,e){this.seconds=t,this.nanoseconds=e},Ia=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ia.store="owner",Ia.key="owner";var Ea=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ea.store="mutationQueues",Ea.keyPath="userId";var Oa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Oa.store="mutations",Oa.keyPath="batchId",Oa.userMutationsIndex="userMutationsIndex",Oa.userMutationsKeyPath=["userId","batchId"];var _a=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ma(e)]},t.key=function(t,e,n){return[t,ma(e),n]},t}();_a.store="documentMutations",_a.PLACEHOLDER=new _a;var Sa=function(t,e){this.path=t,this.readTime=e},Da=function(t,e){this.path=t,this.version=e},ka=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ka.store="remoteDocuments",ka.readTimeIndex="readTimeIndex",ka.readTimeIndexPath="readTime",ka.collectionReadTimeIndex="collectionReadTimeIndex",ka.collectionReadTimeIndexPath=["parentPath","readTime"];var Na=function(t){this.byteSize=t};Na.store="remoteDocumentGlobal",Na.key="remoteDocumentGlobalKey";var Aa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Aa.store="targets",Aa.keyPath="targetId",Aa.queryTargetsIndexName="queryTargetsIndex",Aa.queryTargetsKeyPath=["canonicalId","targetId"];var xa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};xa.store="targetDocuments",xa.keyPath=["targetId","path"],xa.documentTargetsIndex="documentTargetsIndex",xa.documentTargetsKeyPath=["path","targetId"];var ja=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ja.key="targetGlobalKey",ja.store="targetGlobal";var Ca=function(t,e){this.collectionId=t,this.parent=e};Ca.store="collectionParents",Ca.keyPath=["collectionId","parent"];var Ra=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ra.store="clientMetadata",Ra.keyPath="clientId";var Pa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Pa.store="bundles",Pa.keyPath="bundleId";var Ua=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ua.store="namedQueries",Ua.keyPath="name";var La=Object(Gr.f)(Object(Gr.f)([],Object(Gr.f)(Object(Gr.f)([],Object(Gr.f)(Object(Gr.f)([],Object(Gr.f)(Object(Gr.f)([],[Ea.store,Oa.store,_a.store,ka.store,Aa.store,Ia.store,ja.store,xa.store]),[Ra.store])),[Na.store])),[Ca.store])),[Pa.store,Ua.store]),Ma="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Va=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},qa=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&ti(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ba=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Va,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new za(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Xa(e.target.error);n.ft.reject(new za(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new za(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ha(e)},t}(),Ka=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(C.i)())&&$r("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Xr("SimpleDb","Removing database:",t),Wa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(C.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new za(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Hr(Qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new za(t,n))},i.onupgradeneeded=function(t){Xr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Xr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Gr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Gr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ba.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),qa.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Xr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ga=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Wa(this.Pt.delete())},t}(),za=function(t){function e(e,n){var r=this;return(r=t.call(this,Qr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Gr.c)(e,t),e}(Hr);function Qa(t){return"IndexedDbTransactionError"===t.name}var Ha=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Xr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Wa(n)},t.prototype.add=function(t){return Xr("SimpleDb","ADD",this.store.name,t,t),Wa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Wa(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Xr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Xr("SimpleDb","DELETE",this.store.name,t),Wa(this.store.delete(t))},t.prototype.count=function(){return Xr("SimpleDb","COUNT",this.store.name),Wa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Xr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new qa(function(n,r){e.onerror=function(t){var e=Xa(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new qa(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ga(i),s=e(i.primaryKey,i.value,o);if(s instanceof qa){var a=s.catch(function(t){return o.done(),qa.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return qa.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Wa(t){return new qa(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Xa(t.target.error);n(e)}})}var Ya=!1;function Xa(t){var e=Ka._t(Object(C.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Hr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ya||(Ya=!0,setTimeout(function(){throw r},0)),r}}return t}var $a=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Gr.c)(e,t),e}(Fa);function Ja(t,e){var n=ni(t);return Ka.It(n.Mt,e)}var Za=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&$o(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Jo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Jo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ci.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ss())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&si(this.mutations,t.mutations,function(t,e){return ts(t,e)})&&si(this.baseMutations,t.baseMutations,function(t,e){return ts(t,e)})},t}(),tu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){ei(e.mutations.length===r.length);for(var i=Os(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),eu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=ci.min()),void 0===o&&(o=ci.min()),void 0===s&&(s=vi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),nu=function(t){this.Lt=t};function ru(t,e){if(e.document)return ta(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ni.fromSegments(e.noDocument.path),r=uu(e.noDocument.readTime),i=Qi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ni.fromSegments(e.unknownDocument.path);return r=uu(e.unknownDocument.version),Qi.newUnknownDocument(o,r)}return ti()}function iu(t,e,n){var r=ou(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Hs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:qs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ka(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=au(e.version);return s=e.hasCommittedMutations,new ka(null,new Sa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=au(e.version);return new ka(new Da(c,h),null,null,!0,r,i)}return ti()}function ou(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function su(t){var e=new ui(t[0],t[1]);return ci.fromTimestamp(e)}function au(t){var e=t.toTimestamp();return new Ta(e.seconds,e.nanoseconds)}function uu(t){var e=new ui(t.seconds,t.nanoseconds);return ci.fromTimestamp(e)}function cu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return na(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return na(t.Lt,e)}),o=ui.fromMillis(e.localWriteTimeMs);return new Za(e.batchId,o,n,i)}function hu(t){var e,n,r=uu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?uu(t.lastLimboFreeSnapshotVersion):ci.min();return void 0!==t.query.documents?(ei(1===(n=t.query).documents.length),e=Eo(go(Xs(n.documents[0])))):e=function(t){return Eo(oa(t))}(t.query),new eu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,vi.fromBase64String(t.resumeToken))}function lu(t,e){var n,r=au(e.snapshotVersion),i=au(e.lastLimboFreeSnapshotVersion);n=$i(e.target)?ra(t.Lt,e.target):ia(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Aa(e.targetId,Yi(e.target),r,o,e.sequenceNumber,i,n)}function fu(t){var e=oa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Oo(e,e.limit,"L"):e}var du=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return pu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:uu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return pu(t).put({bundleId:(n=e).id,createTime:au(Gs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return yu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:fu(e.bundledQuery),readTime:uu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return yu(t).put(function(t){return{name:t.name,readTime:au(Gs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function pu(t){return Ja(t,Pa.store)}function yu(t){return Ja(t,Ua.store)}var gu=function(){function t(){this.Bt=new mu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),qa.resolve()},t.prototype.getCollectionParents=function(t,e){return qa.resolve(this.Bt.getEntries(e))},t}(),mu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ms(pi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ms(pi.comparator)).toArray()},t}(),vu=function(){function t(){this.qt=new mu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:ma(i)};return bu(t).put(o)}return qa.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ai(e),""],!1,!0);return bu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(wa(o.parent))}return n})},t}();function bu(t){return Ja(t,Ca.store)}var wu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Tu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Iu(t,e,n){var r=t.store(Oa.store),i=t.store(_a.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){ei(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=_a.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return qa.waitFor(o).next(function(){return c})}function Eu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ti();e=t.noDocument}return JSON.stringify(e).length}Tu.DEFAULT_COLLECTION_PERCENTILE=10,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tu.DEFAULT=new Tu(41943040,Tu.DEFAULT_COLLECTION_PERCENTILE,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tu.DISABLED=new Tu(-1,0,0);var Ou=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return ei(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Su(t).$t({index:Oa.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Du(t),s=Su(t);return s.add({}).next(function(a){ei("number"==typeof a);for(var u=new Za(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return ea(t.Lt,e)}),i=n.mutations.map(function(e){return ea(t.Lt,e)});return new Oa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ms(function(t,e){return oi(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=_a.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,_a.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),qa.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Su(t).get(e).next(function(t){return t?(ei(t.userId===n.userId),cu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?qa.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Su(t).$t({index:Oa.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(ei(e.batchId>=r),o=cu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Su(t).$t({index:Oa.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Su(t).Nt(Oa.userMutationsIndex,n).next(function(t){return t.map(function(t){return cu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=_a.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Du(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=wa(r[1]);if(a===n.userId&&e.path.isEqual(c))return Su(t).get(u).next(function(t){if(!t)throw ti();ei(t.userId===n.userId),o.push(cu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ms(oi),i=[];return e.forEach(function(e){var o=_a.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Du(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=wa(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),qa.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=_a.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ms(oi);return Du(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=wa(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Su(t).get(e).next(function(t){if(null===t)throw ti();ei(t.userId===n.userId),r.push(cu(n.R,t))}))}),qa.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Iu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),qa.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return qa.resolve();var r=IDBKeyRange.lowerBound(_a.prefixForUser(e.userId)),i=[];return Du(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=wa(t[1]);i.push(o)}else r.done()}).next(function(){ei(0===i.length)})})},t.prototype.containsKey=function(t,e){return _u(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return ku(t).get(this.userId).next(function(t){return t||new Ea(e.userId,-1,"")})},t}();function _u(t,e,n){var r=_a.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Du(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Su(t){return Ja(t,Oa.store)}function Du(t){return Ja(t,_a.store)}function ku(t){return Ja(t,Ea.store)}var Nu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Au=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Nu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return ci.fromTimestamp(new ui(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return xu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return ei(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return xu(t).$t(function(s,a){var u=hu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return qa.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return xu(t).$t(function(t,n){var r=hu(n);e(r)})},t.prototype.Xt=function(t){return ju(t).get(ja.key).next(function(t){return ei(null!==t),t})},t.prototype.Zt=function(t,e){return ju(t).put(ja.key,e)},t.prototype.te=function(t,e){return xu(t).put(lu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Yi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return xu(t).$t({range:r,index:Aa.queryTargetsIndexName},function(t,n,r){var o=hu(n);Xi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Cu(t);return e.forEach(function(e){var s=ma(e.path);i.push(o.put(new xa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),qa.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Cu(t);return qa.forEach(e,function(e){var o=ma(e.path);return qa.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Cu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Cu(t),i=Ss();return r.$t({range:n,kt:!0},function(t,e,n){var r=wa(t[1]),o=new Ni(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ma(e.path),r=IDBKeyRange.bound([n],[ai(n)],!1,!0),i=0;return Cu(t).$t({index:xa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return xu(t).get(e).next(function(t){return t?hu(t):null})},t}();function xu(t){return Ja(t,Aa.store)}function ju(t){return Ja(t,ja.store)}function Cu(t){return Ja(t,xa.store)}function Ru(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){if(t.code!==Qr.FAILED_PRECONDITION||t.message!==Ma)throw t;return Xr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Pu(t,e){var n=t[1],r=e[1],i=oi(t[0],e[0]);return 0===i?oi(n,r):i}var Uu=function(){function t(t){this.ne=t,this.buffer=new ms(Pu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Pu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Lu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Xr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Gr.b)(e,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Qa(e=n.sent())?(Xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ru(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Mu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return qa.resolve(zr.o);var r=new Uu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Xr("LruGarbageCollector","Garbage collection skipped; disabled"),qa.resolve(wu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Xr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),wu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Yr()<=R.a.DEBUG&&Xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),qa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Fu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Mu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Vu(t,n)},t.prototype.removeReference=function(t,e,n){return Vu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Vu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return ku(t).Ot(function(r){return _u(t,r,e).next(function(t){return t&&(n=!0),qa.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Cu(t).delete([0,ma(s.path)])})});i.push(u)}}).next(function(){return qa.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Vu(t,e)},t.prototype.we=function(t,e){var n,r=Cu(t),i=zr.o;return r.$t({index:xa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==zr.o&&e(new Ni(wa(n)),i),i=s,n=o):i=zr.o}).next(function(){i!==zr.o&&e(new Ni(wa(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Vu(t,e){return Cu(t).put(function(t,e){return new xa(0,ma(t.path),e)}(e,t.currentSequenceNumber))}var qu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){li(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return fi(this.inner)},t}(),Bu=function(){function t(){this.changes=new qu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:ci.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Qi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?qa.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Ku=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Qu(t).put(Hu(e),n)},t.prototype.removeEntry=function(t,e){var n=Qu(t),r=Hu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Qu(t).get(Hu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Qu(t).get(Hu(e)).next(function(t){return{document:n.ye(e,t),size:Eu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=ws();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=ws(),i=new ps(Ni.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Eu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return qa.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Qu(t).$t({range:r},function(t,e,r){for(var s=Ni.fromSegments(t);o&&Ni.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=ws(),o=e.path.length+1,s={};if(n.isEqual(ci.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=ou(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ka.collectionReadTimeIndex}return Qu(t).$t(s,function(t,n,s){if(t.length===o){var a=ru(r.R,n);e.path.isPrefixOf(a.key.path)?ko(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Gu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return zu(t).get(Na.key).next(function(t){return ei(!!t),t})},t.prototype.me=function(t,e){return zu(t).put(Na.key,e)},t.prototype.ye=function(t,e){if(e){var n=ru(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(ci.min()))return n}return Qi.newInvalidDocument(t)},t}(),Gu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new qu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Gr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ms(function(t,e){return oi(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=iu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Eu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=iu(e.Ie.R,Qi.newNoDocument(o,ci.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),qa.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Bu);function zu(t){return Ja(t,Na.store)}function Qu(t){return Ja(t,ka.store)}function Hu(t){return t.path.toArray()}var Wu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;ei(n<r&&n>=0&&r<=11);var o=new Ba("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ia.store)}(t),function(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}),t.createObjectStore(Oa.store,{keyPath:Oa.keyPath,autoIncrement:!0}).createIndex(Oa.userMutationsIndex,Oa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(_a.store)}(t),Yu(t),function(t){t.createObjectStore(ka.store)}(t));var s=qa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(xa.store),t.deleteObjectStore(Aa.store),t.deleteObjectStore(ja.store)}(t),Yu(t)),s=s.next(function(){return function(t){var e=t.store(ja.store),n=new ja(0,0,ci.min().toTimestamp(),0);return e.put(ja.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Oa.store).Nt().next(function(n){t.deleteObjectStore(Oa.store),t.createObjectStore(Oa.store,{keyPath:Oa.keyPath,autoIncrement:!0}).createIndex(Oa.userMutationsIndex,Oa.userMutationsKeyPath,{unique:!0});var r=e.store(Oa.store),i=n.map(function(t){return r.put(t)});return qa.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Na.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ka.store);e.createIndex(ka.readTimeIndex,ka.readTimeIndexPath,{unique:!1}),e.createIndex(ka.collectionReadTimeIndex,ka.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Pa.store,{keyPath:Pa.keyPath})}(t),function(t){t.createObjectStore(Ua.store,{keyPath:Ua.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(ka.store).$t(function(t,n){e+=Eu(n)}).next(function(){var n=new Na(e);return t.store(Na.store).put(Na.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Ea.store),r=t.store(Oa.store);return n.Nt().next(function(n){return qa.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Oa.userMutationsIndex,i).next(function(r){return qa.forEach(r,function(r){ei(r.userId===n.userId);var i=cu(e.R,r);return Iu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(xa.store),n=t.store(ka.store);return t.store(ja.store).get(ja.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new pi(n),s=function(t){return[0,ma(t)]}(o);r.push(e.get(s).next(function(n){return n?qa.resolve():function(n){return e.put(new xa(0,ma(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return qa.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath});var n=e.store(Ca.store),r=new mu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ma(i)})}};return e.store(ka.store).$t({kt:!0},function(t,e){var n=new pi(t);return i(n.popLast())}).next(function(){return e.store(_a.store).$t({kt:!0},function(t,e){var n=wa(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Aa.store);return n.$t(function(t,r){var i=hu(r),o=lu(e.R,i);return n.put(o)})},t}();function Yu(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath}).createIndex(xa.documentTargetsIndex,xa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store,{keyPath:Aa.keyPath}).createIndex(Aa.queryTargetsIndexName,Aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ja.store)}var Xu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",$u=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Hr(Qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Fu(this,i),this.Le=n+"main",this.R=new nu(u),this.Be=new Ka(this.Le,11,new Wu(this.R)),this.qe=new Au(this.referenceDelegate,this.R),this.Ut=new vu,this.Ue=function(t,e){return new Ku(t,e)}(this.R,this.Ut),this.Qe=new du,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&$r("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Hr(Qr.FAILED_PRECONDITION,Xu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new zr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Gr.b)(e,void 0,void 0,function(){return Object(Gr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Gr.b)(e,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Gr.b)(e,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Zu(e).put(new Ra(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Qa(e))return Xr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Ju(t).get(Ia.key).next(function(t){return qa.resolve(e.tn(t))})},t.prototype.en=function(t){return Zu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ja(t,Ra.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return qa.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?qa.resolve(!0):Ju(t).get(Ia.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Hr(Qr.FAILED_PRECONDITION,Xu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Zu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t=this;return Object(Gr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ia.store,Ra.store],function(e){var n=new $a(e,zr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Zu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Ou.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Xr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",La,function(o){return r=new $a(o,i.Ne?i.Ne.next():zr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw $r("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Hr(Qr.FAILED_PRECONDITION,Ma);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Ju(t).get(Ia.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Hr(Qr.FAILED_PRECONDITION,Xu)})},t.prototype.Ze=function(t){var e=new Ia(this.clientId,this.allowTabSynchronization,Date.now());return Ju(t).put(Ia.key,e)},t.yt=function(){return Ka.yt()},t.prototype.Xe=function(t){var e=this,n=Ju(t);return n.get(Ia.key).next(function(t){return e.tn(t)?(Xr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ia.key)):qa.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&($r("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return $r("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){$r("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ju(t){return Ja(t,Ia.store)}function Zu(t){return Ja(t,Ra.store)}function tc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var ec=function(t,e){this.progress=t,this.wn=e},nc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):To(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ni(e)).next(function(t){var e=Is();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Is();return this.Ut.getCollectionParents(t,i).next(function(s){return qa.forEach(s,function(s){var a=function(t,e){return new po(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Qi.newInvalidDocument(c),r=r.insert(c,h)),Jo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){ko(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Ss(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof rs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),rc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ss(),i=Ss(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),ic=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ci.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(mo(e)||vo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Yr()<=R.a.DEBUG&&Xr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Do(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ms(No(t));return e.forEach(function(e,r){ko(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Yr()<=R.a.DEBUG&&Xr("QueryEngine","Using full collection scan to execute query:",Do(e)),this.Sn.getDocumentsMatchingQuery(t,e,ci.min())},t}(),oc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new ps(oi),this.kn=new qu(function(t){return Yi(t)},Xi),this.$n=ci.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new nc(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function sc(t,e,n,r){return new oc(t,e,n,r)}function ac(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Gr.d)(this,function(s){switch(s.label){case 0:return n=ni(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new nc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=Ss(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function uc(t,e){var n=ni(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=qa.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);ei(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function cc(t){var e=ni(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function hc(t,e){var n=ni(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return ei(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=ws();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(lc(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(ci.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return qa.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function lc(t,e,n,r,i){var o=Ss();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=ws();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(ci.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function fc(t,e){var n=ni(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function dc(t,e){var n=ni(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?qa.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new eu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function pc(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:r=ni(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Qa(s=a.sent()))throw s;return Xr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function yc(t,e,n){var r=ni(t),i=ci.min(),o=Ss();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=ni(t),i=r.kn.get(n);return void 0!==i?qa.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Eo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:ci.min(),n?o:Ss())}).next(function(t){return{documents:t,Bn:o}})})}function gc(t,e){var n=ni(t),r=ni(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function mc(t){var e=ni(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=ni(t),i=ws(),o=ou(n),s=Qu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ka.readTimeIndex,range:a},function(t,e){var n=ru(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:su(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function vc(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){return[2,(e=ni(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Qu(t),n=ci.min();return e.$t({index:ka.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=su(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function bc(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Gr.d)(this,function(p){switch(p.label){case 0:for(i=ni(t),o=Ss(),s=ws(),a=Os(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,dc(i,function(t){return Eo(go(pi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return lc(t,f,s,ci.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function wc(t,e,n){return void 0===n&&(n=Ss()),Object(Gr.b)(this,void 0,void 0,function(){var r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return[4,dc(t,Eo(fu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=ni(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Gs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(vi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var Tc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return qa.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Gs(n.createTime)}),qa.resolve()},t.prototype.getNamedQuery=function(t,e){return qa.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:fu(t.bundledQuery),readTime:Gs(t.readTime)}}(e)),qa.resolve()},t}(),Ic=function(){function t(){this.Wn=new ms(Ec.Gn),this.zn=new ms(Ec.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ec(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Ec(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Ni(new pi([])),r=new Ec(n,t),i=new Ec(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ni(new pi([])),n=new Ec(e,t),r=new Ec(e,t+1),i=Ss();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Ec(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ec=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ni.comparator(t.key,e.key)||oi(t.ns,e.ns)},t.Hn=function(t,e){return oi(t.ns,e.ns)||Ni.comparator(t.key,e.key)},t}(),Oc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ms(Ec.Gn)}return t.prototype.checkEmpty=function(t){return qa.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Za(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Ec(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return qa.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return qa.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return qa.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return qa.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return qa.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ec(e,0),i=new Ec(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),qa.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ms(oi);return e.forEach(function(t){var e=new Ec(t,0),i=new Ec(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),qa.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ni.isDocumentKey(i)||(i=i.child(""));var o=new Ec(new Ni(i),0),s=new ms(oi);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),qa.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ei(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return qa.forEach(e.mutations,function(i){var o=new Ec(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Ec(e,0),r=this.rs.firstAfterOrEqual(n);return qa.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return qa.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),_c=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new ps(Ni.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return qa.resolve(n?n.document.clone():Qi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=ws();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Qi.newInvalidDocument(t))}),qa.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=ws(),i=new Ni(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||ko(e,u)&&(r=r.insert(u.key,u.clone()))}return qa.resolve(r)},t.prototype.fs=function(t,e){return qa.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Sc(this)},t.prototype.getSize=function(t){return qa.resolve(this.size)},t}(),Sc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Gr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),qa.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Bu),Dc=function(){function t(t){this.persistence=t,this.ds=new qu(function(t){return Yi(t)},Xi),this.lastRemoteSnapshotVersion=ci.min(),this.highestTargetId=0,this.ws=0,this._s=new Ic,this.targetCount=0,this.ys=Nu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),qa.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return qa.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return qa.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),qa.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),qa.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Nu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,qa.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),qa.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,qa.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),qa.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return qa.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return qa.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),qa.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),qa.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),qa.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return qa.resolve(n)},t.prototype.containsKey=function(t,e){return qa.resolve(this._s.containsKey(e))},t}(),kc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new zr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Dc(this),this.Ut=new gu,this.Ue=function(t,e){return new _c(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new nu(e),this.Qe=new Tc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Oc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Xr("MemoryPersistence","Starting transaction:",t);var i=new Nc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return qa.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Nc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Gr.c)(e,t),e}(Fa),Ac=function(){function t(t){this.persistence=t,this.As=new Ic,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw ti()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),qa.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),qa.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),qa.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qa.forEach(this.vs,function(r){var i=Ni.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return qa.or([function(){return qa.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),xc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function jc(t,e){return"firestore_clients_"+t+"_"+e}function Cc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Rc(t,e){return"firestore_targets_"+t+"_"+e}xc.UNAUTHENTICATED=new xc(null),xc.GOOGLE_CREDENTIALS=new xc("google-credentials-uid"),xc.FIRST_PARTY=new xc("first-party-uid");var Pc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Hr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):($r("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Uc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Hr(i.error.code,i.error.message)),o?new t(e,i.state,r):($r("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Lc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ks(),s=0;i&&s<r.activeTargetIds.length;++s)i=ki(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):($r("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Mc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):($r("SharedClientState","Failed to parse online state: "+e),null)},t}(),Fc=function(){function t(){this.activeTargetIds=ks()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Vc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new ps(oi),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=jc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Fc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Gr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(jc(this.persistenceKey,r)))&&(o=Lc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Rc(this.persistenceKey,t));if(n){var r=Uc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Rc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Xr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Xr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void $r("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Gr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Gr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=zr.o;if(null!=t)try{var n=JSON.parse(t);ei("number"==typeof n),e=n}catch(t){$r("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==zr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Pc(this.currentUser,t,e,n),i=Cc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Cc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Rc(this.persistenceKey,t),i=new Uc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Lc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Pc.Vs(new xc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Uc.Vs(r,e)},t.prototype.js=function(t){return Mc.Vs(t)},t.prototype.ii=function(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Xr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ks();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),qc=function(){function t(){this.li=new Fc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Fc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Bc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Kc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Gc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},zc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Qc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(Gr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Kr;s.listenOnce(Fr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Mr.NO_ERROR:var e=s.getResponseJson();Xr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Mr.TIMEOUT:Xr("Connection",'RPC "'+t+'" timed out'),o(new Hr(Qr.DEADLINE_EXCEEDED,"Request time out"));break;case Mr.HTTP_ERROR:var n=s.getStatus();if(Xr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Qr).indexOf(e)>=0?e:Qr.UNKNOWN}(r.status);o(new Hr(a,r.message))}else o(new Hr(Qr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Hr(Qr.UNAVAILABLE,"Connection failed."));break;default:ti()}}finally{Xr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Dr,i=Ne(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new qr({})),this.Fi(o.initMessageHeaders,e),Object(C.n)()||Object(C.p)()||Object(C.l)()||Object(C.m)()||Object(C.q)()||Object(C.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Xr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new zc({Ei:function(t){c?Xr("Connection","Not sending because WebChannel is closed:",t):(u||(Xr("Connection","Opening WebChannel transport."),a.open(),u=!0),Xr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Br.EventType.OPEN,function(){c||Xr("Connection","WebChannel transport opened.")}),l(a,Br.EventType.CLOSE,function(){c||(c=!0,Xr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Br.EventType.ERROR,function(t){c||(c=!0,Jr("Connection","WebChannel transport errored:",t),h.Vi(new Hr(Qr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Br.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];ei(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Xr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=as[t];if(void 0!==e)return ds(e)}(i),s=r.message;void 0===o&&(o=Qr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Hr(o,s)),a.close()}else Xr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Vr.STAT_EVENT,function(t){10===t.stat?Xr("Connection","Detected buffering proxy"):11===t.stat&&Xr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Xr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Xr("RestConnection","Received: ",t),t},function(e){throw Jr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.8",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Gc[t]},t}());function Hc(){return"undefined"!=typeof window?window:null}function Wc(){return"undefined"!=typeof document?document:null}function Yc(t){return new Vs(t,!0)}var Xc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),$c=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Xc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Qr.RESOURCE_EXHAUSTED?($r(e.toString()),$r("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Qr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Hr(Qr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Gr.b)(t,void 0,void 0,function(){return Object(Gr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Jc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Gr.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ti()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(ei(void 0===e||"string"==typeof e),vi.fromBase64String(e||"")):(ei(void 0===e||e instanceof Uint8Array),vi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Qr.UNKNOWN:ds(t.code);return new Hr(e,t.message||"")}(a);n=new Cs(r,i,o,s||null)}else if("documentChange"in e){i=Ws(t,(r=e.documentChange).document.name),o=Gs(r.document.updateTime);var a=new Gi({mapValue:{fields:r.document.fields}}),u=(s=Qi.newFoundDocument(i,o,a),r.targetIds||[]);n=new xs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ws(t,(r=e.documentDelete).document),o=r.readTime?Gs(r.readTime):ci.min(),a=Qi.newNoDocument(i,o),n=new xs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ws(t,(r=e.documentRemove).document),n=new xs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return ti();var c=e.filter;i=new ls(r=c.count||0),n=new js(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return ci.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?ci.min():e.readTime?Gs(e.readTime):ci.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=$s(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=$i(r)?{documents:ra(t,r)}:{query:ia(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Bs(t,e.resumeToken):e.snapshotVersion.compareTo(ci.min())>0&&(n.readTime=qs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ti()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=$s(this.R),e.removeTarget=t,this.cr(e)},e}($c),Zc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Gr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(ei(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(ei(void 0!==e),t.map(function(t){return function(t,e){var n=Gs(t.updateTime?t.updateTime:e);return n.isEqual(ci.min())&&(n=Gs(e)),new Ho(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Gs(t.commitTime);return this.listener.Tr(n,e)}return ei(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=$s(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ea(e.R,t)})};this.cr(n)},e}($c),th=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Gr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Hr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Hr(Qr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Hr(Qr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),eh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?($r(e),this.Vr=!1):Xr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),nh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Gr.b)(o,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return lh(this)?(Xr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return(e=ni(t)).Or.add(4),[4,ih(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,rh(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new eh(n,r)};function rh(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:if(!lh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ih(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function oh(t,e){var n=ni(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),hh(n)?ch(n):Sh(n).er()&&ah(n,e))}function sh(t,e){var n=ni(t),r=Sh(n);n.$r.delete(e),r.er()&&uh(n,e),0===n.$r.size&&(r.er()?r.ir():lh(n)&&n.Br.set("Unknown"))}function ah(t,e){t.qr.U(e.targetId),Sh(t).mr(e)}function uh(t,e){t.qr.U(e),Sh(t).yr(e)}function ch(t){t.qr=new Ps({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Sh(t).start(),t.Br.Sr()}function hh(t){return lh(t)&&!Sh(t).tr()&&t.$r.size>0}function lh(t){return 0===ni(t).Or.size}function fh(t){t.qr=void 0}function dh(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){return t.$r.forEach(function(e,n){ah(t,e)}),[2]})})}function ph(t,e){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(n){return fh(t),hh(t)?(t.Br.Nr(e),ch(t)):t.Br.set("Unknown"),[2]})})}function yh(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o;return Object(Gr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Cs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Gr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Xr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,gh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof xs?t.qr.X(e):e instanceof js?t.qr.rt(e):t.qr.et(e),n.isEqual(ci.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,cc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(vi.EMPTY_BYTE_STRING,n.snapshotVersion)),uh(t,e);var r=new eu(n.target,e,1,n.sequenceNumber);ah(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Xr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,gh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function gh(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r=this;return Object(Gr.d)(this,function(i){switch(i.label){case 0:if(!Qa(e))throw e;return t.Or.add(1),[4,ih(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return cc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Gr.b)(r,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return Xr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,rh(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function mh(t,e){return e().catch(function(n){return gh(t,n,e)})}function vh(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Gr.d)(this,function(s){switch(s.label){case 0:e=ni(t),n=Dh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return lh(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,fc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Dh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,gh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return bh(e)&&wh(e),[2]}})})}function bh(t){return lh(t)&&!Dh(t).tr()&&t.kr.length>0}function wh(t){Dh(t).start()}function Th(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){return Dh(t).Ar(),[2]})})}function Ih(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n,r;return Object(Gr.d)(this,function(i){for(e=Dh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Eh(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=tu.from(r,e,n),[4,mh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,vh(t)];case 2:return o.sent(),[2]}})})}function Oh(t,e){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e&&Dh(t).pr?[4,function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return fs(r=e.code)&&r!==Qr.ABORTED?(n=t.kr.shift(),Dh(t).sr(),[4,mh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,vh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return bh(t)&&wh(t),[2]}})})}function _h(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return n=ni(t),e?(n.Or.delete(2),[4,rh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,ih(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Sh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=ni(t);return r.br(),new Jc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:dh.bind(null,t),Ri:ph.bind(null,t),_r:yh.bind(null,t)}),t.Mr.push(function(n){return Object(Gr.b)(e,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),hh(t)?ch(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),fh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Dh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=ni(t);return r.br(),new Zc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Th.bind(null,t),Ri:Oh.bind(null,t),Ir:Ih.bind(null,t),Tr:Eh.bind(null,t)}),t.Mr.push(function(n){return Object(Gr.b)(e,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,vh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Xr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var kh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Va,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Hr(Qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Nh(t,e){if($r("AsyncQueue",e+": "+t),Qa(t))return new Hr(Qr.UNAVAILABLE,e+": "+t);throw t}var Ah=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ni.comparator(e.key,n.key)}:function(t,e){return Ni.comparator(t.key,e.key)},this.keyedMap=Is(),this.sortedSet=new ps(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),xh=function(){function t(){this.Kr=new ps(Ni.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):ti():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),jh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Ah.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&_o(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Ch=function(){this.Wr=void 0,this.listeners=[]},Rh=function(){this.queries=new qu(function(t){return So(t)},_o),this.onlineState="Unknown",this.Gr=new Set};function Ph(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Gr.d)(this,function(c){switch(c.label){case 0:if(n=ni(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Ch),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Nh(a,"Initialization of query '"+Do(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Fh(n),[2]}})})}function Uh(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Gr.d)(this,function(a){return n=ni(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Lh(t,e){for(var n=ni(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Fh(n)}function Mh(t,e,n){var r=ni(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Fh(t){t.Gr.forEach(function(t){t.next()})}var Vh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new jh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=jh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),qh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Bh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ws(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?ta(this.R,t.document,!1):Qi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Gs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Bh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ss()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return[4,bc(this.localStore,new Bh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,wc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new ec(Object.assign({},this.progress),t))]}})})}}();var Kh=function(t){this.key=t},Gh=function(t){this.key=t},zh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ss(),this.mutatedKeys=Ss(),this.lo=No(t),this.fo=new Ah(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new xh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=mo(this.query)&&i.size===this.query.limit?i.last():null,c=vo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=ko(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),mo(this.query)||vo(this.query))for(;s.size>this.query.limit;){var h=mo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ti()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new jh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new xh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ss(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Gh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Kh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ss();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return jh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Qh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Hh=function(t){this.key=t,this.bo=!1},Wh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new qu(function(t){return So(t)},_o),this.Vo=new Map,this.So=new Set,this.Do=new ps(Ni.comparator),this.Co=new Map,this.No=new Ic,this.xo={},this.Fo=new Map,this.ko=Nu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Yh(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:return n=Ol(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,dc(n.localStore,Eo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Xh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&oh(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Xh(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Gr.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,yc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(cl(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,yc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new zh(e,i.Bn),s=o._o(i.documents),a=As.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),cl(t,n,u.To),c=new Qh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function $h(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return n=ni(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!_o(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,pc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),sh(n.remoteStore,r.targetId),al(n,r.targetId)}).catch(Ru)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return al(n,r.targetId),[4,pc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Jh(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:r=_l(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=ni(t),i=ui.now(),o=e.reduce(function(t,e){return t.add(e.key)},Ss());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Zo(c,n.get(c.key));null!=h&&s.push(new rs(c.key,h,zi(h.value.mapValue),Wo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new ps(oi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,fl(r,i.changes)];case 3:return a.sent(),[4,vh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Nh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Zh(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:n=ni(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,hc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(ei(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?ei(r.bo):t.removedDocuments.size>0&&(ei(r.bo),r.bo=!1))}),[4,fl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ru(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function tl(t,e,n){var r=ni(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=ni(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Fh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function el(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Gr.d)(this,function(c){switch(c.label){case 0:return(r=ni(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new ps(Ni.comparator)).insert(o,Qi.newNoDocument(o,ci.min())),a=Ss().add(o),u=new Ns(ci.min(),new Map,new ms(oi),s,a),[4,Zh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),ll(r),[3,4];case 2:return[4,pc(r.localStore,e,!1).then(function(){return al(r,e,n)}).catch(Ru)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function nl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:n=ni(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,uc(n.localStore,e)];case 2:return i=o.sent(),sl(n,r,null),ol(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,fl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ru(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function rl(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:r=ni(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=ni(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return ei(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),sl(r,e,n),ol(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,fl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ru(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function il(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:lh((n=ni(t)).remoteStore)||Xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=ni(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Nh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function ol(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function sl(t,e,n){var r=ni(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function al(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||ul(t,e)})}function ul(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(sh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),ll(t))}function cl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Kh?(t.No.addReference(o.key,e),hl(t,o)):o instanceof Gh?(Xr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||ul(t,o.key)):ti()}}function hl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Xr("SyncEngine","New document in limbo: "+n),t.So.add(r),ll(t))}function ll(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ni(pi.fromString(e)),r=t.ko.next();t.Co.set(r,new Hh(n)),t.Do=t.Do.insert(n,r),oh(t.remoteStore,new eu(Eo(go(n.path)),r,2,zr.o))}}function fl(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:return r=ni(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=rc.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Gr.d)(this,function(h){switch(h.label){case 0:n=ni(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return qa.forEach(e,function(e){return qa.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return qa.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Qa(r=h.sent()))throw r;return Xr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function dl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return(n=ni(t)).currentUser.isEqual(e)?[3,3]:(Xr("SyncEngine","User change. New user:",e.toKey()),[4,ac(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Hr(Qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,fl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function pl(t,e){var n=ni(t),r=n.Co.get(e);if(r&&r.bo)return Ss().add(r.key);var i=Ss(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function yl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return[4,yc((n=ni(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&cl(n,e.targetId,i.To),i)]}})})}function gl(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){return[2,mc((e=ni(t)).localStore).then(function(t){return fl(e,t)})]})})}function ml(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o;return Object(Gr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=ni(t),r=ni(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):qa.resolve(null)})})}((i=ni(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,vh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(sl(i,e,r||null),ol(i,e),function(t,e){ni(ni(t)._n).Gt(e)}(i.localStore,e)):ti(),s.label=4;case 4:return[4,fl(i,o)];case 5:return s.sent(),[3,7];case 6:Xr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function vl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Gr.d)(this,function(c){switch(c.label){case 0:return Ol(n=ni(t)),_l(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,bl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,_h(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)oh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return al(n,e),pc(n.localStore,e,!0)}),sh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,bl(n,a)];case 5:return c.sent(),function(t){var e=ni(t);e.Co.forEach(function(t,n){sh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new ps(Ni.comparator)}(n),n.$o=!1,[4,_h(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function bl(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Gr.d)(this,function(y){switch(y.label){case 0:n=ni(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,dc(n.localStore,Eo(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,yl(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,gc(n.localStore,a)];case 8:return p=y.sent(),[4,dc(n.localStore,p)];case 9:return u=y.sent(),[4,Xh(n,wl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function wl(t){return yo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Tl(t){var e=ni(t);return ni(ni(e.localStore).persistence).fn()}function Il(t,e,n,r){return Object(Gr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Gr.d)(this,function(a){switch(a.label){case 0:return(i=ni(t)).$o?(Xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,mc(i.localStore)];case 3:return o=a.sent(),s=Ns.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,fl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,pc(i.localStore,e,!0)];case 6:return a.sent(),al(i,e,r),[3,8];case 7:ti(),a.label=8;case 8:return[2]}})})}function El(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Gr.d)(this,function(f){switch(f.label){case 0:if(!(r=Ol(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Xr("SyncEngine","Adding an already active target "+s),[3,5]):[4,gc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,dc(r.localStore,a)];case 3:return u=f.sent(),[4,Xh(r,wl(a),u.targetId,!1)];case 4:f.sent(),oh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,pc(r.localStore,t,!1).then(function(){sh(r.remoteStore,t),al(r,t)}).catch(Ru)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Ol(t){var e=ni(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=pl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=el.bind(null,e),e.vo._r=Lh.bind(null,e.eventManager),e.vo.Mo=Mh.bind(null,e.eventManager),e}function _l(t){var e=ni(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=nl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=rl.bind(null,e),e}var Sl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return this.R=Yc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return sc(this.persistence,new ic,t.initialUser,this.R)},t.prototype.qo=function(t){return new kc(Ac.bs,this.R)},t.prototype.Bo=function(t){return new qc},t.prototype.terminate=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Dl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Gr.c)(e,t),e.prototype.initialize=function(e){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,vc(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,_l(this.Ko.syncEngine)];case 4:return n.sent(),[4,vh(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return sc(this.persistence,new ic,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Lu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=tc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Tu.withCacheSize(this.cacheSizeBytes):Tu.DEFAULT;return new $u(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Hc(),Wc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new qc},e}(Sl),kl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Gr.c)(e,t),e.prototype.initialize=function(e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r=this;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Vc?(this.sharedClientState.syncEngine={ui:ml.bind(null,n),ai:Il.bind(null,n),hi:El.bind(null,n),fn:Tl.bind(null,n),ci:gl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Gr.b)(r,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return[4,vl(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Hc();if(!Vc.yt(e))throw new Hr(Qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=tc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Vc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Dl),Nl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n=this;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return tl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=dl.bind(null,this.syncEngine),[4,_h(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Rh},t.prototype.createDatastore=function(t){var e=Yc(t.databaseInfo.databaseId),n=new Qc(t.databaseInfo);return function(t,e,n){return new th(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return tl(s.syncEngine,t,0)},o=Kc.yt()?new Kc:new Bc,new nh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Wh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e=ni(t),Xr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,ih(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Al=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),xl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Va,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new qh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Gr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Hr(Qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Gr.d)(this,function(u){switch(u.label){case 0:return n=ni(t),r=$s(n.R)+"/documents",i={documents:e.map(function(t){return Hs(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){ei(!!e.found);var n=Ws(t,e.found.name),r=Gs(e.found.updateTime),i=new Gi({mapValue:{fields:e.found.fields}});return Qi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){ei(!!e.missing),ei(!!e.readTime);var n=Ws(t,e.missing),r=Gs(e.readTime);return Qi.newNoDocument(n,r)}(t,e):ti()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());ei(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new cs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Gr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Ni.fromPath(n);e.mutations.push(new hs(r,e.precondition(r)))}),[4,function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return n=ni(t),r=$s(n.R)+"/documents",i={writes:e.map(function(t){return ea(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw ti();e=ci.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Hr(Qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Wo.updateTime(e):Wo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ci.min()))throw new Hr(Qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Wo.updateTime(e)}return Wo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),jl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Xc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Gr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Gr.d)(this,function(r){return t=new xl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Si(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!fs(e)}return!1},t}(),Cl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=xc.UNAUTHENTICATED,this.clientId=ii.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(Gr.b)(r,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return Xr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Hr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Va;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Gr.b)(t,void 0,void 0,function(){var t,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Nh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Rl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Xr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(Gr.b)(i,void 0,void 0,function(){return Object(Gr.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,ac(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Pl(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Ul(t)];case 1:return n=i.sent(),Xr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(Gr.b)(this,void 0,void 0,function(){var n,r;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return(n=ni(t)).asyncQueue.verifyOperationInProgress(),Xr("RemoteStore","RemoteStore received new credentials"),r=lh(n),n.Or.add(3),[4,ih(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,rh(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Ul(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Xr("FirestoreClient","Using default OfflineComponentProvider"),[4,Rl(t,new Sl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Ll(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Xr("FirestoreClient","Using default OnlineComponentProvider"),[4,Pl(t,new Nl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Ml(t){return Ul(t).then(function(t){return t.persistence})}function Fl(t){return Ul(t).then(function(t){return t.localStore})}function Vl(t){return Ll(t).then(function(t){return t.remoteStore})}function ql(t){return Ll(t).then(function(t){return t.syncEngine})}function Bl(t){return Object(Gr.b)(this,void 0,void 0,function(){var e,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return[4,Ll(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Yh.bind(null,e.syncEngine),n.onUnlisten=$h.bind(null,e.syncEngine),n)]}})})}function Kl(t,e,n){var r=this;void 0===n&&(n={});var i=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(r,void 0,void 0,function(){var r;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Al({next:function(o){e.enqueueAndForget(function(){return Uh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Hr(Qr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Hr(Qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Vh(go(n.path),o,{includeMetadataChanges:!0,so:!0});return Ph(t,s)},[4,Bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Gl(t,e,n){var r=this;void 0===n&&(n={});var i=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(r,void 0,void 0,function(){var r;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Al({next:function(n){e.enqueueAndForget(function(){return Uh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Hr(Qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Vh(n,o,{includeMetadataChanges:!0,so:!0});return Ph(t,s)},[4,Bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var zl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Ql=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Hl=new Map,Wl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Yl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(xc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Xl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),$l=function(){function t(t){var e=this;this.currentUser=xc.UNAUTHENTICATED,this.oc=new Va,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Xr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Xr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Xr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ei("string"==typeof n.accessToken),new Wl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(Gr.b)(n,void 0,void 0,function(){return Object(Gr.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return ei(null===t||"string"==typeof t),new xc(t)},t}(),Jl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=xc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Zl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Jl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(xc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function tf(t,e,n){if(!n)throw new Hr(Qr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function ef(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function nf(t,e,n,r){if(!0===e&&!0===r)throw new Hr(Qr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function rf(t){if(!Ni.isDocumentKey(t))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function of(t){if(Ni.isDocumentKey(t))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function sf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":ti()}function af(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Hr(Qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=sf(t);throw new Hr(Qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function uf(t,e){if(e<=0)throw new Hr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var cf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Hr(Qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Hr(Qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,nf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),hf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cf({}),this._settingsFrozen=!1,t instanceof Ql?(this._databaseId=t,this._credentials=new Yl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Hr(Qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ql(t.options.projectId)}(t),this._credentials=new $l(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Hr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Hr(Qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Yl;switch(t.type){case"gapi":var e=t.client;return ei(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Zl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Hr(Qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Hl.get(this))&&(Xr("ComponentProvider","Removing Datastore"),Hl.delete(this),t.terminate()),Promise.resolve();var t},t}(),lf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new df(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ff=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),df=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,go(r))||this)._path=r,i.type="collection",i}return Object(Gr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new lf(this.firestore,null,new Ni(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ff);function pf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(C.h)(t),tf("collection","path",e),t instanceof hf)return of(n=pi.fromString.apply(pi,Object(Gr.f)([e],r))),new df(t,null,n);if(!(t instanceof lf||t instanceof df))throw new Hr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return of(n=pi.fromString.apply(pi,Object(Gr.f)([t.path],r)).child(pi.fromString(e))),new df(t.firestore,null,n)}function yf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(C.h)(t),1===arguments.length&&(e=ii.u()),tf("doc","path",e),t instanceof hf)return rf(n=pi.fromString.apply(pi,Object(Gr.f)([e],r))),new lf(t,null,new Ni(n));if(!(t instanceof lf||t instanceof df))throw new Hr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return rf(n=t._path.child(pi.fromString.apply(pi,Object(Gr.f)([e],r)))),new lf(t.firestore,t instanceof df?t.converter:null,new Ni(n))}function gf(t,e){return t=Object(C.h)(t),e=Object(C.h)(e),(t instanceof lf||t instanceof df)&&(e instanceof lf||e instanceof df)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function mf(t,e){return t=Object(C.h)(t),e=Object(C.h)(e),t instanceof ff&&e instanceof ff&&t.firestore===e.firestore&&_o(t._query,e._query)&&t.converter===e.converter}var vf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new Xc(this,"async_queue_retry"),this.Tc=function(){var e=Wc();e&&Xr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Wc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Wc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Gr.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Qa(t=n.sent()))throw t;return Xr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,$r("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=kh.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&ti()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(Gr.b)(this,void 0,void 0,function(){var t;return Object(Gr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function bf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Va,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var wf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new vf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Gr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||If(this),this._firestoreClient.terminate()},e}(hf);function Tf(t){return t._firestoreClient||If(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function If(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new zl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Cl(t._credentials,t._queue,r)}function Ef(t,e,n){var r=this,i=new Va;return t.asyncQueue.enqueue(function(){return Object(Gr.b)(r,void 0,void 0,function(){var r;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Rl(t,n)];case 1:return o.sent(),[4,Pl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Qr.FAILED_PRECONDITION||t.code===Qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Of(t){if(t._initialized||t._terminated)throw new Hr(Qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var _f=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Sf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(vi.fromBase64String(e))}catch(e){throw new Hr(Qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(vi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Df=function(t){this._methodName=t},kf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Hr(Qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Hr(Qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return oi(this._lat,t._lat)||oi(this._long,t._long)},t}(),Nf=/^__.*__$/,Af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new rs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ns(t,this.data,e,this.fieldTransforms)},t}(),xf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new rs(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function jf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ti()}}var Cf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return Zf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(jf(this.Cc)&&Nf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),Rf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Yc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new Cf({Cc:t,methodName:e,Bc:n,path:gi.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Pf(t){var e=t._freezeSettings(),n=Yc(t._databaseId);return new Rf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Uf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Yf("Data must be an object, but it was:",s,r);var a,u,c=Hf(r,s);if(o.merge)a=new mi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Xf(e,f[l],n);if(!s.contains(d))throw new Hr(Qr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");td(h,d)||h.push(d)}a=new mi(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Af(new Gi(c),a,u)}var Lf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Df);function Mf(t,e,n){return new Cf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype._toFieldTransform=function(t){return new Qo(t.path,new Mo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Df),Vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Gr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Mf(this,t,!0),n=this.Uc.map(function(t){return Qf(t,e)}),r=new Fo(n);return new Qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),qf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Gr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Mf(this,t,!0),n=this.Uc.map(function(t){return Qf(t,e)}),r=new qo(n);return new Qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),Bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(Gr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Ko(t.R,Co(t.R,this.Qc));return new Qo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Df);function Kf(t,e,n,r){var i=t.qc(1,e,n);Yf("Data must be an object, but it was:",i,r);var o=[],s=Gi.empty();li(r,function(t,r){var a=Jf(e,t,n);r=Object(C.h)(r);var u=i.$c(a);if(r instanceof Lf)o.push(a);else{var c=Qf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new mi(o);return new xf(s,a,i.fieldTransforms)}function Gf(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Xf(e,r,n)],u=[i];if(o.length%2!=0)throw new Hr(Qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Xf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Gi.empty(),f=a.length-1;f>=0;--f)if(!td(h,a[f])){var d=a[f],p=u[f];p=Object(C.h)(p);var y=s.$c(d);if(p instanceof Lf)h.push(d);else{var g=Qf(p,y);null!=g&&(h.push(d),l.set(d,g))}}var m=new mi(h);return new xf(l,m,s.fieldTransforms)}function zf(t,e,n,r){return void 0===r&&(r=!1),Qf(n,t.qc(r?4:3,e))}function Qf(t,e){if(Wf(t=Object(C.h)(t)))return Yf("Unsupported field value:",e,t),Hf(t,e);if(t instanceof Df)return function(t,e){if(!jf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Qf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(C.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Co(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ui.fromDate(t);return{timestampValue:qs(e.R,n)}}if(t instanceof ui)return n=new ui(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:qs(e.R,n)};if(t instanceof kf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Sf)return{bytesValue:Bs(e.R,t._byteString)};if(t instanceof lf){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:zs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+sf(t))}(t,e)}function Hf(t,e){var n={};return fi(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):li(t,function(t,r){var i=Qf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Wf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ui||t instanceof kf||t instanceof Sf||t instanceof lf||t instanceof Df)}function Yf(t,e,n){if(!Wf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=sf(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Xf(t,e,n){if((e=Object(C.h)(e))instanceof _f)return e._internalPath;if("string"==typeof e)return Jf(t,e);throw Zf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var $f=new RegExp("[~\\*/\\[\\]]");function Jf(t,e,n){if(e.search($f)>=0)throw Zf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(_f.bind.apply(_f,Object(Gr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Zf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Zf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Hr(Qr.INVALID_ARGUMENT,(a+=". ")+t+u)}function td(t,e){return t.some(function(t){return t.isEqual(e)})}var ed=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new lf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new nd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(rd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),nd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(ed);function rd(t,e){return"string"==typeof e?Jf(t,e):e instanceof _f?e._internalPath:e._delegate._internalPath}var id=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),od=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Gr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(rd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(ed),sd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(od),ad=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new id(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new sd(n._firestore,n._userDataWriter,r.key,r,new id(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Hr(Qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new id(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new id(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:ud(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function ud(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ti()}}function cd(t,e){return t instanceof od&&e instanceof od?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof ad&&e instanceof ad&&t._firestore===e._firestore&&mf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function hd(t){if(vo(t)&&0===t.explicitOrderBy.length)throw new Hr(Qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ld=function(){};function fd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var dd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Kc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(Gr.c)(e,t),e.prototype._apply=function(t){var e=Pf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){wd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(bd(r,t,h[c]));a={arrayValue:{values:u}}}else a=bd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||wd(s,o),a=zf(n,"where",s,"in"===o||"not-in"===o);var l=Ji.create(i,o,a);return function(t,e){if(e.g()){var n=wo(t);if(null!==n&&!n.isEqual(e.field))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=bo(t);null!==r&&Td(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Hr(Qr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Kc,this.jc,this.Wc);return new ff(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(ld),pd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Kc=e,r.Gc=n,r.type="orderBy",r}return Object(Gr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new co(e,n);return function(t,e){if(null===bo(t)){var n=wo(t);null!==n&&Td(0,n,e.field)}}(t,r),r}(t._query,this.Kc,this.Gc);return new ff(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new po(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(ld),yd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(Gr.c)(e,t),e.prototype._apply=function(t){return new ff(t.firestore,t.converter,Oo(t._query,this.zc,this.Hc))},e}(ld),gd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(Gr.c)(e,t),e.prototype._apply=function(t){var e=vd(t,this.type,this.Jc,this.Yc);return new ff(t.firestore,t.converter,function(t,e){return new po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(ld),md=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(Gr.c)(e,t),e.prototype._apply=function(t){var e=vd(t,this.type,this.Jc,this.Yc);return new ff(t.firestore,t.converter,function(t,e){return new po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(ld);function vd(t,e,n,r){if(n[0]=Object(C.h)(n[0]),n[0]instanceof ed)return function(t,e,n,r,i){if(!r)throw new Hr(Qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Io(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Li(e,r.key));else{var c=r.data.field(u.field);if(Ei(c))throw new Hr(Qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new ao(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Pf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Hr(Qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!To(t)&&-1!==c.indexOf("/"))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(pi.fromString(c));if(!Ni.isDocumentKey(h))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ni(h);a.push(Li(e,l))}else{var f=zf(n,r,c);a.push(f)}}return new ao(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function bd(t,e,n){if("string"==typeof(n=Object(C.h)(n))){if(""===n)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!To(e)&&-1!==n.indexOf("/"))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(pi.fromString(n));if(!Ni.isDocumentKey(r))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Li(t,new Ni(r))}if(n instanceof lf)return Li(t,n._key);throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+sf(n)+".")}function wd(t,e){if(!Array.isArray(t)||0===t.length)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Td(t,e,n){if(!n.isEqual(e))throw new Hr(Qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Id=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ai(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ti(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ii(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ti()}},t.prototype.convertObject=function(t,e){var n=this,r={};return li(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new kf(Ti(t.latitude),Ti(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Oi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(_i(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=wi(t);return new ui(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=pi.fromString(t);ei(ga(n));var r=new Ql(n.get(1),n.get(3)),i=new Ni(n.popFirst(5));return r.isEqual(e)||$r("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Ed(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Od=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Gr.c)(e,t),e.prototype.convertBytes=function(t){return new Sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new lf(this.firestore,null,e)},e}(Id),_d=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Pf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Sd(t,this._firestore),i=Ed(r.converter,e,n),o=Uf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Wo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Sd(t,this._firestore);return o="string"==typeof(e=Object(C.h)(e))||e instanceof _f?Gf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Kf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Wo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Sd(t,this._firestore);return this._mutations=this._mutations.concat(new cs(e._key,Wo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Hr(Qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Sd(t,e){if((t=Object(C.h)(t)).firestore!==e)throw new Hr(Qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Gr.c)(e,t),e.prototype.convertBytes=function(t){return new Sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new lf(this.firestore,null,e)},e}(Id);function kd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=af(t,lf);var o=af(t.firestore,wf),s=Pf(o);return Ad(o,[("string"==typeof(e=Object(C.h)(e))||e instanceof _f?Gf(s,"updateDoc",t._key,e,n,r):Kf(s,"updateDoc",t._key,e)).toMutation(t._key,Wo.exists(!0))])}function Nd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(C.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||bf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(bf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof lf)c=af(t.firestore,wf),h=go(t._key.path),u={next:function(e){i[a]&&i[a](xd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=af(t,ff);c=af(d.firestore,wf),h=d._query;var p=new Dd(c);u={next:function(t){i[a]&&i[a](new ad(c,p,d,t))},error:i[a+1],complete:i[a+2]},hd(t._query)}return function(t,e,n,r){var i=this,o=new Al(r),s=new Vh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(i,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e=Ph,[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(i,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e=Uh,[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(Tf(c),h,l,u)}function Ad(t,e){return function(t,e){var n=this,r=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var n;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return n=Jh,[4,ql(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Tf(t),e)}function xd(t,e,n){var r=n.docs.get(e._key),i=new Dd(t);return new od(t,i,e._key,r,new id(n.hasPendingWrites,n.fromCache),e.converter)}var jd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Gr.c)(e,t),e.prototype.get=function(e){var n=this,r=Sd(e,this._firestore),i=new Dd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new od(n._firestore,i,r._key,t._document,new id(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Pf(t)}return t.prototype.get=function(t){var e=this,n=Sd(t,this._firestore),r=new Od(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return ti();var i=t[0];if(i.isFoundDocument())return new ed(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new ed(e._firestore,r,n._key,null,n.converter);throw ti()})},t.prototype.set=function(t,e,n){var r=Sd(t,this._firestore),i=Ed(r.converter,e,n),o=Uf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Sd(t,this._firestore);return o="string"==typeof(e=Object(C.h)(e))||e instanceof _f?Gf(this._dataReader,"Transaction.update",s._key,e,n,r):Kf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Sd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Cd(){if("undefined"==typeof Uint8Array)throw new Hr(Qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Rd(){if("undefined"==typeof atob)throw new Hr(Qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Pd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Rd(),new t(Sf.fromBase64String(e))},t.fromUint8Array=function(e){return Cd(),new t(Sf.fromUint8Array(e))},t.prototype.toBase64=function(){return Rd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Cd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Ud=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Of(t=af(t,wf));var n=Tf(t),r=t._freezeSettings(),i=new Nl;return Ef(n,i,new Dl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Of(t=af(t,wf));var e=Tf(t),n=t._freezeSettings(),r=new Nl;return Ef(e,r,new kl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Hr(Qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Va;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Gr.b)(e,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Gr.b)(this,void 0,void 0,function(){return Object(Gr.d)(this,function(e){switch(e.label){case 0:return Ka.yt()?[4,Ka.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(tc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Ld=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Ql||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Jr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=af(t,hf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(C.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Hr(Qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Xl(new Wl(o,new xc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Gr.b)(e,void 0,void 0,function(){var e,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return[4,Ml(t)];case 1:return e=r.sent(),[4,Vl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=ni(t);return e.Or.delete(0),rh(e)}(n))]}})})})}(Tf(af(this._delegate,wf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Gr.b)(e,void 0,void 0,function(){var e,n;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return[4,Ml(t)];case 1:return e=r.sent(),[4,Vl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Gr.b)(this,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return(e=ni(t)).Or.add(0),[4,ih(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Tf(af(this._delegate,wf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&nf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(e,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(r){switch(r.label){case 0:return e=il,[4,ql(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Tf(af(this._delegate,wf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Al(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ni(t).Gr.add(e),e.next()},[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var e;return Object(Gr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ni(t).Gr.delete(e)},[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Tf(t=af(t,wf)),bf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new Hr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new $d(this,pf(this._delegate,t))}catch(t){throw Kd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Bd(this,yf(this._delegate,t))}catch(t){throw Kd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Wd(this,function(t,e){if(t=af(t,hf),tf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ff(t,null,function(t){return new po(pi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Kd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var n;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Ll(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new jl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Tf(t),function(n){return e(new jd(t,n))})}(this._delegate,function(n){return t(new Fd(e,n))})},t.prototype.batch=function(){var t=this;return Tf(this._delegate),new Vd(new _d(this._delegate,function(e){return Ad(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Hr(Qr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Hr(Qr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Md=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Gr.c)(e,t),e.prototype.convertBytes=function(t){return new Pd(new Sf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Bd.tu(e,this.firestore,null)},e}(Id),Fd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.prototype.get=function(t){var e=this,n=Jd(t);return this._delegate.get(n).then(function(t){return new Qd(e._firestore,new od(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Jd(t);return n?(ef("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Jd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Gr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Jd(t);return this._delegate.delete(e),this},t}(),Vd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Jd(t);return n?(ef("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Jd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Gr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Jd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),qd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new sd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Hd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Md(e),n),i.set(n,o)),o},t}();qd.nu=new WeakMap;var Bd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new Hr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new lf(n._delegate,r,new Ni(e)))},t.tu=function(e,n,r){return new t(n,new lf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new $d(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new $d(this.firestore,pf(this._delegate,t))}catch(t){throw Kd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(C.h)(t))instanceof lf&&gf(this._delegate,t)},t.prototype.set=function(t,e){e=ef("DocumentReference.set",e);try{return function(t,e,n){t=af(t,lf);var r=af(t.firestore,wf),i=Ed(t.converter,e,n);return Ad(r,[Uf(Pf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Wo.none())])}(this._delegate,t,e)}catch(t){throw Kd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?kd(this._delegate,t):kd.apply(void 0,Object(Gr.f)([this._delegate,t,e],n))}catch(t){throw Kd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Ad(af((t=this._delegate).firestore,wf),[new cs(t._key,Wo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Gd(e),i=zd(e,function(e){return new Qd(t.firestore,new od(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Nd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=af(t,lf);var e=af(t.firestore,wf),n=Tf(e),r=new Dd(e);return function(t,e){var n=this,r=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var n;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i;return Object(Gr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=ni(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Hr(Qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Nh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Fl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new od(e,r,t._key,n,new id(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=af(t,lf);var e=af(t.firestore,wf);return Kl(Tf(e),t._key,{source:"server"}).then(function(n){return xd(e,t,n)})}(this._delegate):function(t){t=af(t,lf);var e=af(t.firestore,wf);return Kl(Tf(e),t._key).then(function(n){return xd(e,t,n)})}(this._delegate)).then(function(t){return new Qd(e.firestore,new od(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?qd.eu(this.firestore,e):null))},t}();function Kd(t,e,n){return t.message=t.message.replace(e,n),t}function Gd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!bf(r))return r}return{}}function zd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=bf(t[0])?t[0]:bf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Qd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Bd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return cd(this._delegate,t._delegate)},t}(),Hd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Gr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Qd),Wd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,fd(this._delegate,function(t,e,n){var r=e,i=rd("where",t);return new dd(i,r,n)}(e,n,r)))}catch(e){throw Kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,fd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=rd("orderBy",t);return new pd(r,n)}(e,n)))}catch(e){throw Kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,fd(this._delegate,function(t){return uf("limit",t),new yd("limit",t,"F")}(e)))}catch(e){throw Kd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,fd(this._delegate,function(t){return uf("limitToLast",t),new yd("limitToLast",t,"L")}(e)))}catch(e){throw Kd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,fd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Kd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,fd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Kd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,fd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new md("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Kd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,fd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new md("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Kd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return mf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=af(t,ff);var e=af(t.firestore,wf),n=Tf(e),r=new Dd(e);return function(t,e){var n=this,r=new Va;return t.asyncQueue.enqueueAndForget(function(){return Object(Gr.b)(n,void 0,void 0,function(){var n;return Object(Gr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Gr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Gr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,yc(t,e,!0)];case 1:return a=u.sent(),r=new zh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Nh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Fl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new ad(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=af(t,ff);var e=af(t.firestore,wf),n=Tf(e),r=new Dd(e);return Gl(n,t._query,{source:"server"}).then(function(n){return new ad(e,r,t,n)})}(this._delegate):function(t){t=af(t,ff);var e=af(t.firestore,wf),n=Tf(e),r=new Dd(e);return hd(t._query),Gl(n,t._query).then(function(n){return new ad(e,r,t,n)})}(this._delegate)).then(function(t){return new Xd(e.firestore,new ad(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Gd(e),i=zd(e,function(e){return new Xd(t.firestore,new ad(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Nd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?qd.eu(this.firestore,e):null))},t}(),Yd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Hd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Xd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Wd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Hd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Yd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Hd(n._firestore,r))})},t.prototype.isEqual=function(t){return cd(this._delegate,t._delegate)},t}(),$d=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Gr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Bd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Bd(this.firestore,void 0===t?yf(this._delegate):yf(this._delegate,t))}catch(t){throw Kd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=af(t.firestore,wf),r=yf(t),i=Ed(t.converter,e);return Ad(n,[Uf(Pf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Wo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Bd(e.firestore,t)})},e.prototype.isEqual=function(t){return gf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?qd.eu(this.firestore,t):null))},e}(Wd);function Jd(t){return af(t,lf)}var Zd,tp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(_f.bind.apply(_f,Object(Gr.f)([void 0],t)))}return t.documentId=function(){return new t(gi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(C.h)(t))instanceof _f&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),ep=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Ff("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Lf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Bf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),np=n("/6Yf"),rp={Firestore:Ld,GeoPoint:kf,Timestamp:ui,Blob:Pd,Transaction:Fd,WriteBatch:Vd,DocumentReference:Bd,DocumentSnapshot:Qd,Query:Wd,QueryDocumentSnapshot:Hd,QuerySnapshot:Xd,CollectionReference:$d,FieldPath:tp,FieldValue:ep,setLogLevel:function(t){Wr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new np.a("firestore",function(t){return function(t,e){return new Ld(t,new wf(t,e),new Ud)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},rp)))})(Zd=j.a),Zd.registerVersion("@firebase/firestore","2.3.7");var ip=n("VRCc");function op(t,e){return function(t,e=b.b){return new w.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function sp(t,e){return op(t,e).pipe(Object(_.a)(t=>({payload:t,type:"query"})))}function ap(t,e){return sp(t,e).pipe(Object(E.a)(void 0),Object(O.a)(),Object(_.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function up(t,e,n){return ap(t,n).pipe(Object(S.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return cp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return cp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(D.a)(),Object(_.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function cp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function hp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class lp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=ap(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(_.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(E.a)(void 0),Object(O.a)(),Object(k.a)(([t,e])=>e.length>0||!t),Object(_.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(S.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=hp(t);return up(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return sp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(_.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(T.a)(this.query.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new fp(this.ref.doc(t),this.afs)}}class fp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=vp(n,e);return new lp(r,i,this.afs)}snapshotChanges(){return op(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(E.a)(void 0),Object(O.a)(),Object(_.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(_.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(T.a)(this.ref.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}}class dp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?ap(this.query,this.afs.schedulers.outsideAngular).pipe(Object(_.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(k.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):ap(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(S.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=hp(t);return up(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return sp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(_.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(T.a)(this.query.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}}const pp=new i.s("angularfire2.enableFirestorePersistence"),yp=new i.s("angularfire2.firestore.persistenceSettings"),gp=new i.s("angularfire2.firestore.settings"),mp=new i.s("angularfire2.firestore.use-emulator");function vp(t,e=(t=>t)){return{query:e(t),ref:t}}let bp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new A.d(s),this.keepUnstableUntilFirst=Object(A.h)(this.schedulers);const h=Object(A.g)(t,s,e);!x.a.auth&&c&&Object(A.j)();const l=u;[this.firestore,this.persistenceEnabled$]=Object(A.f)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!Object(r.u)(o)){const e=()=>{try{return Object(T.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(Zd){return"undefined"!=typeof console&&console.warn(Zd),Object(I.a)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,Object(I.a)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=vp(n,e),o=this.schedulers.ngZone.run(()=>r);return new lp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new dp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new fp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.Yb(A.c),i.Yb(A.b,8),i.Yb(pp,8),i.Yb(gp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(yp,8),i.Yb(mp,8),i.Yb(ip.b,8))},t.\u0275prov=i.Kb({factory:function(){return new t(i.Yb(A.c),i.Yb(A.b,8),i.Yb(pp,8),i.Yb(gp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(yp,8),i.Yb(mp,8),i.Yb(ip.b,8))},token:t,providedIn:"any"}),t})();var wp=n("kmnG"),Tp=n("qFsG"),Ip=n("3Pt+");let Ep=(()=>{class t{constructor(t,e,n,r,i){this.dialogRef=t,this.data=e,this.api=n,this.db=r,this.auth=i,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("books").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else this.db.collection("books/").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat memperbarui data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.g),i.Ob(m.a),i.Ob(o.a),i.Ob(bp),i.Ob(ip.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product-detail"]],decls:36,vars:9,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","type","number",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.Ub(0,"h3",0),i.yc(1," Detail Product "),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"mat-form-field",2),i.Ub(4,"mat-label"),i.yc(5,"ID Buku"),i.Tb(),i.Ub(6,"input",3),i.bc("ngModelChange",function(t){return e.data.Kode=t}),i.Tb(),i.Tb(),i.Ub(7,"mat-form-field",2),i.Ub(8,"mat-label"),i.yc(9,"Judul"),i.Tb(),i.Ub(10,"input",3),i.bc("ngModelChange",function(t){return e.data.title=t}),i.Tb(),i.Tb(),i.Ub(11,"mat-form-field",2),i.Ub(12,"mat-label"),i.yc(13,"Penulis"),i.Tb(),i.Ub(14,"input",3),i.bc("ngModelChange",function(t){return e.data.author=t}),i.Tb(),i.Tb(),i.Ub(15,"mat-form-field",2),i.Ub(16,"mat-label"),i.yc(17,"Penerbit"),i.Tb(),i.Ub(18,"input",3),i.bc("ngModelChange",function(t){return e.data.publisher=t}),i.Tb(),i.Tb(),i.Ub(19,"mat-form-field",2),i.Ub(20,"mat-label"),i.yc(21,"Tahun terbit"),i.Tb(),i.Ub(22,"input",3),i.bc("ngModelChange",function(t){return e.data.year=t}),i.Tb(),i.Tb(),i.Ub(23,"mat-form-field",2),i.Ub(24,"mat-label"),i.yc(25,"ISBN"),i.Tb(),i.Ub(26,"input",3),i.bc("ngModelChange",function(t){return e.data.isbn=t}),i.Tb(),i.Tb(),i.Ub(27,"mat-form-field",2),i.Ub(28,"mat-label"),i.yc(29,"Harga"),i.Tb(),i.Ub(30,"input",4),i.bc("ngModelChange",function(t){return e.data.price=t}),i.Tb(),i.Tb(),i.Tb(),i.Ub(31,"div",5),i.Ub(32,"button",6),i.yc(33,"Batal"),i.Tb(),i.Ub(34,"button",7),i.bc("click",function(){return e.saveData()}),i.yc(35),i.Tb(),i.Tb()),2&t&&(i.Db(6),i.kc("ngModel",e.data.Kode),i.Db(4),i.kc("ngModel",e.data.title),i.Db(4),i.kc("ngModel",e.data.author),i.Db(4),i.kc("ngModel",e.data.publisher),i.Db(4),i.kc("ngModel",e.data.year),i.Db(4),i.kc("ngModel",e.data.isbn),i.Db(4),i.kc("ngModel",e.data.price),i.Db(4),i.kc("disabled",e.loading),i.Db(1),i.zc(e.loading?"Menyimpan..":"Simpan"))},directives:[m.h,m.e,wp.b,wp.e,Tp.b,Ip.c,Ip.j,Ip.l,Ip.m,m.c,u.a,m.d],styles:[""]}),t})();var Op=n("Xa2L"),_p=n("Wp6s");function Sp(t,e){1&t&&(i.Ub(0,"div",2),i.Pb(1,"mat-spinner"),i.Tb())}function Dp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"button",12),i.bc("click",function(){i.rc(t);const e=i.fc().$implicit;return i.fc(2).downloadFile(e)}),i.Ub(1,"mat-icon"),i.yc(2,"download"),i.Tb(),i.Tb()}}function kp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"tr"),i.Ub(1,"td"),i.xc(2,Dp,3,0,"button",9),i.Tb(),i.Ub(3,"td"),i.yc(4),i.Tb(),i.Ub(5,"td"),i.yc(6),i.Tb(),i.Ub(7,"td"),i.yc(8),i.Tb(),i.Ub(9,"td"),i.yc(10),i.Tb(),i.Ub(11,"td"),i.yc(12),i.Tb(),i.Ub(13,"td"),i.yc(14),i.Tb(),i.Ub(15,"td"),i.yc(16),i.Tb(),i.Ub(17,"td"),i.yc(18),i.Tb(),i.Ub(19,"td",7),i.Ub(20,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit;return i.fc(2).uploadFile(n)}),i.yc(21,"Upload"),i.Tb(),i.Ub(22,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).ProductDetail(n,r)}),i.yc(23,"Edit"),i.Tb(),i.Ub(24,"button",11),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).DeleteProduct(n.id,r)}),i.yc(25),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=i.fc(2);i.Db(2),i.kc("ngIf",""!=t.url),i.Db(2),i.zc(n+1),i.Db(2),i.zc(t.Kode),i.Db(2),i.zc(t.title),i.Db(2),i.zc(t.author),i.Db(2),i.zc(t.publisher),i.Db(2),i.zc(t.year),i.Db(2),i.zc(t.isbn),i.Db(2),i.zc(t.price),i.Db(6),i.kc("disabled",r.loadingDelete[n]),i.Db(1),i.zc(r.loadingDelete[n]?"Menghapus..":"Delete")}}function Np(t,e){if(1&t){const t=i.Vb();i.Ub(0,"mat-card"),i.Ub(1,"mat-card-header"),i.Ub(2,"mat-card-title"),i.yc(3),i.Tb(),i.Tb(),i.Ub(4,"mat-card-content"),i.Ub(5,"div",3),i.Pb(6,"span",4),i.Ub(7,"button",5),i.bc("click",function(){return i.rc(t),i.fc().ProductDetail({},-1)}),i.yc(8,"Tambah Product"),i.Tb(),i.Tb(),i.Ub(9,"table",6),i.Ub(10,"thead"),i.Pb(11,"th"),i.Ub(12,"th"),i.yc(13,"No"),i.Tb(),i.Ub(14,"th"),i.yc(15,"Kode Buku"),i.Tb(),i.Ub(16,"th"),i.yc(17,"Judul"),i.Tb(),i.Ub(18,"th"),i.yc(19,"Penulis"),i.Tb(),i.Ub(20,"th"),i.yc(21,"Penerbit"),i.Tb(),i.Ub(22,"th"),i.yc(23,"Tahun Terbit"),i.Tb(),i.Ub(24,"th"),i.yc(25,"ISBN"),i.Tb(),i.Ub(26,"th"),i.yc(27,"Harga"),i.Tb(),i.Pb(28,"th",7),i.Tb(),i.Ub(29,"tbody"),i.xc(30,kp,26,11,"tr",8),i.Tb(),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=i.fc();i.Db(3),i.zc(t.title),i.Db(27),i.kc("ngForOf",t.books)}}let Ap=(()=>{class t{constructor(t,e,n){this.dialog=t,this.db=e,this.auth=n,this.books=[],this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Produk",this.auth.user.subscribe(t=>{this.userData=t,this.getBooks()})}getBooks(){this.loading=!0,this.db.collection("books",t=>t.where("uid","==",this.userData.uid)).valueChanges().subscribe(t=>{console.log(t),this.books=t,this.loading=!1},t=>{this.loading=!1})}ProductDetail(t,e){this.dialog.open(Ep,{width:"400px",data:t}).afterClosed().subscribe(n=>{n&&(-1==e?this.books.push(n):this.books[e]=t)})}DeleteProduct(t,e){confirm("Delete item?")&&(this.loadingDelete[e]=!0),this.db.collection("books/").doc(t).delete().then(t=>{this.books.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}uploadFile(t){this.dialog.open(v,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}downloadFile(t){g.saveAs("http://api.sunhouse.co.id/bookstore/"+t.url)}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.b),i.Ob(bp),i.Ob(ip.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"disabled","click"],["mat-icon-button","",3,"click"]],template:function(t,e){1&t&&(i.xc(0,Sp,2,0,"div",0),i.xc(1,Np,31,2,"mat-card",1)),2&t&&(i.kc("ngIf",e.loading),i.Db(1),i.kc("ngIf",!e.loading))},directives:[r.k,Op.b,_p.a,_p.c,_p.e,_p.b,u.a,r.j,c.a],styles:[""]}),t})();var xp=n("tk/3");let jp=(()=>{class t{constructor(t,e,n,r){this.dialogRef=t,this.data=e,this.db=n,this.auth=r,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}simpanData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("Pinjams").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else this.db.collection("Pinjams/").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat memperbarui data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.g),i.Ob(m.a),i.Ob(bp),i.Ob(ip.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-pinjam-detail"]],decls:48,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","type","date",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.Ub(0,"h3",0),i.yc(1," Detail Product "),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"mat-form-field",2),i.Ub(4,"mat-label"),i.yc(5,"ID Transaksi"),i.Tb(),i.Ub(6,"input",3),i.bc("ngModelChange",function(t){return e.data.IDTransaksi=t}),i.Tb(),i.Tb(),i.Ub(7,"mat-form-field",2),i.Ub(8,"mat-label"),i.yc(9,"ID Anggota"),i.Tb(),i.Ub(10,"input",3),i.bc("ngModelChange",function(t){return e.data.IDAnggota=t}),i.Tb(),i.Tb(),i.Ub(11,"mat-form-field",2),i.Ub(12,"mat-label"),i.yc(13,"Nama"),i.Tb(),i.Ub(14,"input",3),i.bc("ngModelChange",function(t){return e.data.Nama=t}),i.Tb(),i.Tb(),i.Ub(15,"mat-form-field",2),i.Ub(16,"mat-label"),i.yc(17,"No Hp"),i.Tb(),i.Ub(18,"input",3),i.bc("ngModelChange",function(t){return e.data.NoHp=t}),i.Tb(),i.Tb(),i.Ub(19,"mat-form-field",2),i.Ub(20,"mat-label"),i.yc(21,"Alamat"),i.Tb(),i.Ub(22,"input",3),i.bc("ngModelChange",function(t){return e.data.Alamat=t}),i.Tb(),i.Tb(),i.Ub(23,"mat-form-field",2),i.Ub(24,"mat-label"),i.yc(25,"Judul Buku"),i.Tb(),i.Ub(26,"input",3),i.bc("ngModelChange",function(t){return e.data.JudulBuku=t}),i.Tb(),i.Tb(),i.Ub(27,"mat-form-field",2),i.Ub(28,"mat-label"),i.yc(29,"Kode Buku"),i.Tb(),i.Ub(30,"input",3),i.bc("ngModelChange",function(t){return e.data.KodeBuku=t}),i.Tb(),i.Tb(),i.Ub(31,"mat-form-field",2),i.Ub(32,"mat-label"),i.yc(33,"Tanggal Pinjam"),i.Tb(),i.Ub(34,"input",4),i.bc("ngModelChange",function(t){return e.data.TanggalPinjam=t}),i.Tb(),i.Tb(),i.Ub(35,"mat-form-field",2),i.Ub(36,"mat-label"),i.yc(37,"Tanggal Kembali"),i.Tb(),i.Ub(38,"input",4),i.bc("ngModelChange",function(t){return e.data.TanggalKembali=t}),i.Tb(),i.Tb(),i.Ub(39,"mat-form-field",2),i.Ub(40,"mat-label"),i.yc(41,"Status"),i.Tb(),i.Ub(42,"input",3),i.bc("ngModelChange",function(t){return e.data.Status=t}),i.Tb(),i.Tb(),i.Tb(),i.Ub(43,"div",5),i.Ub(44,"button",6),i.yc(45,"Batal"),i.Tb(),i.Ub(46,"button",7),i.bc("click",function(){return e.simpanData()}),i.yc(47),i.Tb(),i.Tb()),2&t&&(i.Db(6),i.kc("ngModel",e.data.IDTransaksi),i.Db(4),i.kc("ngModel",e.data.IDAnggota),i.Db(4),i.kc("ngModel",e.data.Nama),i.Db(4),i.kc("ngModel",e.data.NoHp),i.Db(4),i.kc("ngModel",e.data.Alamat),i.Db(4),i.kc("ngModel",e.data.JudulBuku),i.Db(4),i.kc("ngModel",e.data.KodeBuku),i.Db(4),i.kc("ngModel",e.data.TanggalPinjam),i.Db(4),i.kc("ngModel",e.data.TanggalKembali),i.Db(4),i.kc("ngModel",e.data.Status),i.Db(4),i.kc("disabled",e.loading),i.Db(1),i.zc(e.loading?"Menyimpan..":"Simpan"))},directives:[m.h,m.e,wp.b,wp.e,Tp.b,Ip.c,Ip.j,Ip.l,m.c,u.a,m.d],styles:[""]}),t})();function Cp(t,e){1&t&&(i.Ub(0,"div",2),i.Pb(1,"mat-spinner"),i.Tb())}function Rp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"tr"),i.Pb(1,"td"),i.Ub(2,"td"),i.yc(3),i.Tb(),i.Ub(4,"td"),i.yc(5),i.Tb(),i.Ub(6,"td"),i.yc(7),i.Tb(),i.Ub(8,"td"),i.yc(9),i.Tb(),i.Ub(10,"td"),i.yc(11),i.Tb(),i.Ub(12,"td"),i.yc(13),i.Tb(),i.Ub(14,"td"),i.yc(15),i.Tb(),i.Ub(16,"td"),i.yc(17),i.Tb(),i.Ub(18,"td"),i.yc(19),i.Tb(),i.Ub(20,"td"),i.yc(21),i.Tb(),i.Ub(22,"td"),i.yc(23),i.Tb(),i.Ub(24,"td",7),i.Ub(25,"button",9),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).PinjamDetail(n,r)}),i.yc(26,"Edit"),i.Tb(),i.Ub(27,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).DeleteProduct(n.id,r)}),i.yc(28),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=i.fc(2);i.Db(3),i.zc(n+1),i.Db(2),i.zc(t.IDTransaksi),i.Db(2),i.zc(t.IDAnggota),i.Db(2),i.zc(t.Nama),i.Db(2),i.zc(t.NoHp),i.Db(2),i.zc(t.Alamat),i.Db(2),i.zc(t.JudulBuku),i.Db(2),i.zc(t.KodeBuku),i.Db(2),i.zc(t.TanggalPinjam),i.Db(2),i.zc(t.TanggalKembali),i.Db(2),i.zc(t.Status),i.Db(4),i.kc("disabled",r.loadingDelete[n]),i.Db(1),i.zc(r.loadingDelete[n]?"Menghapus..":"Delete")}}function Pp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"mat-card"),i.Ub(1,"mat-card-header"),i.Ub(2,"mat-card-title"),i.yc(3),i.Tb(),i.Tb(),i.Ub(4,"mat-card-content"),i.Ub(5,"div",3),i.Pb(6,"span",4),i.Ub(7,"button",5),i.bc("click",function(){return i.rc(t),i.fc().PinjamDetail({},-1)}),i.yc(8,"Tambah Peminjam"),i.Tb(),i.Tb(),i.Ub(9,"table",6),i.Ub(10,"thead"),i.Pb(11,"th"),i.Ub(12,"th"),i.yc(13,"No"),i.Tb(),i.Ub(14,"th"),i.yc(15,"ID Transaksi"),i.Tb(),i.Ub(16,"th"),i.yc(17,"ID Anggota"),i.Tb(),i.Ub(18,"th"),i.yc(19,"Nama"),i.Tb(),i.Ub(20,"th"),i.yc(21,"No Hp"),i.Tb(),i.Ub(22,"th"),i.yc(23,"Alamat"),i.Tb(),i.Ub(24,"th"),i.yc(25,"Judul Buku"),i.Tb(),i.Ub(26,"th"),i.yc(27,"Kode Buku"),i.Tb(),i.Ub(28,"th"),i.yc(29,"Tanggal Pinjam"),i.Tb(),i.Ub(30,"th"),i.yc(31,"Tanggal Kembali"),i.Tb(),i.Ub(32,"th"),i.yc(33,"Status"),i.Tb(),i.Pb(34,"th",7),i.Tb(),i.Ub(35,"tbody"),i.xc(36,Rp,29,13,"tr",8),i.Tb(),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=i.fc();i.Db(3),i.zc(t.title),i.Db(33),i.kc("ngForOf",t.Pinjams)}}const Up=[{path:"",component:d,children:[{path:"dashboard",component:p.a},{path:"product",component:Ap},{path:"pinjam",component:(()=>{class t{constructor(t,e,n){this.dialog=t,this.db=e,this.auth=n,this.Pinjams=[],this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Peminjam",this.auth.user.subscribe(t=>{this.userData=t,this.getPinjams()})}getPinjams(){this.loading=!0,this.db.collection("Pinjams",t=>t.where("uid","==",this.userData.uid)).valueChanges().subscribe(t=>{console.log(t),this.Pinjams=t,this.loading=!1},t=>{this.loading=!1})}PinjamDetail(t,e){this.dialog.open(jp,{width:"400px",data:t}).afterClosed().subscribe(n=>{n&&(-1==e?this.Pinjams.push(n):this.Pinjams[e]=t)})}DeleteProduct(t,e){confirm("Delete item?")&&(this.loadingDelete[e]=!0),this.db.collection("Pinjams/").doc(t).delete().then(t=>{this.Pinjams.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.b),i.Ob(bp),i.Ob(ip.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-pinjam"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"disabled","click"]],template:function(t,e){1&t&&(i.xc(0,Cp,2,0,"div",0),i.xc(1,Pp,37,2,"mat-card",1)),2&t&&(i.kc("ngIf",e.loading),i.Db(1),i.kc("ngIf",!e.loading))},directives:[r.k,Op.b,_p.a,_p.c,_p.e,_p.b,u.a,r.j],styles:[""]}),t})()},{path:"",pathMatch:"full",redirectTo:"/admiin/dashboard"}]}];let Lp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.c,s.d.forChild(Up),y.a,Ip.f,xp.b]]}),t})()}}]);