(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{jkDv:function(t,e,n){"use strict";n.r(e),n.d(e,"AdminModule",function(){return Rp});var r=n("ofXK"),i=n("fXoL"),o=n("tk/3");let s=(()=>{class t{constructor(t){this.http=t,this.serverUrl="http://localhost:1337/"}getToken(){var t=localStorage.getItem("appToken");if(null!=t){var e=JSON.parse(t);this.httpOptions={headers:new o.c({"Content-Type":"application/json",Authorization:"Bearer "+e.jwt})}}}get(t){return this.getToken(),this.http.get(this.serverUrl+t,this.httpOptions)}post(t,e){return this.getToken(),this.http.post(this.serverUrl+t,e,this.httpOptions)}put(t,e){return this.getToken(),this.http.put(this.serverUrl+t,e,this.httpOptions)}delete(t){return this.getToken(),this.http.delete(this.serverUrl+t,this.httpOptions)}register(t,e){return this.http.post(this.serverUrl+"auth/local",{identifier:t,password:e})}login(t,e){return this.http.post(this.serverUrl+"auth/local",{identifier:t,password:e})}upload(t){return this.http.post(this.serverUrl+"upload/book",t)}updateProduct(t){return this.http.post(this.serverUrl+"updateProduct/book",t)}}return t.\u0275fac=function(e){return new(e||t)(i.Yb(o.a))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var a=n("tyNb"),u=n("/t3+"),c=n("bTqV"),h=n("NFeN"),l=n("XhcP"),f=n("MutI"),d=n("FKr1");let p=(()=>{class t{constructor(t,e){this.api=t,this.router=e,this.mode="side"}ngOnInit(){}chockLogin(){this.api.get("books/status").subscribe(t=>{},t=>{this.router.navigate(["/login"])})}logout(){this.loading=!0,confirm("keluar aplikasi?")&&(localStorage.removeItem("appToken"),this.router.navigate(["/login"]))}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(s),i.Ob(a.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-admin"]],decls:35,vars:9,consts:[["color","primary",1,"example-header"],["mat-icon-button","",3,"click"],["routerLink","/admin/dashboard",1,"uk-button","uk-button-trans"],[1,"uk-width-expand"],["mat-button","",3,"click"],[1,"admin-container"],["mode","side",1,"sidenav-left",3,"position","opened","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],["routerLink","/admin/dashboard"],["matListIcon",""],["matLine",""],["routerLink","/admin/product"],["routerLink","/admin/pinjam"],["mode","side",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-color","#ccc"]],template:function(t,e){if(1&t){const t=i.Vb();i.Sb(0),i.Ub(1,"mat-toolbar",0),i.Ub(2,"button",1),i.bc("click",function(){return i.rc(t),i.pc(14).toggle()}),i.Ub(3,"mat-icon"),i.yc(4,"menu"),i.Tb(),i.Tb(),i.Ub(5,"span",2),i.yc(6,"Home"),i.Tb(),i.Pb(7,"div",3),i.Ub(8,"small"),i.yc(9,"Admin"),i.Tb(),i.Ub(10,"button",4),i.bc("click",function(){return e.logout()}),i.yc(11,"logout"),i.Tb(),i.Tb(),i.Ub(12,"mat-sidenav-container",5),i.Ub(13,"mat-sidenav",6,7),i.Ub(15,"mat-nav-list"),i.Ub(16,"mat-list-item",8),i.Ub(17,"mat-icon",9),i.yc(18,"dashboard"),i.Tb(),i.Ub(19,"h3",10),i.yc(20,"Dashboard"),i.Tb(),i.Tb(),i.Ub(21,"mat-list-item",11),i.Ub(22,"mat-icon",9),i.yc(23,"book"),i.Tb(),i.Ub(24,"h3",10),i.yc(25,"Daftar Buku"),i.Tb(),i.Tb(),i.Ub(26,"mat-list-item",12),i.Ub(27,"mat-icon",9),i.yc(28,"ballot"),i.Tb(),i.Ub(29,"h3",10),i.yc(30,"Daftar pinjam"),i.Tb(),i.Tb(),i.Tb(),i.Tb(),i.Pb(31,"mat-sidenav",13,7),i.Ub(33,"mat-sidenav-content",14),i.Pb(34,"router-outlet"),i.Tb(),i.Tb(),i.Rb()}2&t&&(i.Db(13),i.kc("position","start")("opened",!1)("fixedInViewport",!0)("fixedTopGap",65)("fixedBottomGap",0),i.Db(18),i.kc("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0))},directives:[u.a,c.a,h.a,a.b,l.b,l.a,f.d,f.b,f.a,d.j,l.c,a.d],styles:[""]}),t})();var y=n("o8Ft"),g=n("w55g"),m=n("0IaG"),v=n("D0XW"),b=n("HDdC"),w=n("Cfvw"),T=n("LRne"),I=n("JX91"),E=n("Zy1z"),O=n("lJxs"),_=n("Kqap"),S=n("/uUt"),D=n("pLZG"),k=n("pxpQ"),N=n("jmUF"),A=n("Jgta"),x=n("zIRd"),j=n("qOnz"),C=n("q/0M"),R=function(t,e){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function P(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var U,L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},M=M||{},F=L||self;function V(){}function q(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function B(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var K="closure_uid_"+(1e9*Math.random()>>>0),G=0;function z(t,e,n){return t.call.apply(t.bind,arguments)}function Q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function H(t,e,n){return(H=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?z:Q).apply(null,arguments)}function W(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Y(){return Date.now()}function X(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Pb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function $(){this.j=this.j,this.i=this.i}$.prototype.j=!1,$.prototype.ka=function(){!this.j&&(this.j=!0,this.H(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,K)&&t[K]||(t[K]=++G)}(this)},$.prototype.H=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var J=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function tt(t){return Array.prototype.concat.apply([],arguments)}function et(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function nt(t){return/^[\s\xa0]*$/.test(t)}var rt,it=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ot(t,e){return-1!=t.indexOf(e)}function st(t,e){return t<e?-1:t>e?1:0}t:{var at=F.navigator;if(at){var ut=at.userAgent;if(ut){rt=ut;break t}}rt=""}function ct(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ht(t){var e={};for(var n in t)e[n]=t[n];return e}var lt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ft(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<lt.length;o++)n=lt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function dt(t){return dt[" "](t),t}dt[" "]=V;var pt,yt,gt=ot(rt,"Opera"),mt=ot(rt,"Trident")||ot(rt,"MSIE"),vt=ot(rt,"Edge"),bt=vt||mt,wt=ot(rt,"Gecko")&&!(ot(rt.toLowerCase(),"webkit")&&!ot(rt,"Edge"))&&!(ot(rt,"Trident")||ot(rt,"MSIE"))&&!ot(rt,"Edge"),Tt=ot(rt.toLowerCase(),"webkit")&&!ot(rt,"Edge");function It(){var t=F.document;return t?t.documentMode:void 0}t:{var Et="",Ot=(yt=rt,wt?/rv:([^\);]+)(\)|;)/.exec(yt):vt?/Edge\/([\d\.]+)/.exec(yt):mt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(yt):Tt?/WebKit\/(\S+)/.exec(yt):gt?/(?:Version)[ \/]?(\S+)/.exec(yt):void 0);if(Ot&&(Et=Ot?Ot[1]:""),mt){var _t=It();if(null!=_t&&_t>parseFloat(Et)){pt=String(_t);break t}}pt=Et}var St={};function Dt(t){return function(t,e){var n=St;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=it(String(pt)).split("."),r=it(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=st(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||st(0==s[2].length,0==a[2].length)||st(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var kt=F.document&&mt&&(It()||parseInt(pt,10))||void 0,Nt=!mt||9<=Number(kt),At=mt&&!Dt("9"),xt=function(){if(!F.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{F.addEventListener("test",V,e),F.removeEventListener("test",V,e)}catch(n){}return t}();function jt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Ct(t,e){if(jt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(wt){t:{try{dt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Rt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}jt.prototype.b=function(){this.defaultPrevented=!0},X(Ct,jt);var Rt={2:"touch",3:"pen",4:"mouse"};Ct.prototype.b=function(){Ct.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,At)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Pt="closure_listenable_"+(1e6*Math.random()|0),Ut=0;function Lt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Ut,this.Y=this.Z=!1}function Mt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ft(t){this.src=t,this.a={},this.b=0}function Vt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=J(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Mt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function qt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ft.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=qt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Lt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Bt="closure_lm_"+(1e6*Math.random()|0),Kt={};function Gt(t,e,n,r,i){if(r&&r.once)return Qt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Gt(t,e[o],n,r,i);return null}return n=te(n),t&&t[Pt]?t.wa(e,n,B(r)?!!r.capture:!!r,i):zt(t,e,n,!1,r,i)}function zt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=B(i)?!!i.capture:!!i;if(s&&!Nt)return null;var a=Jt(t);if(a||(t[Bt]=a=new Ft(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=$t,e=Nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)xt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Yt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Qt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Qt(t,e[o],n,r,i);return null}return n=te(n),t&&t[Pt]?t.xa(e,n,B(r)?!!r.capture:!!r,i):zt(t,e,n,!0,r,i)}function Ht(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Ht(t,e[o],n,r,i);else r=B(r)?!!r.capture:!!r,n=te(n),t&&t[Pt]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=qt(o=t.a[e],n,r,i))&&(Mt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Jt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=qt(e,n,r,i)),(n=-1<t?e[t]:null)&&Wt(n))}function Wt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Pt])Vt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Yt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Jt(e))?(Vt(n,t),0==n.b&&(n.src=null,e[Bt]=null)):Mt(t)}}}function Yt(t){return t in Kt?Kt[t]:Kt[t]="on"+t}function Xt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Wt(t),n.call(r,e)}function $t(t,e){if(t.Y)return!0;if(!Nt){if(!e)t:{e=["window","event"];for(var n=F,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Xt(t,e=new Ct(e,this))}return Xt(t,new Ct(e,this))}function Jt(t){return(t=t[Bt])instanceof Ft?t:null}var Zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(t){return"function"==typeof t?t:(t[Zt]||(t[Zt]=function(e){return t.handleEvent(e)}),t[Zt])}function ee(){$.call(this),this.c=new Ft(this),this.J=this,this.D=null}function ne(t,e){var n,r=t.D;if(r)for(n=[];r;r=r.D)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new jt(e,t);else if(e instanceof jt)e.target=e.target||t;else{var i=e;ft(e=new jt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=re(s,r,!0,e)&&i}if(i=re(s=e.a=t,r,!0,e)&&i,i=re(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=re(s=e.a=n[o],r,!1,e)&&i}function re(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Vt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}X(ee,$),ee.prototype[Pt]=!0,(U=ee.prototype).addEventListener=function(t,e,n,r){Gt(this,t,e,n,r)},U.removeEventListener=function(t,e,n,r){Ht(this,t,e,n,r)},U.H=function(){if(ee.X.H.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Mt(n[r]);delete e.a[t],e.b--}}this.D=null},U.wa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},U.xa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var ie=F.JSON.stringify;function oe(){this.b=this.a=null}var se,ae=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new ce},function(t){t.reset()});function ue(){var t=de,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function ce(){this.next=this.b=this.a=null}function he(t){F.setTimeout(function(){throw t},0)}function le(t,e){se||function(){var t=F.Promise.resolve(void 0);se=function(){t.then(pe)}}(),fe||(se(),fe=!0),de.add(t,e)}oe.prototype.add=function(t,e){var n=ae.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ce.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},ce.prototype.reset=function(){this.next=this.b=this.a=null};var fe=!1,de=new oe;function pe(){for(var t;t=ue();){try{t.a.call(t.b)}catch(n){he(n)}var e=ae;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}fe=!1}function ye(t,e){ee.call(this),this.b=t||1,this.a=e||F,this.f=H(this.eb,this),this.g=Y()}function ge(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function me(t,e,n){if("function"==typeof t)n&&(t=H(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=H(t.handleEvent,t)}return 2147483647<Number(e)?-1:F.setTimeout(t,e||0)}function ve(t){t.a=me(function(){t.a=null,t.c&&(t.c=!1,ve(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}X(ye,ee),(U=ye.prototype).aa=!1,U.M=null,U.eb=function(){if(this.aa){var t=Y()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),ne(this,"tick"),this.aa&&(ge(this),this.start()))}},U.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=Y())},U.H=function(){ye.X.H.call(this),ge(this),delete this.a};var be=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:ve(this)},e.prototype.H=function(){t.prototype.H.call(this),this.a&&(F.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}($);function we(t){$.call(this),this.b=t,this.a={}}X(we,$);var Te=[];function Ie(t,e,n,r){Array.isArray(n)||(n&&(Te[0]=n.toString()),n=Te);for(var i=0;i<n.length;i++){var o=Gt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Ee(t){ct(t.a,function(t,e){this.a.hasOwnProperty(e)&&Wt(t)},t),t.a={}}function Oe(){this.a=!0}function _e(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return ie(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}we.prototype.H=function(){we.X.H.call(this),Ee(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Oe.prototype.info=function(){};var Se={},De=null;function ke(){return De=De||new ee}function Ne(t){jt.call(this,Se.Ga,t)}function Ae(t){var e=ke();ne(e,new Ne(e,t))}function xe(t,e){jt.call(this,Se.STAT_EVENT,t),this.stat=e}function je(t){var e=ke();ne(e,new xe(e,t))}function Ce(t){jt.call(this,Se.Ha,t)}function Re(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return F.setTimeout(function(){t()},e)}Se.Ga="serverreachability",X(Ne,jt),Se.STAT_EVENT="statevent",X(xe,jt),Se.Ha="timingevent",X(Ce,jt);var Pe={NO_ERROR:0,fb:1,sb:2,rb:3,mb:4,qb:5,tb:6,Ea:7,TIMEOUT:8,wb:9},Ue={kb:"complete",Gb:"success",Fa:"error",Ea:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",nb:"downloadprogress",Ob:"uploadprogress"};function Le(){}function Me(){}Le.prototype.b=null;var Fe,Ve={OPEN:"a",jb:"b",Fa:"c",vb:"d"};function qe(){jt.call(this,"d")}function Be(){jt.call(this,"c")}function Ke(){}function Ge(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new we(this),this.P=ze,this.R=new ye(t=bt?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}X(qe,jt),X(Be,jt),X(Ke,Le),Ke.prototype.a=function(){return new XMLHttpRequest},Ke.prototype.c=function(){return{}},Fe=new Ke;var ze=45e3,Qe={},He={};function We(t,e,n){t.G=1,t.i=mn(ln(e)),t.j=n,t.I=!0,Ye(t,null)}function Ye(t,e){t.u=Y(),Je(t),t.l=ln(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),An(n.b,"t",r),t.D=0,t.a=Or(t.g,t.g.C?e:null),0<t.O&&(t.F=new be(H(t.Da,t,t.a),t.O)),Ie(t.J,t.a,"readystatechange",t.bb),e=t.B?ht(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ae(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Xe(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=$e(t,n);if(i==He){4==e&&(t.h=4,je(14),r=!1),_e(t.c,t.f,null,"[Incomplete Response]");break}if(i==Qe){t.h=4,je(15),_e(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}_e(t.c,t.f,i,null),rn(t,i)}4==e&&0==n.length&&(t.h=1,je(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),gr(e),e.F=!0,je(11))):(_e(t.c,t.f,n,"[Invalid Chunked Response]"),nn(t),en(t))}function $e(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?He:(n=Number(e.substring(n,r)),isNaN(n)?Qe:(r+=1)+n>e.length?He:(e=e.substr(r,n),t.D=r+n,e))}function Je(t){t.T=Y()+t.P,Ze(t,t.P)}function Ze(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Re(H(t.$a,t),e)}function tn(t){t.o&&(F.clearTimeout(t.o),t.o=null)}function en(t){0==t.g.v||t.A||br(t.g,t)}function nn(t){tn(t);var e=t.F;e&&"function"==typeof e.ka&&e.ka(),t.F=null,ge(t.R),Ee(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ka())}function rn(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Ln(n.b,t)))if(n.I=t.N,!t.C&&Ln(n.b,t)&&3==n.v){try{var r=n.la.a.parse(e)}catch(kd){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;vr(n),ar(n)}yr(n),je(18)}}else n.pa=i[1],0<n.pa-n.P&&37500>i[2]&&n.G&&0==n.o&&!n.m&&(n.m=Re(H(n.Xa,n),6e3));if(1>=Un(n.b)&&n.fa){try{n.fa()}catch(kd){}n.fa=void 0}}else Tr(n,11)}else if((t.C||n.a==t)&&vr(n),!nt(e))for(e=r=n.la.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ha=i[2];var o=i[3];null!=o&&(n.ia=o,n.c.info("VER="+n.ia));var s=i[4];null!=s&&(n.qa=s,n.c.info("SVER="+n.qa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(ot(h,"spdy")||ot(h,"quic")||ot(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(Mn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.oa=f,gn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ua(),n.U&&(n.N=Y()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).ma=Er(u,u.C?u.ha:null,u.ga),d.C){Fn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(tn(p),Je(p)),u.a=d}else pr(u);0<n.g.length&&hr(n)}else"stop"!=i[0]&&"close"!=i[0]||Tr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Tr(n,7):sr(n):"noop"!=i[0]&&n.f&&n.f.ta(i),n.o=0);Ae(4)}catch(kd){}}function on(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(q(t)||"string"==typeof t)Z(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(q(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(q(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function sn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof sn)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function an(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];un(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)un(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function un(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(U=Ge.prototype).setTimeout=function(t){this.P=t},U.bb=function(t){t=t.target;var e=this.F;e&&3==nr(t)?e.f():this.Da(t)},U.Da=function(t){try{if(t==this.a)t:{var e=nr(this.a),n=this.a.va(),r=this.a.W();if(!(3>e||3==e&&!bt&&!this.a.$())){this.A||4!=e||7==n||Ae(8==n||0>=r?3:2),tn(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!nt(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,je(12),nn(this),en(this);break t}_e(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,rn(this,u)}this.I?(Xe(this,e,o),bt&&this.b&&3==e&&(Ie(this.J,this.R,"tick",this.ab),this.R.start())):(_e(this.c,this.f,o,null),rn(this,o)),4==e&&nn(this),this.b&&!this.A&&(4==e?br(this.g,this):(this.b=!1,Je(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,je(12)):(this.h=0,je(13)),nn(this),en(this)}}}catch(c){}},U.ab=function(){if(this.a){var t=nr(this.a),e=this.a.$();this.D<e.length&&(tn(this),Xe(this,t,e),this.b&&4!=t&&Je(this))}},U.cancel=function(){this.A=!0,nn(this)},U.$a=function(){this.o=null;var t=Y();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.G&&(Ae(3),je(17)),nn(this),this.h=2,en(this)):Ze(this,this.T-t)},(U=sn.prototype).K=function(){an(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},U.L=function(){return an(this),this.a.concat()},U.get=function(t,e){return un(this.b,t)?this.b[t]:e},U.set=function(t,e){un(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},U.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var cn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function hn(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof hn){this.a=void 0!==e?e:t.a,fn(this,t.f),this.j=t.j,dn(this,t.c),pn(this,t.h),this.g=t.g,e=t.b;var n=new Sn;n.c=e.c,e.a&&(n.a=new sn(e.a),n.b=e.b),yn(this,n),this.i=t.i}else t&&(n=String(t).match(cn))?(this.a=!!e,fn(this,n[1]||"",!0),this.j=vn(n[2]||""),dn(this,n[3]||"",!0),pn(this,n[4]),this.g=vn(n[5]||"",!0),yn(this,n[6]||"",!0),this.i=vn(n[7]||"")):(this.a=!!e,this.b=new Sn(null,this.a))}function ln(t){return new hn(t)}function fn(t,e,n){t.f=n?vn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function dn(t,e,n){t.c=n?vn(e,!0):e}function pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function yn(t,e,n){e instanceof Sn?(t.b=e,function(t,e){e&&!t.f&&(Dn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(kn(this,e),An(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=bn(e,On)),t.b=new Sn(e,t.a))}function gn(t,e,n){t.b.set(e,n)}function mn(t){return gn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Y()).toString(36)),t}function vn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function bn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,wn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function wn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}hn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(bn(e,Tn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(bn(e,Tn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(bn(n,"/"==n.charAt(0)?En:In,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",bn(n,_n)),t.join("")};var Tn=/[#\/\?@]/g,In=/[#\?:]/g,En=/[#\?]/g,On=/[#\?@]/g,_n=/#/g;function Sn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Dn(t){t.a||(t.a=new sn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function kn(t,e){Dn(t),e=xn(t,e),un(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,un((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&an(t)))}function Nn(t,e){return Dn(t),e=xn(t,e),un(t.a.b,e)}function An(t,e,n){kn(t,e),0<n.length&&(t.c=null,t.a.set(xn(t,e),et(n)),t.b+=n.length)}function xn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(U=Sn.prototype).add=function(t,e){Dn(this),this.c=null,t=xn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},U.forEach=function(t,e){Dn(this),this.a.forEach(function(n,r){Z(n,function(n){t.call(e,n,r,this)},this)},this)},U.L=function(){Dn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},U.K=function(t){Dn(this);var e=[];if("string"==typeof t)Nn(this,t)&&(e=tt(e,this.a.get(xn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=tt(e,t[n])}return e},U.set=function(t,e){return Dn(this),this.c=null,Nn(this,t=xn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},U.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},U.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var jn=function(){return function(t,e){this.b=t,this.a=e}}();function Cn(t){this.g=t||Rn,t=F.PerformanceNavigationTiming?0<(t=F.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(F.ja&&F.ja.za&&F.ja.za()&&F.ja.za().Qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Rn=10;function Pn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Un(t){return t.b?1:t.a?t.a.size:0}function Ln(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function Mn(t,e){t.a?t.a.add(e):t.b=e}function Fn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Vn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=P(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return et(t.c)}function qn(){}function Bn(){this.a=new qn}function Kn(t,e,n){var r=n||"";try{on(t,function(t,n){var i=t;B(t)&&(i=ie(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Jd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Jd}}function Gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}Cn.prototype.cancel=function(){var t,e;if(this.c=Vn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=P(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},qn.prototype.stringify=function(t){return F.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return F.JSON.parse(t,void 0)};var zn=F.JSON.parse;function Qn(t){ee.call(this),this.headers=new sn,this.l=t||null,this.b=!1,this.u=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.m=this.A=!1,this.s=0,this.o=null,this.I=Hn,this.F=this.G=!1}X(Qn,ee);var Hn="",Wn=/^https?$/i,Yn=["POST","PUT"];function Xn(t){return"content-type"==t.toLowerCase()}function $n(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Jn(t),tr(t)}function Jn(t){t.A||(t.A=!0,ne(t,"complete"),ne(t,"error"))}function Zn(t){if(t.b&&void 0!==M&&(!t.u[1]||4!=nr(t)||2!=t.W()))if(t.m&&4==nr(t))me(t.Aa,0,t);else if(ne(t,"readystatechange"),4==nr(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.C).match(cn)[1]||null;if(!o&&F.self&&F.self.location){var s=F.self.location.protocol;o=s.substr(0,s.length-1)}i=!Wn.test(o?o.toLowerCase():"")}e=i}if(e)ne(t,"complete"),ne(t,"success");else{t.h=6;try{var a=2<nr(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Jn(t)}}finally{tr(t)}}}function tr(t,e){if(t.a){er(t);var n=t.a,r=t.u[0]?V:null;t.a=null,t.u=null,e||ne(t,"ready");try{n.onreadystatechange=r}catch(Jd){}}}function er(t){t.a&&t.F&&(t.a.ontimeout=null),t.o&&(F.clearTimeout(t.o),t.o=null)}function nr(t){return t.a?t.a.readyState:0}function rr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return ct(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):gn(t,e,n))}function ir(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function or(t){this.qa=0,this.g=[],this.c=new Oe,this.ha=this.ma=this.B=this.ga=this.a=this.oa=this.A=this.V=this.i=this.O=this.l=null,this.Pa=this.R=0,this.Ma=ir("failFast",!1,t),this.G=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.pa=this.P=-1,this.T=this.o=this.u=0,this.Ia=ir("baseRetryDelayMs",5e3,t),this.Sa=ir("retryDelaySeedMs",1e4,t),this.Na=ir("forwardChannelMaxRetries",2,t),this.na=ir("forwardChannelRequestTimeoutMs",2e4,t),this.Oa=t&&t.xmlHttpFactory||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Cn(t&&t.concurrentRequestLimit),this.la=new Bn,this.ea=t&&t.fastHandshake||!1,this.Ja=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.ea&&this.S&&t&&t.detectBufferingProxy||!1,this.fa=void 0,this.N=0,this.F=!1,this.s=null,(this.La=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function sr(t){if(ur(t),3==t.v){var e=t.R++,n=ln(t.B);gn(n,"SID",t.J),gn(n,"RID",e),gn(n,"TYPE","terminate"),fr(t,n),(e=new Ge(t,t.c,e,void 0)).G=2,e.i=mn(ln(n)),n=!1,F.navigator&&F.navigator.sendBeacon&&(n=F.navigator.sendBeacon(e.i.toString(),"")),!n&&F.Image&&((new Image).src=e.i,n=!0),n||(e.a=Or(e.g,null),e.a.ba(e.i)),e.u=Y(),Je(e)}Ir(t)}function ar(t){t.a&&(gr(t),t.a.cancel(),t.a=null)}function ur(t){ar(t),t.j&&(F.clearTimeout(t.j),t.j=null),vr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&F.clearTimeout(t.h),t.h=null)}function cr(t,e){t.g.push(new jn(t.Pa++,e)),3==t.v&&hr(t)}function hr(t){Pn(t.b)||t.h||(t.h=!0,le(t.Ca,t),t.u=0)}function lr(t,e){var n;n=e?e.f:t.R++;var r=ln(t.B);gn(r,"SID",t.J),gn(r,"RID",n),gn(r,"AID",t.P),fr(t,r),t.i&&t.l&&rr(r,t.i,t.l),n=new Ge(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=dr(t,n,1e3),n.setTimeout(Math.round(.5*t.na)+Math.round(.5*t.na*Math.random())),Mn(t.b,n),We(n,r,e)}function fr(t,e){t.f&&on({},function(t,n){gn(e,n,t)})}function dr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?H(t.f.Ka,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{Kn(h,s,"req"+c+"_")}catch(ai){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function pr(t){t.a||t.j||(t.T=1,le(t.Ba,t),t.o=0)}function yr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Re(H(t.Ba,t),wr(t,t.o)),t.o++,0))}function gr(t){null!=t.s&&(F.clearTimeout(t.s),t.s=null)}function mr(t){t.a=new Ge(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ln(t.ma);gn(e,"RID","rpc"),gn(e,"SID",t.J),gn(e,"CI",t.G?"0":"1"),gn(e,"AID",t.P),fr(t,e),gn(e,"TYPE","xmlhttp"),t.i&&t.l&&rr(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ha,n.G=1,n.i=mn(ln(e)),n.j=null,n.I=!0,Ye(n,t)}function vr(t){null!=t.m&&(F.clearTimeout(t.m),t.m=null)}function br(t,e){var n=null;if(t.a==e){vr(t),gr(t),t.a=null;var r=2}else{if(!Ln(t.b,e))return;n=e.s,Fn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=Y()-e.u;var i=t.u;ne(r=ke(),new Ce(r,n,e,i)),hr(t)}else pr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Un(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ma?0:t.Na)||(t.h=Re(H(t.Ca,t,e),wr(t,t.u)),t.u++,0)))}(t,e)||2==r&&yr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Tr(t,5);break;case 4:Tr(t,10);break;case 3:Tr(t,6);break;default:Tr(t,2)}}function wr(t,e){var n=t.Ia+Math.floor(Math.random()*t.Sa);return t.f||(n*=2),n*e}function Tr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=H(t.cb,t);n||(n=new hn("//www.google.com/images/cleardot.gif"),F.location&&"http"==F.location.protocol||fn(n,"https"),mn(n)),function(t,e){var n=new Oe;if(F.Image){var r=new Image;r.onload=W(Gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=W(Gn,n,r,"TestLoadImage: error",!1,e),r.onabort=W(Gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=W(Gn,n,r,"TestLoadImage: timeout",!1,e),F.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else je(2);t.v=0,t.f&&t.f.sa(e),Ir(t),ur(t)}function Ir(t){t.v=0,t.I=-1,t.f&&(0==Vn(t.b).length&&0==t.g.length||(t.b.c.length=0,et(t.g),t.g.length=0),t.f.ra())}function Er(t,e,n){var r=function(t){return t instanceof hn?ln(t):new hn(t,void 0)}(n);if(""!=r.c)e&&dn(r,e+"."+r.c),pn(r,r.h);else{var i=F.location;r=function(t,e,n,r){var i=new hn(null,void 0);return t&&fn(i,t),e&&dn(i,e),n&&pn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&ct(t.V,function(t,e){gn(r,e,t)}),n=t.oa,(e=t.A)&&n&&gn(r,e,n),gn(r,"VER",t.ia),fr(t,r),r}function Or(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Qn(t.Oa)).G=t.C,e}function _r(){}function Sr(){if(mt&&!(10<=Number(kt)))throw Error("Environmental error: no available transport.")}function Dr(t,e){ee.call(this),this.a=new or(e),this.g=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!nt(t)&&(this.a.i=t),this.o=e&&e.supportsCrossDomainXhr||!1,this.m=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!nt(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Ar(this)}function kr(t){qe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Nr(){Be.call(this),this.status=1}function Ar(t){this.a=t}function xr(t){this.f=t}function jr(t){ee.call(this),this.u=t,this.h=void 0,this.readyState=Cr,this.status=0,this.responseType=this.responseText=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.o="",this.a=!1,this.m=this.f=this.g=null}(U=Qn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.l?this.l.a():Fe.a(),this.u=function(t){return t.b||(t.b=t.c())}(this.l?this.l:Fe),this.a.onreadystatechange=H(this.Aa,this);try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(o){return void $n(this,o)}t=n||"";var i=new sn(this.headers);r&&on(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Xn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=F.FormData&&t instanceof F.FormData,!(0<=J(Yn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{er(this),0<this.s&&((this.F=function(t){return mt&&Dt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.s,this.a.ontimeout=H(this.ya,this)):this.o=me(this.ya,this.s,this)),this.m=!0,this.a.send(t),this.m=!1}catch(o){$n(this,o)}},U.ya=function(){void 0!==M&&this.a&&(this.f="Timed out after "+this.s+"ms, aborting",this.h=8,ne(this,"timeout"),this.abort(8))},U.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,ne(this,"complete"),ne(this,"abort"),tr(this))},U.H=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),tr(this,!0)),Qn.X.H.call(this)},U.Aa=function(){this.j||(this.B||this.m||this.g?Zn(this):this.Za())},U.Za=function(){Zn(this)},U.W=function(){try{return 2<nr(this)?this.a.status:-1}catch(yt){return-1}},U.$=function(){try{return this.a?this.a.responseText:""}catch(yt){return""}},U.Qa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),zn(e)}},U.va=function(){return this.h},U.Ra=function(){return"string"==typeof this.f?this.f:String(this.f)},(U=or.prototype).ia=8,U.v=1,U.Ca=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ge(this,this.c,t,void 0),r=this.l;if(this.O&&(r?ft(r=ht(r),this.O):r=this.O),null===this.i&&(n.B=r),this.ea)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=dr(this,n,e),gn(i=ln(this.B),"RID",t),gn(i,"CVER",22),this.A&&gn(i,"X-HTTP-Session-Id",this.A),fr(this,i),this.i&&r&&rr(i,this.i,r),Mn(this.b,n),this.Ja&&gn(i,"TYPE","init"),this.ea?(gn(i,"$req",e),gn(i,"SID","null"),n.U=!0,We(n,i,null)):We(n,i,e),this.v=2}}else 3==this.v&&(t?lr(this,t):0==this.g.length||Pn(this.b)||lr(this))},U.Ba=function(){if(this.j=null,mr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Re(H(this.Ya,this),t)}},U.Ya=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.F=!0,je(10),ar(this),mr(this))},U.Xa=function(){null!=this.m&&(this.m=null,ar(this),yr(this),je(19))},U.cb=function(t){t?(this.c.info("Successfully pinged google.com"),je(2)):(this.c.info("Failed to ping google.com"),je(1))},(U=_r.prototype).ua=function(){},U.ta=function(){},U.sa=function(){},U.ra=function(){},U.Ka=function(){},Sr.prototype.a=function(t,e){return new Dr(t,e)},X(Dr,ee),Dr.prototype.h=function(){this.a.f=this.f,this.o&&(this.a.C=!0);var t=this.a,e=this.g,n=this.b||void 0;je(0),t.ga=e,t.V=n||{},t.G=t.S,t.B=Er(t,null,t.ga),hr(t)},Dr.prototype.close=function(){sr(this.a)},Dr.prototype.l=function(t){if("string"==typeof t){var e={};e.__data__=t,cr(this.a,e)}else this.m?((e={}).__data__=ie(t),cr(this.a,e)):cr(this.a,t)},Dr.prototype.H=function(){this.a.f=null,delete this.f,sr(this.a),delete this.a,Dr.X.H.call(this)},X(kr,qe),X(Nr,Be),X(Ar,_r),Ar.prototype.ua=function(){ne(this.a,"a")},Ar.prototype.ta=function(t){ne(this.a,new kr(t))},Ar.prototype.sa=function(t){ne(this.a,new Nr(t))},Ar.prototype.ra=function(){ne(this.a,"b")},X(xr,Le),xr.prototype.a=function(){return new jr(this.f)},xr.prototype.c=function(t){return function(){return t}}({}),X(jr,ee);var Cr=0;function Rr(t){t.f.read().then(t.Ta.bind(t)).catch(t.ca.bind(t))}function Pr(t){t.readyState=4,t.g=null,t.f=null,t.m=null,Ur(t)}function Ur(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(U=jr.prototype).open=function(t,e){if(this.readyState!=Cr)throw this.abort(),Error("Error reopening a connection");this.s=t,this.o=e,this.readyState=1,Ur(this)},U.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.l,method:this.s,credentials:this.h,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.o,e)).then(this.Wa.bind(this),this.ca.bind(this))},U.abort=function(){this.responseText="",this.l=new Headers,this.status=0,this.f&&this.f.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Pr(this)),this.readyState=Cr},U.Wa=function(t){this.a&&(this.g=t,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=t.headers,this.readyState=2,Ur(this)),this.a&&(this.readyState=3,Ur(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.Ua.bind(this),this.ca.bind(this)):void 0!==F.ReadableStream&&"body"in t?(this.responseText="",this.f=t.body.getReader(),this.m=new TextDecoder,Rr(this)):t.text().then(this.Va.bind(this),this.ca.bind(this)))))},U.Ta=function(t){if(this.a){var e=this.m.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.responseText+=e),t.done?Pr(this):Ur(this),3==this.readyState&&Rr(this)}},U.Va=function(t){this.a&&(this.responseText=t,Pr(this))},U.Ua=function(){this.a&&Pr(this)},U.ca=function(){this.a&&Pr(this)},U.setRequestHeader=function(t,e){this.l.append(t,e)},U.getResponseHeader=function(t){return this.b&&this.b.get(t.toLowerCase())||""},U.getAllResponseHeaders=function(){if(!this.b)return"";for(var t=[],e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(jr.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(t){this.h=t?"include":"same-origin"}}),Sr.prototype.createWebChannel=Sr.prototype.a,Dr.prototype.send=Dr.prototype.l,Dr.prototype.open=Dr.prototype.h,Dr.prototype.close=Dr.prototype.close,Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,Ue.COMPLETE="complete",Me.EventType=Ve,Ve.OPEN="a",Ve.CLOSE="b",Ve.ERROR="c",Ve.MESSAGE="d",ee.prototype.listen=ee.prototype.wa,Qn.prototype.listenOnce=Qn.prototype.xa,Qn.prototype.getLastError=Qn.prototype.Ra,Qn.prototype.getLastErrorCode=Qn.prototype.va,Qn.prototype.getStatus=Qn.prototype.W,Qn.prototype.getResponseJson=Qn.prototype.Qa,Qn.prototype.getResponseText=Qn.prototype.$,Qn.prototype.send=Qn.prototype.ba;var Lr=Pe,Mr=Ue,Fr=Se,Vr=xr,qr=Me,Br=Qn,Kr=n("mrSG"),Gr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Gr.o=-1;var zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Qr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Kr.c)(e,t),e}(Error),Hr=new C.b("@firebase/firestore");function Wr(){return Hr.logLevel}function Yr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=C.a.DEBUG){var r=e.map(Jr);Hr.debug.apply(Hr,Object(Kr.f)(["Firestore (8.6.8): "+t],r))}}function Xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=C.a.ERROR){var r=e.map(Jr);Hr.error.apply(Hr,Object(Kr.f)(["Firestore (8.6.8): "+t],r))}}function $r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=C.a.WARN){var r=e.map(Jr);Hr.warn.apply(Hr,Object(Kr.f)(["Firestore (8.6.8): "+t],r))}}function Jr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Jd){return t}}function Zr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.8) INTERNAL ASSERTION FAILED: "+t;throw Xr(e),new Error(e)}function ti(t,e){t||Zr()}function ei(t,e){return t}function ni(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var ri=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=ni(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function ii(t,e){return t<e?-1:t>e?1:0}function oi(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function si(t){return t+"\0"}var ai=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ii(this.nanoseconds,t.nanoseconds):ii(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),ui=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ai(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ci(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function hi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function li(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var fi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Zr(),void 0===n?n=t.length-e:n>t.length-e&&Zr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),di=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Qr(zr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(fi),pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,yi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return pi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Qr(zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Qr(zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Qr(zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(fi),gi=function(){function t(t){this.fields=t,t.sort(yi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return oi(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),mi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return ii(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();mi.EMPTY_BYTE_STRING=new mi("");var vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bi(t){if(ti(!!t),"string"==typeof t){var e=0,n=vi.exec(t);if(ti(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:wi(t.seconds),nanos:wi(t.nanos)}}function wi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ti(t){return"string"==typeof t?mi.fromBase64String(t):mi.fromUint8Array(t)}function Ii(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ei(t){var e=t.mapValue.fields.__previous_value__;return Ii(e)?Ei(e):e}function Oi(t){var e=bi(t.mapValue.fields.__local_write_time__.timestampValue);return new ai(e.seconds,e.nanos)}function _i(t){return null==t}function Si(t){return 0===t&&1/t==-1/0}function Di(t){return"number"==typeof t&&Number.isInteger(t)&&!Si(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ki=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(di.fromString(e))},t.fromName=function(e){return new t(di.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===di.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return di.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new di(e.slice()))},t}();function Ni(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ii(t)?4:10:Zr()}function Ai(t,e){var n=Ni(t);if(n!==Ni(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Oi(t).isEqual(Oi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=bi(t.timestampValue),r=bi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ti(t.bytesValue).isEqual(Ti(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return wi(t.geoPointValue.latitude)===wi(e.geoPointValue.latitude)&&wi(t.geoPointValue.longitude)===wi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return wi(t.integerValue)===wi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=wi(t.doubleValue),r=wi(e.doubleValue);return n===r?Si(n)===Si(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return oi(t.arrayValue.values||[],e.arrayValue.values||[],Ai);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ci(n)!==ci(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ai(n[i],r[i])))return!1;return!0}(t,e);default:return Zr()}}function xi(t,e){return void 0!==(t.values||[]).find(function(t){return Ai(t,e)})}function ji(t,e){var n=Ni(t),r=Ni(e);if(n!==r)return ii(n,r);switch(n){case 0:return 0;case 1:return ii(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=wi(t.integerValue||t.doubleValue),r=wi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ci(t.timestampValue,e.timestampValue);case 4:return Ci(Oi(t),Oi(e));case 5:return ii(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ti(t),r=Ti(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ii(n[i],r[i]);if(0!==o)return o}return ii(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ii(wi(t.latitude),wi(e.latitude));return 0!==n?n:ii(wi(t.longitude),wi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ji(n[i],r[i]);if(o)return o}return ii(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=ii(r[s],o[s]);if(0!==a)return a;var u=ji(n[r[s]],i[o[s]]);if(0!==u)return u}return ii(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Zr()}}function Ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ii(t,e);var n=bi(t),r=bi(e),i=ii(n.seconds,r.seconds);return 0!==i?i:ii(n.nanos,r.nanos)}function Ri(t){return Pi(t)}function Pi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=bi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ti(t.bytesValue).toBase64():"referenceValue"in t?ki.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Pi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Pi(t.fields[o])}return e+"}"}(t.mapValue):Zr();var e}function Ui(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Li(t){return!!t&&"integerValue"in t}function Mi(t){return!!t&&"arrayValue"in t}function Fi(t){return!!t&&"nullValue"in t}function Vi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function qi(t){return!!t&&"mapValue"in t}function Bi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},bi(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return hi(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Bi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Bi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Ki=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!qi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bi(e)},t.prototype.setAll=function(t){var e=this,n=yi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Bi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());qi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Ai(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];qi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){hi(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Bi(this.value))},t}();function Gi(t){var e=[];return hi(t.fields,function(t,n){var r=new yi([t]);if(qi(n)){var i=Gi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new gi(e)}var zi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,ui.min(),Ki.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ki.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ki.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ki.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ki.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Qi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Hi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Qi(t,e,n,r,i,o,s)}function Wi(t){var e=ei(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Ri(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),_i(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ao(e.startAt)),e.endAt&&(n+="|ub:",n+=ao(e.endAt)),e.h=n}return e.h}function Yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!co(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Ai(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!lo(t.startAt,e.startAt)&&lo(t.endAt,e.endAt)}function Xi(t){return ki.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var $i=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Kr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ji(t,n,r):"array-contains"===n?new no(t,r):"in"===n?new ro(t,r):"not-in"===n?new io(t,r):"array-contains-any"===n?new oo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Zi(t,n):new to(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ji(e,this.value)):null!==e&&Ni(this.value)===Ni(e)&&this.m(ji(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Zr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Ji=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ki.fromName(r.referenceValue),i}return Object(Kr.c)(e,t),e.prototype.matches=function(t){var e=ki.comparator(t.key,this.key);return this.m(e)},e}($i),Zi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=eo(0,n),r}return Object(Kr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}($i),to=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=eo(0,n),r}return Object(Kr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}($i);function eo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return ki.fromName(t.referenceValue)})}var no=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Kr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Mi(e)&&xi(e.arrayValue,this.value)},e}($i),ro=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Kr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&xi(this.value.arrayValue,e)},e}($i),io=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Kr.c)(e,t),e.prototype.matches=function(t){if(xi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!xi(this.value.arrayValue,e)},e}($i),oo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Kr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return xi(e.value.arrayValue,t)})},e}($i),so=function(t,e){this.position=t,this.before=e};function ao(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Ri(t)}).join(",")}var uo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function co(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ho(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ki.comparator(ki.fromName(s.referenceValue),n.key):ji(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function lo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ai(t.position[n],e.position[n]))return!1;return!0}var fo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function po(t,e,n,r,i,o,s,a){return new fo(t,e,n,r,i,o,s,a)}function yo(t){return new fo(t)}function go(t){return!_i(t.limit)&&"F"===t.limitType}function mo(t){return!_i(t.limit)&&"L"===t.limitType}function vo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function bo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function wo(t){return null!==t.collectionGroup}function To(t){var e=ei(t);if(null===e.p){e.p=[];var n=bo(e),r=vo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new uo(n)),e.p.push(new uo(yi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new uo(yi.keyField(),u))}}}return e.p}function Io(t){var e=ei(t);if(!e.T)if("F"===e.limitType)e.T=Hi(e.path,e.collectionGroup,To(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=To(e);r<i.length;r++){var o=i[r];n.push(new uo(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new so(e.endAt.position,!e.endAt.before):null,a=e.startAt?new so(e.startAt.position,!e.startAt.before):null;e.T=Hi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Eo(t,e,n){return new fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Oo(t,e){return Yi(Io(t),Io(e))&&t.limitType===e.limitType}function _o(t){return Wi(Io(t))+"|lt:"+t.limitType}function So(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Ri(e.value);var e}).join(", ")+"]"),_i(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+ao(t.startAt)),t.endAt&&(e+=", endAt: "+ao(t.endAt)),"Target("+e+")"}(Io(t))+"; limitType="+t.limitType+")"}function Do(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ki.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ho(t.startAt,To(t),e)||t.endAt&&ho(t.endAt,To(t),e))}(t,e)}function ko(t){return function(e,n){for(var r=!1,i=0,o=To(t);i<o.length;i++){var s=o[i],a=No(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function No(t,e,n){var r=t.field.isKeyField()?ki.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ji(r,i):Zr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Zr()}}function Ao(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Si(e)?"-0":e}}function xo(t){return{integerValue:""+t}}function jo(t,e){return Di(e)?xo(e):Ao(t,e)}var Co=function(){this._=void 0};function Ro(t,e,n){return t instanceof Lo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Mo?Fo(t,e):t instanceof Vo?qo(t,e):function(t,e){var n=Uo(t,e),r=Ko(n)+Ko(t.A);return Li(n)&&Li(t.A)?xo(r):Ao(t.R,r)}(t,e)}function Po(t,e,n){return t instanceof Mo?Fo(t,e):t instanceof Vo?qo(t,e):n}function Uo(t,e){return t instanceof Bo?Li(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Lo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e}(Co),Mo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Kr.c)(e,t),e}(Co);function Fo(t,e){for(var n=Go(e),r=function(t){n.some(function(e){return Ai(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Vo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Kr.c)(e,t),e}(Co);function qo(t,e){for(var n=Go(e),r=function(t){n=n.filter(function(e){return!Ai(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Bo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Kr.c)(e,t),e}(Co);function Ko(t){return wi(t.integerValue||t.doubleValue)}function Go(t){return Mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var zo=function(t,e){this.field=t,this.transform=e},Qo=function(t,e){this.version=t,this.transformResults=e},Ho=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Wo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Yo=function(){};function Xo(t,e,n){t instanceof es?function(t,e,n){var r=t.value.clone(),i=is(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ns?function(t,e,n){if(Wo(t.precondition,e)){var r=is(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(rs(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function $o(t,e,n){t instanceof es?function(t,e,n){if(Wo(t.precondition,e)){var r=t.value.clone(),i=os(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ts(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ns?function(t,e,n){if(Wo(t.precondition,e)){var r=os(t.fieldTransforms,n,e),i=e.data;i.setAll(rs(t)),i.setAll(r),e.convertToFoundDocument(ts(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Wo(t.precondition,e)&&e.convertToNoDocument(ui.min())}(t,e)}function Jo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Uo(o.transform,s||null);null!=a&&(null==n&&(n=Ki.empty()),n.set(o.field,a))}return n||null}function Zo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&oi(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Mo&&e instanceof Mo||t instanceof Vo&&e instanceof Vo?oi(t.elements,e.elements,Ai):t instanceof Bo&&e instanceof Bo?Ai(t.A,e.A):t instanceof Lo&&e instanceof Lo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ts(t){return t.isFoundDocument()?t.version:ui.min()}var es=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Kr.c)(e,t),e}(Yo),ns=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Kr.c)(e,t),e}(Yo);function rs(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function is(t,e,n){var r=new Map;ti(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Po(s,a,n[i]))}return r}function os(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Ro(a,u,e))}return r}var ss,as,us=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Kr.c)(e,t),e}(Yo),cs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Kr.c)(e,t),e}(Yo),hs=function(t){this.count=t};function ls(t){switch(t){case zr.OK:return Zr();case zr.CANCELLED:case zr.UNKNOWN:case zr.DEADLINE_EXCEEDED:case zr.RESOURCE_EXHAUSTED:case zr.INTERNAL:case zr.UNAVAILABLE:case zr.UNAUTHENTICATED:return!1;case zr.INVALID_ARGUMENT:case zr.NOT_FOUND:case zr.ALREADY_EXISTS:case zr.PERMISSION_DENIED:case zr.FAILED_PRECONDITION:case zr.ABORTED:case zr.OUT_OF_RANGE:case zr.UNIMPLEMENTED:case zr.DATA_LOSS:return!0;default:return Zr()}}function fs(t){if(void 0===t)return Xr("GRPC error has no .code"),zr.UNKNOWN;switch(t){case ss.OK:return zr.OK;case ss.CANCELLED:return zr.CANCELLED;case ss.UNKNOWN:return zr.UNKNOWN;case ss.DEADLINE_EXCEEDED:return zr.DEADLINE_EXCEEDED;case ss.RESOURCE_EXHAUSTED:return zr.RESOURCE_EXHAUSTED;case ss.INTERNAL:return zr.INTERNAL;case ss.UNAVAILABLE:return zr.UNAVAILABLE;case ss.UNAUTHENTICATED:return zr.UNAUTHENTICATED;case ss.INVALID_ARGUMENT:return zr.INVALID_ARGUMENT;case ss.NOT_FOUND:return zr.NOT_FOUND;case ss.ALREADY_EXISTS:return zr.ALREADY_EXISTS;case ss.PERMISSION_DENIED:return zr.PERMISSION_DENIED;case ss.FAILED_PRECONDITION:return zr.FAILED_PRECONDITION;case ss.ABORTED:return zr.ABORTED;case ss.OUT_OF_RANGE:return zr.OUT_OF_RANGE;case ss.UNIMPLEMENTED:return zr.UNIMPLEMENTED;case ss.DATA_LOSS:return zr.DATA_LOSS;default:return Zr()}}(as=ss||(ss={}))[as.OK=0]="OK",as[as.CANCELLED=1]="CANCELLED",as[as.UNKNOWN=2]="UNKNOWN",as[as.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",as[as.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",as[as.NOT_FOUND=5]="NOT_FOUND",as[as.ALREADY_EXISTS=6]="ALREADY_EXISTS",as[as.PERMISSION_DENIED=7]="PERMISSION_DENIED",as[as.UNAUTHENTICATED=16]="UNAUTHENTICATED",as[as.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",as[as.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",as[as.ABORTED=10]="ABORTED",as[as.OUT_OF_RANGE=11]="OUT_OF_RANGE",as[as.UNIMPLEMENTED=12]="UNIMPLEMENTED",as[as.INTERNAL=13]="INTERNAL",as[as.UNAVAILABLE=14]="UNAVAILABLE",as[as.DATA_LOSS=15]="DATA_LOSS";var ds=function(){function t(t,e){this.comparator=t,this.root=e||ys.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ys.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ys.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ps(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ps(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ps(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ps(this.root,t,this.comparator,!0)},t}(),ps=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ys=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Zr();if(this.right.isRed())throw Zr();var t=this.left.check();if(t!==this.right.check())throw Zr();return t+(this.isRed()?0:1)},t}();ys.EMPTY=null,ys.RED=!0,ys.BLACK=!1,ys.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Zr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Zr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Zr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Zr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Zr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ys(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var gs=function(){function t(t){this.comparator=t,this.data=new ds(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ms(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ms(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ms=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),vs=new ds(ki.comparator);function bs(){return vs}var ws=new ds(ki.comparator);function Ts(){return ws}var Is=new ds(ki.comparator);function Es(){return Is}var Os=new gs(ki.comparator);function _s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Os,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ss=new gs(ii);function Ds(){return Ss}var ks=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Ns.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(ui.min(),r,Ds(),bs(),_s())},t}(),Ns=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(mi.EMPTY_BYTE_STRING,n,_s(),_s(),_s())},t}(),As=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},xs=function(t,e){this.targetId=t,this.V=e},js=function(t,e,n,r){void 0===n&&(n=mi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Cs=function(){function t(){this.S=0,this.D=Us(),this.C=mi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=_s(),e=_s(),n=_s();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Zr()}}),new Ns(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Us()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Rs=function(){function t(t){this.W=t,this.G=new Map,this.H=bs(),this.J=Ps(),this.Y=new gs(ii)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Zr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Xi(i))if(0===n){var o=new ki(i.path);this.tt(e,o,zi.newNoDocument(o,ui.min()))}else ti(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Xi(o.target)){var s=new ki(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,zi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=_s();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ks(t,n,this.Y,this.H,r);return this.H=bs(),this.J=Ps(),this.Y=new gs(ii),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Cs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new gs(ii),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Yr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Cs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Ps(){return new ds(ki.comparator)}function Us(){return new ds(ki.comparator)}var Ls={asc:"ASCENDING",desc:"DESCENDING"},Ms={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Fs=function(t,e){this.databaseId=t,this.I=e};function Vs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function qs(t,e){return t.I?e.toBase64():e.toUint8Array()}function Bs(t,e){return Vs(t,e.toTimestamp())}function Ks(t){return ti(!!t),ui.fromTimestamp(function(t){var e=bi(t);return new ai(e.seconds,e.nanos)}(t))}function Gs(t,e){return function(t){return new di(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function zs(t){var e=di.fromString(t);return ti(ya(e)),e}function Qs(t,e){return Gs(t.databaseId,e.path)}function Hs(t,e){var n=zs(e);if(n.get(1)!==t.databaseId.projectId)throw new Qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ki($s(n))}function Ws(t,e){return Gs(t.databaseId,e)}function Ys(t){var e=zs(t);return 4===e.length?di.emptyPath():$s(e)}function Xs(t){return new di(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $s(t){return ti(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Js(t,e,n){return{name:Qs(t,e),fields:n.value.mapValue.fields}}function Zs(t,e,n){var r=Hs(t,e.name),i=Ks(e.updateTime),o=new Ki({mapValue:{fields:e.fields}}),s=zi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function ta(t,e){var n;if(e instanceof es)n={update:Js(t,e.key,e.value)};else if(e instanceof us)n={delete:Qs(t,e.key)};else if(e instanceof ns)n={update:Js(t,e.key,e.data),updateMask:pa(e.fieldMask)};else{if(!(e instanceof cs))return Zr();n={verify:Qs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Lo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Mo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Vo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Bo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Zr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Bs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Zr()}(t,e.precondition)),n}function ea(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ho.updateTime(Ks(t.updateTime)):void 0!==t.exists?Ho.exists(t.exists):Ho.none()}(e.currentDocument):Ho.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(ti("REQUEST_TIME"===e.setToServerValue),n=new Lo):"appendMissingElements"in e?n=new Mo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Vo(e.removeAllFromArray.values||[]):"increment"in e?n=new Bo(t,e.increment):Zr();var r=yi.fromServerFormat(e.fieldPath);return new zo(r,n)}(t,e)}):[];if(e.update){var i=Hs(t,e.update.name),o=new Ki({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new gi((t.fieldPaths||[]).map(function(t){return yi.fromServerFormat(t)}))}(e.updateMask);return new ns(i,o,s,n,r)}return new es(i,o,n,r)}if(e.delete){var a=Hs(t,e.delete);return new us(a,n)}if(e.verify){var u=Hs(t,e.verify);return new cs(u,n)}return Zr()}function na(t,e){return{documents:[Ws(t,e.path)]}}function ra(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ws(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ws(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Vi(t.value))return{unaryFilter:{field:ha(t.field),op:"IS_NAN"}};if(Fi(t.value))return{unaryFilter:{field:ha(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Vi(t.value))return{unaryFilter:{field:ha(t.field),op:"IS_NOT_NAN"}};if(Fi(t.value))return{unaryFilter:{field:ha(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ha(t.field),op:ca(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:ha(t.field),direction:ua(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||_i(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=sa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=sa(e.endAt)),n}function ia(t){var e=Ys(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ti(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=oa(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new uo(la(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return _i(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=aa(n.startAt));var h=null;return n.endAt&&(h=aa(n.endAt)),po(e,i,a,s,u,"F",c,h)}function oa(t){return t?void 0!==t.unaryFilter?[da(t)]:void 0!==t.fieldFilter?[fa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return oa(t)}).reduce(function(t,e){return t.concat(e)}):Zr():[]}function sa(t){return{before:t.before,values:t.position}}function aa(t){return new so(t.values||[],!!t.before)}function ua(t){return Ls[t]}function ca(t){return Ms[t]}function ha(t){return{fieldPath:t.canonicalString()}}function la(t){return yi.fromServerFormat(t.fieldPath)}function fa(t){return $i.create(la(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Zr()}}(t.fieldFilter.op),t.fieldFilter.value)}function da(t){switch(t.unaryFilter.op){case"IS_NAN":var e=la(t.unaryFilter.field);return $i.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=la(t.unaryFilter.field);return $i.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=la(t.unaryFilter.field);return $i.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=la(t.unaryFilter.field);return $i.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Zr()}}function pa(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ya(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ga(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=va(e)),e=ma(t.get(n),e);return va(e)}function ma(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function va(t){return t+"\x01\x01"}function ba(t){var e=t.length;if(ti(e>=2),2===e)return ti("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),di.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Zr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Zr()}o=s+2}return new di(r)}var wa=function(t,e){this.seconds=t,this.nanoseconds=e},Ta=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ta.store="owner",Ta.key="owner";var Ia=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ia.store="mutationQueues",Ia.keyPath="userId";var Ea=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ea.store="mutations",Ea.keyPath="batchId",Ea.userMutationsIndex="userMutationsIndex",Ea.userMutationsKeyPath=["userId","batchId"];var Oa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ga(e)]},t.key=function(t,e,n){return[t,ga(e),n]},t}();Oa.store="documentMutations",Oa.PLACEHOLDER=new Oa;var _a=function(t,e){this.path=t,this.readTime=e},Sa=function(t,e){this.path=t,this.version=e},Da=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Da.store="remoteDocuments",Da.readTimeIndex="readTimeIndex",Da.readTimeIndexPath="readTime",Da.collectionReadTimeIndex="collectionReadTimeIndex",Da.collectionReadTimeIndexPath=["parentPath","readTime"];var ka=function(t){this.byteSize=t};ka.store="remoteDocumentGlobal",ka.key="remoteDocumentGlobalKey";var Na=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Na.store="targets",Na.keyPath="targetId",Na.queryTargetsIndexName="queryTargetsIndex",Na.queryTargetsKeyPath=["canonicalId","targetId"];var Aa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Aa.store="targetDocuments",Aa.keyPath=["targetId","path"],Aa.documentTargetsIndex="documentTargetsIndex",Aa.documentTargetsKeyPath=["path","targetId"];var xa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};xa.key="targetGlobalKey",xa.store="targetGlobal";var ja=function(t,e){this.collectionId=t,this.parent=e};ja.store="collectionParents",ja.keyPath=["collectionId","parent"];var Ca=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ca.store="clientMetadata",Ca.keyPath="clientId";var Ra=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ra.store="bundles",Ra.keyPath="bundleId";var Pa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Pa.store="namedQueries",Pa.keyPath="name";var Ua=Object(Kr.f)(Object(Kr.f)([],Object(Kr.f)(Object(Kr.f)([],Object(Kr.f)(Object(Kr.f)([],Object(Kr.f)(Object(Kr.f)([],[Ia.store,Ea.store,Oa.store,Da.store,Na.store,Ta.store,xa.store,Aa.store]),[Ca.store])),[ka.store])),[ja.store])),[Ra.store,Pa.store]),La="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ma=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Fa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Va=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Zr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),qa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Fa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ga(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ya(e.target.error);n.ft.reject(new Ga(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ga(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Yr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Qa(e)},t}(),Ba=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(j.i)())&&Xr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Yr("SimpleDb","Removing database:",t),Ha(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(j.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Yr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ga(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Qr(zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ga(t,n))},i.onupgradeneeded=function(t){Yr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Yr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Kr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Kr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=qa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Va.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Yr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ka=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Ha(this.Pt.delete())},t}(),Ga=function(t){function e(e,n){var r=this;return(r=t.call(this,zr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Kr.c)(e,t),e}(Qr);function za(t){return"IndexedDbTransactionError"===t.name}var Qa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Yr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Yr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ha(n)},t.prototype.add=function(t){return Yr("SimpleDb","ADD",this.store.name,t,t),Ha(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ha(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Yr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Yr("SimpleDb","DELETE",this.store.name,t),Ha(this.store.delete(t))},t.prototype.count=function(){return Yr("SimpleDb","COUNT",this.store.name),Ha(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Yr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Va(function(n,r){e.onerror=function(t){var e=Ya(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Va(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ka(i),s=e(i.primaryKey,i.value,o);if(s instanceof Va){var a=s.catch(function(t){return o.done(),Va.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Va.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ha(t){return new Va(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Ya(t.target.error);n(e)}})}var Wa=!1;function Ya(t){var e=Ba._t(Object(j.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Wa||(Wa=!0,setTimeout(function(){throw r},0)),r}}return t}var Xa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Kr.c)(e,t),e}(Ma);function $a(t,e){var n=ei(t);return Ba.It(n.Mt,e)}var Ja=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Xo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&$o(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&$o(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ui.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},_s())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&oi(this.mutations,t.mutations,function(t,e){return Zo(t,e)})&&oi(this.baseMutations,t.baseMutations,function(t,e){return Zo(t,e)})},t}(),Za=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){ti(e.mutations.length===r.length);for(var i=Es(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),tu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=ui.min()),void 0===o&&(o=ui.min()),void 0===s&&(s=mi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),eu=function(t){this.Lt=t};function nu(t,e){if(e.document)return Zs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ki.fromSegments(e.noDocument.path),r=au(e.noDocument.readTime),i=zi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ki.fromSegments(e.unknownDocument.path);return r=au(e.unknownDocument.version),zi.newUnknownDocument(o,r)}return Zr()}function ru(t,e,n){var r=iu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Qs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Vs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Da(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=su(e.version);return s=e.hasCommittedMutations,new Da(null,new _a(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=su(e.version);return new Da(new Sa(c,h),null,null,!0,r,i)}return Zr()}function iu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ou(t){var e=new ai(t[0],t[1]);return ui.fromTimestamp(e)}function su(t){var e=t.toTimestamp();return new wa(e.seconds,e.nanoseconds)}function au(t){var e=new ai(t.seconds,t.nanoseconds);return ui.fromTimestamp(e)}function uu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return ea(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return ea(t.Lt,e)}),o=ai.fromMillis(e.localWriteTimeMs);return new Ja(e.batchId,o,n,i)}function cu(t){var e,n,r=au(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?au(t.lastLimboFreeSnapshotVersion):ui.min();return void 0!==t.query.documents?(ti(1===(n=t.query).documents.length),e=Io(yo(Ys(n.documents[0])))):e=function(t){return Io(ia(t))}(t.query),new tu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,mi.fromBase64String(t.resumeToken))}function hu(t,e){var n,r=su(e.snapshotVersion),i=su(e.lastLimboFreeSnapshotVersion);n=Xi(e.target)?na(t.Lt,e.target):ra(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Na(e.targetId,Wi(e.target),r,o,e.sequenceNumber,i,n)}function lu(t){var e=ia({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Eo(e,e.limit,"L"):e}var fu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return du(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:au(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return du(t).put({bundleId:(n=e).id,createTime:su(Ks(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return pu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:lu(e.bundledQuery),readTime:au(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return pu(t).put(function(t){return{name:t.name,readTime:su(Ks(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function du(t){return $a(t,Ra.store)}function pu(t){return $a(t,Pa.store)}var yu=function(){function t(){this.Bt=new gu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Va.resolve()},t.prototype.getCollectionParents=function(t,e){return Va.resolve(this.Bt.getEntries(e))},t}(),gu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new gs(di.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new gs(di.comparator)).toArray()},t}(),mu=function(){function t(){this.qt=new gu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:ga(i)};return vu(t).put(o)}return Va.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[si(e),""],!1,!0);return vu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ba(o.parent))}return n})},t}();function vu(t){return $a(t,ja.store)}var bu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Tu(t,e,n){var r=t.store(Ea.store),i=t.store(Oa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){ti(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Oa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Va.waitFor(o).next(function(){return c})}function Iu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Zr();e=t.noDocument}return JSON.stringify(e).length}wu.DEFAULT_COLLECTION_PERCENTILE=10,wu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wu.DEFAULT=new wu(41943040,wu.DEFAULT_COLLECTION_PERCENTILE,wu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wu.DISABLED=new wu(-1,0,0);var Eu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return ti(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _u(t).$t({index:Ea.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Su(t),s=_u(t);return s.add({}).next(function(a){ti("number"==typeof a);for(var u=new Ja(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return ta(t.Lt,e)}),i=n.mutations.map(function(e){return ta(t.Lt,e)});return new Ea(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new gs(function(t,e){return ii(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=Oa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Oa.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),Va.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return _u(t).get(e).next(function(t){return t?(ti(t.userId===n.userId),uu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?Va.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return _u(t).$t({index:Ea.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(ti(e.batchId>=r),o=uu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return _u(t).$t({index:Ea.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _u(t).Nt(Ea.userMutationsIndex,n).next(function(t){return t.map(function(t){return uu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Oa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Su(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=ba(r[1]);if(a===n.userId&&e.path.isEqual(c))return _u(t).get(u).next(function(t){if(!t)throw Zr();ti(t.userId===n.userId),o.push(uu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new gs(ii),i=[];return e.forEach(function(e){var o=Oa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Su(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=ba(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Va.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Oa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new gs(ii);return Su(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=ba(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(_u(t).get(e).next(function(t){if(null===t)throw Zr();ti(t.userId===n.userId),r.push(uu(n.R,t))}))}),Va.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Tu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Va.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Va.resolve();var r=IDBKeyRange.lowerBound(Oa.prefixForUser(e.userId)),i=[];return Su(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=ba(t[1]);i.push(o)}else r.done()}).next(function(){ti(0===i.length)})})},t.prototype.containsKey=function(t,e){return Ou(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Du(t).get(this.userId).next(function(t){return t||new Ia(e.userId,-1,"")})},t}();function Ou(t,e,n){var r=Oa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Su(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function _u(t){return $a(t,Ea.store)}function Su(t){return $a(t,Oa.store)}function Du(t){return $a(t,Ia.store)}var ku=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Nu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new ku(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return ui.fromTimestamp(new ai(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Au(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return ti(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Au(t).$t(function(s,a){var u=cu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Va.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Au(t).$t(function(t,n){var r=cu(n);e(r)})},t.prototype.Xt=function(t){return xu(t).get(xa.key).next(function(t){return ti(null!==t),t})},t.prototype.Zt=function(t,e){return xu(t).put(xa.key,e)},t.prototype.te=function(t,e){return Au(t).put(hu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Wi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Au(t).$t({range:r,index:Na.queryTargetsIndexName},function(t,n,r){var o=cu(n);Yi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ju(t);return e.forEach(function(e){var s=ga(e.path);i.push(o.put(new Aa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Va.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ju(t);return Va.forEach(e,function(e){var o=ga(e.path);return Va.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ju(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ju(t),i=_s();return r.$t({range:n,kt:!0},function(t,e,n){var r=ba(t[1]),o=new ki(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ga(e.path),r=IDBKeyRange.bound([n],[si(n)],!1,!0),i=0;return ju(t).$t({index:Aa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Au(t).get(e).next(function(t){return t?cu(t):null})},t}();function Au(t){return $a(t,Na.store)}function xu(t){return $a(t,xa.store)}function ju(t){return $a(t,Aa.store)}function Cu(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){if(t.code!==zr.FAILED_PRECONDITION||t.message!==La)throw t;return Yr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ru(t,e){var n=t[1],r=e[1],i=ii(t[0],e[0]);return 0===i?ii(n,r):i}var Pu=function(){function t(t){this.ne=t,this.buffer=new gs(Ru),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ru(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Uu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Yr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Kr.b)(e,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return za(e=n.sent())?(Yr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Cu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Lu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Va.resolve(Gr.o);var r=new Pu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Yr("LruGarbageCollector","Garbage collection skipped; disabled"),Va.resolve(bu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Yr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),bu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Yr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Wr()<=C.a.DEBUG&&Yr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Va.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Mu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Lu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Fu(t,n)},t.prototype.removeReference=function(t,e,n){return Fu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Fu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Du(t).Ot(function(r){return Ou(t,r,e).next(function(t){return t&&(n=!0),Va.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),ju(t).delete([0,ga(s.path)])})});i.push(u)}}).next(function(){return Va.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Fu(t,e)},t.prototype.we=function(t,e){var n,r=ju(t),i=Gr.o;return r.$t({index:Aa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Gr.o&&e(new ki(ba(n)),i),i=s,n=o):i=Gr.o}).next(function(){i!==Gr.o&&e(new ki(ba(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Fu(t,e){return ju(t).put(function(t,e){return new Aa(0,ga(t.path),e)}(e,t.currentSequenceNumber))}var Vu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){hi(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return li(this.inner)},t}(),qu=function(){function t(){this.changes=new Vu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:ui.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:zi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Va.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Bu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return zu(t).put(Qu(e),n)},t.prototype.removeEntry=function(t,e){var n=zu(t),r=Qu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return zu(t).get(Qu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return zu(t).get(Qu(e)).next(function(t){return{document:n.ye(e,t),size:Iu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=bs();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=bs(),i=new ds(ki.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Iu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Va.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return zu(t).$t({range:r},function(t,e,r){for(var s=ki.fromSegments(t);o&&ki.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=bs(),o=e.path.length+1,s={};if(n.isEqual(ui.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=iu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Da.collectionReadTimeIndex}return zu(t).$t(s,function(t,n,s){if(t.length===o){var a=nu(r.R,n);e.path.isPrefixOf(a.key.path)?Do(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Ku(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Gu(t).get(ka.key).next(function(t){return ti(!!t),t})},t.prototype.me=function(t,e){return Gu(t).put(ka.key,e)},t.prototype.ye=function(t,e){if(e){var n=nu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(ui.min()))return n}return zi.newInvalidDocument(t)},t}(),Ku=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Vu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Kr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new gs(function(t,e){return ii(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=ru(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Iu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=ru(e.Ie.R,zi.newNoDocument(o,ui.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Va.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(qu);function Gu(t){return $a(t,ka.store)}function zu(t){return $a(t,Da.store)}function Qu(t){return t.path.toArray()}var Hu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;ti(n<r&&n>=0&&r<=11);var o=new qa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ta.store)}(t),function(t){t.createObjectStore(Ia.store,{keyPath:Ia.keyPath}),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Oa.store)}(t),Wu(t),function(t){t.createObjectStore(Da.store)}(t));var s=Va.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Aa.store),t.deleteObjectStore(Na.store),t.deleteObjectStore(xa.store)}(t),Wu(t)),s=s.next(function(){return function(t){var e=t.store(xa.store),n=new xa(0,0,ui.min().toTimestamp(),0);return e.put(xa.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Ea.store).Nt().next(function(n){t.deleteObjectStore(Ea.store),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0});var r=e.store(Ea.store),i=n.map(function(t){return r.put(t)});return Va.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(ka.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Da.store);e.createIndex(Da.readTimeIndex,Da.readTimeIndexPath,{unique:!1}),e.createIndex(Da.collectionReadTimeIndex,Da.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t),function(t){t.createObjectStore(Pa.store,{keyPath:Pa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Da.store).$t(function(t,n){e+=Iu(n)}).next(function(){var n=new ka(e);return t.store(ka.store).put(ka.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Ia.store),r=t.store(Ea.store);return n.Nt().next(function(n){return Va.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Ea.userMutationsIndex,i).next(function(r){return Va.forEach(r,function(r){ti(r.userId===n.userId);var i=uu(e.R,r);return Tu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Aa.store),n=t.store(Da.store);return t.store(xa.store).get(xa.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new di(n),s=function(t){return[0,ga(t)]}(o);r.push(e.get(s).next(function(n){return n?Va.resolve():function(n){return e.put(new Aa(0,ga(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Va.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ja.store,{keyPath:ja.keyPath});var n=e.store(ja.store),r=new gu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ga(i)})}};return e.store(Da.store).$t({kt:!0},function(t,e){var n=new di(t);return i(n.popLast())}).next(function(){return e.store(Oa.store).$t({kt:!0},function(t,e){var n=ba(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Na.store);return n.$t(function(t,r){var i=cu(r),o=hu(e.R,i);return n.put(o)})},t}();function Wu(t){t.createObjectStore(Aa.store,{keyPath:Aa.keyPath}).createIndex(Aa.documentTargetsIndex,Aa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Na.store,{keyPath:Na.keyPath}).createIndex(Na.queryTargetsIndexName,Na.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(xa.store)}var Yu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Xu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Qr(zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Mu(this,i),this.Le=n+"main",this.R=new eu(u),this.Be=new Ba(this.Le,11,new Hu(this.R)),this.qe=new Nu(this.referenceDelegate,this.R),this.Ut=new mu,this.Ue=function(t,e){return new Bu(t,e)}(this.R,this.Ut),this.Qe=new fu,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Xr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Qr(zr.FAILED_PRECONDITION,Yu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Gr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Kr.b)(e,void 0,void 0,function(){return Object(Kr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Kr.b)(e,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Kr.b)(e,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Ju(e).put(new Ca(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(za(e))return Yr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Yr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return $u(t).get(Ta.key).next(function(t){return Va.resolve(e.tn(t))})},t.prototype.en=function(t){return Ju(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=$a(t,Ca.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Va.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Va.resolve(!0):$u(t).get(Ta.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Qr(zr.FAILED_PRECONDITION,Yu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ju(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Yr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t=this;return Object(Kr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ta.store,Ca.store],function(e){var n=new Xa(e,Gr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Ju(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Eu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Yr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ua,function(o){return r=new Xa(o,i.Ne?i.Ne.next():Gr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Xr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Qr(zr.FAILED_PRECONDITION,La);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return $u(t).get(Ta.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Qr(zr.FAILED_PRECONDITION,Yu)})},t.prototype.Ze=function(t){var e=new Ta(this.clientId,this.allowTabSynchronization,Date.now());return $u(t).put(Ta.key,e)},t.yt=function(){return Ba.yt()},t.prototype.Xe=function(t){var e=this,n=$u(t);return n.get(Ta.key).next(function(t){return e.tn(t)?(Yr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ta.key)):Va.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Xr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Yr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Xr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Xr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function $u(t){return $a(t,Ta.store)}function Ju(t){return $a(t,Ca.store)}function Zu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var tc=function(t,e){this.progress=t,this.wn=e},ec=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return ki.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):wo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new ki(e)).next(function(t){var e=Ts();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Ts();return this.Ut.getCollectionParents(t,i).next(function(s){return Va.forEach(s,function(s){var a=function(t,e){return new fo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=zi.newInvalidDocument(c),r=r.insert(c,h)),$o(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Do(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=_s(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ns&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),nc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=_s(),i=_s(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),rc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ui.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(go(e)||mo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Wr()<=C.a.DEBUG&&Yr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),So(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new gs(ko(t));return e.forEach(function(e,r){Do(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Wr()<=C.a.DEBUG&&Yr("QueryEngine","Using full collection scan to execute query:",So(e)),this.Sn.getDocumentsMatchingQuery(t,e,ui.min())},t}(),ic=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new ds(ii),this.kn=new Vu(function(t){return Wi(t)},Yi),this.$n=ui.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new ec(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function oc(t,e,n,r){return new ic(t,e,n,r)}function sc(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Kr.d)(this,function(s){switch(s.label){case 0:return n=ei(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new ec(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=_s(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function ac(t,e){var n=ei(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Va.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);ti(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function uc(t){var e=ei(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function cc(t,e){var n=ei(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return ti(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=bs();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(hc(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(ui.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Va.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function hc(t,e,n,r,i){var o=_s();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=bs();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(ui.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Yr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function lc(t,e){var n=ei(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function fc(t,e){var n=ei(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Va.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new tu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function dc(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:r=ei(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!za(s=a.sent()))throw s;return Yr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function pc(t,e,n){var r=ei(t),i=ui.min(),o=_s();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=ei(t),i=r.kn.get(n);return void 0!==i?Va.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Io(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:ui.min(),n?o:_s())}).next(function(t){return{documents:t,Bn:o}})})}function yc(t,e){var n=ei(t),r=ei(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function gc(t){var e=ei(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=ei(t),i=bs(),o=iu(n),s=zu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Da.readTimeIndex,range:a},function(t,e){var n=nu(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:ou(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function mc(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){return[2,(e=ei(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=zu(t),n=ui.min();return e.$t({index:Da.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=ou(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function vc(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Kr.d)(this,function(p){switch(p.label){case 0:for(i=ei(t),o=_s(),s=bs(),a=Es(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,fc(i,function(t){return Io(yo(di.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return hc(t,f,s,ui.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function bc(t,e,n){return void 0===n&&(n=_s()),Object(Kr.b)(this,void 0,void 0,function(){var r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return[4,fc(t,Io(lu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=ei(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Ks(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(mi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var wc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Va.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ks(n.createTime)}),Va.resolve()},t.prototype.getNamedQuery=function(t,e){return Va.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:lu(t.bundledQuery),readTime:Ks(t.readTime)}}(e)),Va.resolve()},t}(),Tc=function(){function t(){this.Wn=new gs(Ic.Gn),this.zn=new gs(Ic.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ic(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Ic(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new ki(new di([])),r=new Ic(n,t),i=new Ic(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ki(new di([])),n=new Ic(e,t),r=new Ic(e,t+1),i=_s();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Ic(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ic=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ki.comparator(t.key,e.key)||ii(t.ns,e.ns)},t.Hn=function(t,e){return ii(t.ns,e.ns)||ki.comparator(t.key,e.key)},t}(),Ec=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new gs(Ic.Gn)}return t.prototype.checkEmpty=function(t){return Va.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ja(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Ic(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Va.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Va.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Va.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Va.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Va.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ic(e,0),i=new Ic(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Va.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new gs(ii);return e.forEach(function(t){var e=new Ic(t,0),i=new Ic(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Va.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ki.isDocumentKey(i)||(i=i.child(""));var o=new Ic(new ki(i),0),s=new gs(ii);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Va.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ti(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Va.forEach(e.mutations,function(i){var o=new Ic(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Ic(e,0),r=this.rs.firstAfterOrEqual(n);return Va.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Va.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Oc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new ds(ki.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Va.resolve(n?n.document.clone():zi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=bs();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():zi.newInvalidDocument(t))}),Va.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=bs(),i=new ki(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Do(e,u)&&(r=r.insert(u.key,u.clone()))}return Va.resolve(r)},t.prototype.fs=function(t,e){return Va.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new _c(this)},t.prototype.getSize=function(t){return Va.resolve(this.size)},t}(),_c=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Kr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Va.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(qu),Sc=function(){function t(t){this.persistence=t,this.ds=new Vu(function(t){return Wi(t)},Yi),this.lastRemoteSnapshotVersion=ui.min(),this.highestTargetId=0,this.ws=0,this._s=new Tc,this.targetCount=0,this.ys=ku.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Va.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Va.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Va.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Va.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Va.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new ku(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Va.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Va.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Va.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Va.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Va.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Va.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Va.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Va.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Va.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Va.resolve(n)},t.prototype.containsKey=function(t,e){return Va.resolve(this._s.containsKey(e))},t}(),Dc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Gr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Sc(this),this.Ut=new yu,this.Ue=function(t,e){return new Oc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new eu(e),this.Qe=new wc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Ec(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Yr("MemoryPersistence","Starting transaction:",t);var i=new kc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Va.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),kc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Kr.c)(e,t),e}(Ma),Nc=function(){function t(t){this.persistence=t,this.As=new Tc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Zr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Va.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Va.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Va.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Va.forEach(this.vs,function(r){var i=ki.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Va.or([function(){return Va.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Ac=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function xc(t,e){return"firestore_clients_"+t+"_"+e}function jc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Cc(t,e){return"firestore_targets_"+t+"_"+e}Ac.UNAUTHENTICATED=new Ac(null),Ac.GOOGLE_CREDENTIALS=new Ac("google-credentials-uid"),Ac.FIRST_PARTY=new Ac("first-party-uid");var Rc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Qr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Xr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Pc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Qr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Xr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Uc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ds(),s=0;i&&s<r.activeTargetIds.length;++s)i=Di(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Xr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Lc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Xr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Mc=function(){function t(){this.activeTargetIds=Ds()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Fc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new ds(ii),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=xc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Mc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Kr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(xc(this.persistenceKey,r)))&&(o=Uc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Cc(this.persistenceKey,t));if(n){var r=Pc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Cc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Yr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Yr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Yr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Yr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Xr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Kr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Kr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Gr.o;if(null!=t)try{var n=JSON.parse(t);ti("number"==typeof n),e=n}catch(t){Xr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Gr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Rc(this.currentUser,t,e,n),i=jc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=jc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Cc(this.persistenceKey,t),i=new Pc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Uc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Rc.Vs(new Ac(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Pc.Vs(r,e)},t.prototype.js=function(t){return Lc.Vs(t)},t.prototype.ii=function(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Yr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ds();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Vc=function(){function t(){this.li=new Mc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Mc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),qc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Bc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Yr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Yr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Kc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Gc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),zc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(Kr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Br;s.listenOnce(Mr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Lr.NO_ERROR:var e=s.getResponseJson();Yr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Lr.TIMEOUT:Yr("Connection",'RPC "'+t+'" timed out'),o(new Qr(zr.DEADLINE_EXCEEDED,"Request time out"));break;case Lr.HTTP_ERROR:var n=s.getStatus();if(Yr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(zr).indexOf(e)>=0?e:zr.UNKNOWN}(r.status);o(new Qr(a,r.message))}else o(new Qr(zr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Qr(zr.UNAVAILABLE,"Connection failed."));break;default:Zr()}}finally{Yr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Sr,i=ke(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Vr({})),this.Fi(o.initMessageHeaders,e),Object(j.n)()||Object(j.p)()||Object(j.l)()||Object(j.m)()||Object(j.q)()||Object(j.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Yr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Gc({Ei:function(t){c?Yr("Connection","Not sending because WebChannel is closed:",t):(u||(Yr("Connection","Opening WebChannel transport."),a.open(),u=!0),Yr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,qr.EventType.OPEN,function(){c||Yr("Connection","WebChannel transport opened.")}),l(a,qr.EventType.CLOSE,function(){c||(c=!0,Yr("Connection","WebChannel transport closed"),h.Vi())}),l(a,qr.EventType.ERROR,function(t){c||(c=!0,$r("Connection","WebChannel transport errored:",t),h.Vi(new Qr(zr.UNAVAILABLE,"The operation could not be completed")))}),l(a,qr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];ti(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Yr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=ss[t];if(void 0!==e)return fs(e)}(i),s=r.message;void 0===o&&(o=zr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Qr(o,s)),a.close()}else Yr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Fr.STAT_EVENT,function(t){10===t.stat?Yr("Connection","Detected buffering proxy"):11===t.stat&&Yr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Yr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Yr("RestConnection","Received: ",t),t},function(e){throw $r("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.8",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Kc[t]},t}());function Qc(){return"undefined"!=typeof window?window:null}function Hc(){return"undefined"!=typeof document?document:null}function Wc(t){return new Fs(t,!0)}var Yc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Yr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Xc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Yc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===zr.RESOURCE_EXHAUSTED?(Xr(e.toString()),Xr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===zr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Qr(zr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Kr.b)(t,void 0,void 0,function(){return Object(Kr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Yr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Yr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),$c=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Kr.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Zr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(ti(void 0===e||"string"==typeof e),mi.fromBase64String(e||"")):(ti(void 0===e||e instanceof Uint8Array),mi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?zr.UNKNOWN:fs(t.code);return new Qr(e,t.message||"")}(a);n=new js(r,i,o,s||null)}else if("documentChange"in e){i=Hs(t,(r=e.documentChange).document.name),o=Ks(r.document.updateTime);var a=new Ki({mapValue:{fields:r.document.fields}}),u=(s=zi.newFoundDocument(i,o,a),r.targetIds||[]);n=new As(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Hs(t,(r=e.documentDelete).document),o=r.readTime?Ks(r.readTime):ui.min(),a=zi.newNoDocument(i,o),n=new As([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Hs(t,(r=e.documentRemove).document),n=new As([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Zr();var c=e.filter;i=new hs(r=c.count||0),n=new xs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return ui.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?ui.min():e.readTime?Ks(e.readTime):ui.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Xs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Xi(r)?{documents:na(t,r)}:{query:ra(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=qs(t,e.resumeToken):e.snapshotVersion.compareTo(ui.min())>0&&(n.readTime=Vs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Zr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Xs(this.R),e.removeTarget=t,this.cr(e)},e}(Xc),Jc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Kr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(ti(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(ti(void 0!==e),t.map(function(t){return function(t,e){var n=Ks(t.updateTime?t.updateTime:e);return n.isEqual(ui.min())&&(n=Ks(e)),new Qo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ks(t.commitTime);return this.listener.Tr(n,e)}return ti(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Xs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ta(e.R,t)})};this.cr(n)},e}(Xc),Zc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Kr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Qr(zr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===zr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Qr(zr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===zr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Qr(zr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),th=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Xr(e),this.Vr=!1):Yr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),eh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Kr.b)(o,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return hh(this)?(Yr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return(e=ei(t)).Or.add(4),[4,rh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,nh(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new th(n,r)};function nh(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:if(!hh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function rh(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ih(t,e){var n=ei(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),ch(n)?uh(n):_h(n).er()&&sh(n,e))}function oh(t,e){var n=ei(t),r=_h(n);n.$r.delete(e),r.er()&&ah(n,e),0===n.$r.size&&(r.er()?r.ir():hh(n)&&n.Br.set("Unknown"))}function sh(t,e){t.qr.U(e.targetId),_h(t).mr(e)}function ah(t,e){t.qr.U(e),_h(t).yr(e)}function uh(t){t.qr=new Rs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),_h(t).start(),t.Br.Sr()}function ch(t){return hh(t)&&!_h(t).tr()&&t.$r.size>0}function hh(t){return 0===ei(t).Or.size}function lh(t){t.qr=void 0}function fh(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){return t.$r.forEach(function(e,n){sh(t,e)}),[2]})})}function dh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(n){return lh(t),ch(t)?(t.Br.Nr(e),uh(t)):t.Br.set("Unknown"),[2]})})}function ph(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o;return Object(Kr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof js&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Kr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Yr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,yh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof As?t.qr.X(e):e instanceof xs?t.qr.rt(e):t.qr.et(e),n.isEqual(ui.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,uc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(mi.EMPTY_BYTE_STRING,n.snapshotVersion)),ah(t,e);var r=new tu(n.target,e,1,n.sequenceNumber);sh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Yr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,yh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function yh(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r=this;return Object(Kr.d)(this,function(i){switch(i.label){case 0:if(!za(e))throw e;return t.Or.add(1),[4,rh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return uc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Kr.b)(r,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return Yr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,nh(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function gh(t,e){return e().catch(function(n){return yh(t,n,e)})}function mh(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Kr.d)(this,function(s){switch(s.label){case 0:e=ei(t),n=Sh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return hh(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,lc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Sh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,yh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return vh(e)&&bh(e),[2]}})})}function vh(t){return hh(t)&&!Sh(t).tr()&&t.kr.length>0}function bh(t){Sh(t).start()}function wh(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){return Sh(t).Ar(),[2]})})}function Th(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n,r;return Object(Kr.d)(this,function(i){for(e=Sh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Ih(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Za.from(r,e,n),[4,gh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,mh(t)];case 2:return o.sent(),[2]}})})}function Eh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e&&Sh(t).pr?[4,function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return ls(r=e.code)&&r!==zr.ABORTED?(n=t.kr.shift(),Sh(t).sr(),[4,gh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,mh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return vh(t)&&bh(t),[2]}})})}function Oh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return n=ei(t),e?(n.Or.delete(2),[4,nh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,rh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function _h(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=ei(t);return r.br(),new $c(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:fh.bind(null,t),Ri:dh.bind(null,t),_r:ph.bind(null,t)}),t.Mr.push(function(n){return Object(Kr.b)(e,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),ch(t)?uh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),lh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Sh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=ei(t);return r.br(),new Jc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:wh.bind(null,t),Ri:Eh.bind(null,t),Ir:Th.bind(null,t),Tr:Ih.bind(null,t)}),t.Mr.push(function(n){return Object(Kr.b)(e,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,mh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Yr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var Dh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Fa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qr(zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function kh(t,e){if(Xr("AsyncQueue",e+": "+t),za(t))return new Qr(zr.UNAVAILABLE,e+": "+t);throw t}var Nh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ki.comparator(e.key,n.key)}:function(t,e){return ki.comparator(t.key,e.key)},this.keyedMap=Ts(),this.sortedSet=new ds(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Ah=function(){function t(){this.Kr=new ds(ki.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Zr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),xh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Nh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Oo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),jh=function(){this.Wr=void 0,this.listeners=[]},Ch=function(){this.queries=new Vu(function(t){return _o(t)},Oo),this.onlineState="Unknown",this.Gr=new Set};function Rh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Kr.d)(this,function(c){switch(c.label){case 0:if(n=ei(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new jh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=kh(a,"Initialization of query '"+So(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Mh(n),[2]}})})}function Ph(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Kr.d)(this,function(a){return n=ei(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Uh(t,e){for(var n=ei(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Mh(n)}function Lh(t,e,n){var r=ei(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Mh(t){t.Gr.forEach(function(t){t.next()})}var Fh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new xh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=xh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Vh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),qh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Hs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Zs(this.R,t.document,!1):zi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Ks(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new qh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||_s()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return[4,vc(this.localStore,new qh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,bc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new tc(Object.assign({},this.progress),t))]}})})}}();var Bh=function(t){this.key=t},Kh=function(t){this.key=t},Gh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=_s(),this.mutatedKeys=_s(),this.lo=ko(t),this.fo=new Nh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Ah,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=go(this.query)&&i.size===this.query.limit?i.last():null,c=mo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=Do(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),go(this.query)||mo(this.query))for(;s.size>this.query.limit;){var h=go(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new xh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Ah,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=_s(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Kh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Bh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=_s();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return xh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),zh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Qh=function(t){this.key=t,this.bo=!1},Hh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Vu(function(t){return _o(t)},Oo),this.Vo=new Map,this.So=new Set,this.Do=new ds(ki.comparator),this.Co=new Map,this.No=new Tc,this.xo={},this.Fo=new Map,this.ko=ku.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Wh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:return n=El(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,fc(n.localStore,Io(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Yh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&ih(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Yh(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Kr.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,pc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(ul(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,pc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Gh(e,i.Bn),s=o._o(i.documents),a=Ns.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),ul(t,n,u.To),c=new zh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Xh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return n=ei(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Oo(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,dc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),oh(n.remoteStore,r.targetId),sl(n,r.targetId)}).catch(Cu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return sl(n,r.targetId),[4,dc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function $h(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:r=Ol(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=ei(t),i=ai.now(),o=e.reduce(function(t,e){return t.add(e.key)},_s());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Jo(c,n.get(c.key));null!=h&&s.push(new ns(c.key,h,Gi(h.value.mapValue),Ho.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new ds(ii)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,ll(r,i.changes)];case 3:return a.sent(),[4,mh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=kh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Jh(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:n=ei(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,cc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(ti(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?ti(r.bo):t.removedDocuments.size>0&&(ti(r.bo),r.bo=!1))}),[4,ll(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Cu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Zh(t,e,n){var r=ei(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=ei(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Mh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function tl(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Kr.d)(this,function(c){switch(c.label){case 0:return(r=ei(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new ds(ki.comparator)).insert(o,zi.newNoDocument(o,ui.min())),a=_s().add(o),u=new ks(ui.min(),new Map,new gs(ii),s,a),[4,Jh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),hl(r),[3,4];case 2:return[4,dc(r.localStore,e,!1).then(function(){return sl(r,e,n)}).catch(Cu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function el(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:n=ei(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,ac(n.localStore,e)];case 2:return i=o.sent(),ol(n,r,null),il(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,ll(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Cu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function nl(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:r=ei(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=ei(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return ti(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),ol(r,e,n),il(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,ll(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Cu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function rl(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:hh((n=ei(t)).remoteStore)||Yr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=ei(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=kh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function il(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function ol(t,e,n){var r=ei(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function sl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||al(t,e)})}function al(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(oh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),hl(t))}function ul(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Bh?(t.No.addReference(o.key,e),cl(t,o)):o instanceof Kh?(Yr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||al(t,o.key)):Zr()}}function cl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Yr("SyncEngine","New document in limbo: "+n),t.So.add(r),hl(t))}function hl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ki(di.fromString(e)),r=t.ko.next();t.Co.set(r,new Qh(n)),t.Do=t.Do.insert(n,r),ih(t.remoteStore,new tu(Io(yo(n.path)),r,2,Gr.o))}}function ll(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:return r=ei(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=nc.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Kr.d)(this,function(h){switch(h.label){case 0:n=ei(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Va.forEach(e,function(e){return Va.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Va.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!za(r=h.sent()))throw r;return Yr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function fl(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return(n=ei(t)).currentUser.isEqual(e)?[3,3]:(Yr("SyncEngine","User change. New user:",e.toKey()),[4,sc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Qr(zr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,ll(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function dl(t,e){var n=ei(t),r=n.Co.get(e);if(r&&r.bo)return _s().add(r.key);var i=_s(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function pl(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return[4,pc((n=ei(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&ul(n,e.targetId,i.To),i)]}})})}function yl(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){return[2,gc((e=ei(t)).localStore).then(function(t){return ll(e,t)})]})})}function gl(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o;return Object(Kr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=ei(t),r=ei(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Va.resolve(null)})})}((i=ei(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,mh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(ol(i,e,r||null),il(i,e),function(t,e){ei(ei(t)._n).Gt(e)}(i.localStore,e)):Zr(),s.label=4;case 4:return[4,ll(i,o)];case 5:return s.sent(),[3,7];case 6:Yr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function ml(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Kr.d)(this,function(c){switch(c.label){case 0:return El(n=ei(t)),Ol(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,vl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Oh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)ih(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return sl(n,e),dc(n.localStore,e,!0)}),oh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,vl(n,a)];case 5:return c.sent(),function(t){var e=ei(t);e.Co.forEach(function(t,n){oh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new ds(ki.comparator)}(n),n.$o=!1,[4,Oh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function vl(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Kr.d)(this,function(y){switch(y.label){case 0:n=ei(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,fc(n.localStore,Io(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,pl(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,yc(n.localStore,a)];case 8:return p=y.sent(),[4,fc(n.localStore,p)];case 9:return u=y.sent(),[4,Yh(n,bl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function bl(t){return po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function wl(t){var e=ei(t);return ei(ei(e.localStore).persistence).fn()}function Tl(t,e,n,r){return Object(Kr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Kr.d)(this,function(a){switch(a.label){case 0:return(i=ei(t)).$o?(Yr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,gc(i.localStore)];case 3:return o=a.sent(),s=ks.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,ll(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,dc(i.localStore,e,!0)];case 6:return a.sent(),sl(i,e,r),[3,8];case 7:Zr(),a.label=8;case 8:return[2]}})})}function Il(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Kr.d)(this,function(f){switch(f.label){case 0:if(!(r=El(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Yr("SyncEngine","Adding an already active target "+s),[3,5]):[4,yc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,fc(r.localStore,a)];case 3:return u=f.sent(),[4,Yh(r,bl(a),u.targetId,!1)];case 4:f.sent(),ih(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,dc(r.localStore,t,!1).then(function(){oh(r.remoteStore,t),sl(r,t)}).catch(Cu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function El(t){var e=ei(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=tl.bind(null,e),e.vo._r=Uh.bind(null,e.eventManager),e.vo.Mo=Lh.bind(null,e.eventManager),e}function Ol(t){var e=ei(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=el.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nl.bind(null,e),e}var _l=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return this.R=Wc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return oc(this.persistence,new rc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Dc(Nc.bs,this.R)},t.prototype.Bo=function(t){return new Vc},t.prototype.terminate=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Sl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Kr.c)(e,t),e.prototype.initialize=function(e){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,mc(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Ol(this.Ko.syncEngine)];case 4:return n.sent(),[4,mh(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return oc(this.persistence,new rc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Uu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Zu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?wu.withCacheSize(this.cacheSizeBytes):wu.DEFAULT;return new Xu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Qc(),Hc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Vc},e}(_l),Dl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Kr.c)(e,t),e.prototype.initialize=function(e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r=this;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Fc?(this.sharedClientState.syncEngine={ui:gl.bind(null,n),ai:Tl.bind(null,n),hi:Il.bind(null,n),fn:wl.bind(null,n),ci:yl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Kr.b)(r,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return[4,ml(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Qc();if(!Fc.yt(e))throw new Qr(zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Zu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Fc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Sl),kl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n=this;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Zh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=fl.bind(null,this.syncEngine),[4,Oh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Ch},t.prototype.createDatastore=function(t){var e=Wc(t.databaseInfo.databaseId),n=new zc(t.databaseInfo);return function(t,e,n){return new Zc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Zh(s.syncEngine,t,0)},o=Bc.yt()?new Bc:new qc,new eh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Hh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e=ei(t),Yr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,rh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Nl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Al=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Fa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Vh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Kr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Qr(zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Kr.d)(this,function(u){switch(u.label){case 0:return n=ei(t),r=Xs(n.R)+"/documents",i={documents:e.map(function(t){return Qs(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){ti(!!e.found);var n=Hs(t,e.found.name),r=Ks(e.found.updateTime),i=new Ki({mapValue:{fields:e.found.fields}});return zi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){ti(!!e.missing),ti(!!e.readTime);var n=Hs(t,e.missing),r=Ks(e.readTime);return zi.newNoDocument(n,r)}(t,e):Zr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());ti(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new us(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Kr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=ki.fromPath(n);e.mutations.push(new cs(r,e.precondition(r)))}),[4,function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return n=ei(t),r=Xs(n.R)+"/documents",i={writes:e.map(function(t){return ta(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Zr();e=ui.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Qr(zr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ho.updateTime(e):Ho.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ui.min()))throw new Qr(zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ho.updateTime(e)}return Ho.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),xl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Yc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Kr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Kr.d)(this,function(r){return t=new Al(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!_i(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ls(e)}return!1},t}(),jl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Ac.UNAUTHENTICATED,this.clientId=ri.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(Kr.b)(r,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return Yr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Qr(zr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Fa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Kr.b)(t,void 0,void 0,function(){var t,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=kh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Cl(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Yr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(Kr.b)(i,void 0,void 0,function(){return Object(Kr.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,sc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Rl(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Pl(t)];case 1:return n=i.sent(),Yr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(Kr.b)(this,void 0,void 0,function(){var n,r;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return(n=ei(t)).asyncQueue.verifyOperationInProgress(),Yr("RemoteStore","RemoteStore received new credentials"),r=hh(n),n.Or.add(3),[4,rh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,nh(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Pl(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Yr("FirestoreClient","Using default OfflineComponentProvider"),[4,Cl(t,new _l)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Ul(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Yr("FirestoreClient","Using default OnlineComponentProvider"),[4,Rl(t,new kl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Ll(t){return Pl(t).then(function(t){return t.persistence})}function Ml(t){return Pl(t).then(function(t){return t.localStore})}function Fl(t){return Ul(t).then(function(t){return t.remoteStore})}function Vl(t){return Ul(t).then(function(t){return t.syncEngine})}function ql(t){return Object(Kr.b)(this,void 0,void 0,function(){var e,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return[4,Ul(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Wh.bind(null,e.syncEngine),n.onUnlisten=Xh.bind(null,e.syncEngine),n)]}})})}function Bl(t,e,n){var r=this;void 0===n&&(n={});var i=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(r,void 0,void 0,function(){var r;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Nl({next:function(o){e.enqueueAndForget(function(){return Ph(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Qr(zr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Qr(zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Fh(yo(n.path),o,{includeMetadataChanges:!0,so:!0});return Rh(t,s)},[4,ql(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Kl(t,e,n){var r=this;void 0===n&&(n={});var i=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(r,void 0,void 0,function(){var r;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Nl({next:function(n){e.enqueueAndForget(function(){return Ph(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Qr(zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Fh(n,o,{includeMetadataChanges:!0,so:!0});return Rh(t,s)},[4,ql(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Gl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},zl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Ql=new Map,Hl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Wl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Ac.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Yl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Xl=function(){function t(t){var e=this;this.currentUser=Ac.UNAUTHENTICATED,this.oc=new Fa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Yr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Yr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Yr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ti("string"==typeof n.accessToken),new Hl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(Kr.b)(n,void 0,void 0,function(){return Object(Kr.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return ti(null===t||"string"==typeof t),new Ac(t)},t}(),$l=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Ac.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Jl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new $l(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Ac.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Zl(t,e,n){if(!n)throw new Qr(zr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function tf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Qr(zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ef(t,e,n,r){if(!0===e&&!0===r)throw new Qr(zr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function nf(t){if(!ki.isDocumentKey(t))throw new Qr(zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function rf(t){if(ki.isDocumentKey(t))throw new Qr(zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function of(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Zr()}function sf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Qr(zr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=of(t);throw new Qr(zr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function af(t,e){if(e<=0)throw new Qr(zr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var uf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Qr(zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ef("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),cf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uf({}),this._settingsFrozen=!1,t instanceof zl?(this._databaseId=t,this._credentials=new Wl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Qr(zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zl(t.options.projectId)}(t),this._credentials=new Xl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Qr(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Qr(zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Wl;switch(t.type){case"gapi":var e=t.client;return ti(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Jl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Qr(zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Ql.get(this))&&(Yr("ComponentProvider","Removing Datastore"),Ql.delete(this),t.terminate()),Promise.resolve();var t},t}(),hf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new ff(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),lf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),ff=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,yo(r))||this)._path=r,i.type="collection",i}return Object(Kr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new hf(this.firestore,null,new ki(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(lf);function df(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(j.h)(t),Zl("collection","path",e),t instanceof cf)return rf(n=di.fromString.apply(di,Object(Kr.f)([e],r))),new ff(t,null,n);if(!(t instanceof hf||t instanceof ff))throw new Qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return rf(n=di.fromString.apply(di,Object(Kr.f)([t.path],r)).child(di.fromString(e))),new ff(t.firestore,null,n)}function pf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(j.h)(t),1===arguments.length&&(e=ri.u()),Zl("doc","path",e),t instanceof cf)return nf(n=di.fromString.apply(di,Object(Kr.f)([e],r))),new hf(t,null,new ki(n));if(!(t instanceof hf||t instanceof ff))throw new Qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return nf(n=t._path.child(di.fromString.apply(di,Object(Kr.f)([e],r)))),new hf(t.firestore,t instanceof ff?t.converter:null,new ki(n))}function yf(t,e){return t=Object(j.h)(t),e=Object(j.h)(e),(t instanceof hf||t instanceof ff)&&(e instanceof hf||e instanceof ff)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function gf(t,e){return t=Object(j.h)(t),e=Object(j.h)(e),t instanceof lf&&e instanceof lf&&t.firestore===e.firestore&&Oo(t._query,e._query)&&t.converter===e.converter}var mf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new Yc(this,"async_queue_retry"),this.Tc=function(){var e=Hc();e&&Yr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Hc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Hc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Kr.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!za(t=n.sent()))throw t;return Yr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Xr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=Dh.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&Zr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(Kr.b)(this,void 0,void 0,function(){var t;return Object(Kr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function vf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Fa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new mf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Kr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Tf(this),this._firestoreClient.terminate()},e}(cf);function wf(t){return t._firestoreClient||Tf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Tf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Gl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new jl(t._credentials,t._queue,r)}function If(t,e,n){var r=this,i=new Fa;return t.asyncQueue.enqueue(function(){return Object(Kr.b)(r,void 0,void 0,function(){var r;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Cl(t,n)];case 1:return o.sent(),[4,Rl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===zr.FAILED_PRECONDITION||t.code===zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Ef(t){if(t._initialized||t._terminated)throw new Qr(zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Of=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),_f=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(mi.fromBase64String(e))}catch(e){throw new Qr(zr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(mi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Sf=function(t){this._methodName=t},Df=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Qr(zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Qr(zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return ii(this._lat,t._lat)||ii(this._long,t._long)},t}(),kf=/^__.*__$/,Nf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ns(t,this.data,this.fieldMask,e,this.fieldTransforms):new es(t,this.data,e,this.fieldTransforms)},t}(),Af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ns(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function xf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zr()}}var jf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return Jf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(xf(this.Cc)&&kf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),Cf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Wc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new jf({Cc:t,methodName:e,Bc:n,path:yi.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Rf(t){var e=t._freezeSettings(),n=Wc(t._databaseId);return new Cf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Pf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Wf("Data must be an object, but it was:",s,r);var a,u,c=Qf(r,s);if(o.merge)a=new gi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Yf(e,f[l],n);if(!s.contains(d))throw new Qr(zr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Zf(h,d)||h.push(d)}a=new gi(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Nf(new Ki(c),a,u)}var Uf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Sf);function Lf(t,e,n){return new jf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype._toFieldTransform=function(t){return new zo(t.path,new Lo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Sf),Ff=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Kr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Lf(this,t,!0),n=this.Uc.map(function(t){return zf(t,e)}),r=new Mo(n);return new zo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Sf),Vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Kr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Lf(this,t,!0),n=this.Uc.map(function(t){return zf(t,e)}),r=new Vo(n);return new zo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Sf),qf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(Kr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Bo(t.R,jo(t.R,this.Qc));return new zo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Sf);function Bf(t,e,n,r){var i=t.qc(1,e,n);Wf("Data must be an object, but it was:",i,r);var o=[],s=Ki.empty();hi(r,function(t,r){var a=$f(e,t,n);r=Object(j.h)(r);var u=i.$c(a);if(r instanceof Uf)o.push(a);else{var c=zf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new gi(o);return new Af(s,a,i.fieldTransforms)}function Kf(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Yf(e,r,n)],u=[i];if(o.length%2!=0)throw new Qr(zr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Yf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ki.empty(),f=a.length-1;f>=0;--f)if(!Zf(h,a[f])){var d=a[f],p=u[f];p=Object(j.h)(p);var y=s.$c(d);if(p instanceof Uf)h.push(d);else{var g=zf(p,y);null!=g&&(h.push(d),l.set(d,g))}}var m=new gi(h);return new Af(l,m,s.fieldTransforms)}function Gf(t,e,n,r){return void 0===r&&(r=!1),zf(n,t.qc(r?4:3,e))}function zf(t,e){if(Hf(t=Object(j.h)(t)))return Wf("Unsupported field value:",e,t),Qf(t,e);if(t instanceof Sf)return function(t,e){if(!xf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=zf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(j.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return jo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ai.fromDate(t);return{timestampValue:Vs(e.R,n)}}if(t instanceof ai)return n=new ai(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Vs(e.R,n)};if(t instanceof Df)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof _f)return{bytesValue:qs(e.R,t._byteString)};if(t instanceof hf){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Gs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+of(t))}(t,e)}function Qf(t,e){var n={};return li(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):hi(t,function(t,r){var i=zf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Hf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ai||t instanceof Df||t instanceof _f||t instanceof hf||t instanceof Sf)}function Wf(t,e,n){if(!Hf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=of(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Yf(t,e,n){if((e=Object(j.h)(e))instanceof Of)return e._internalPath;if("string"==typeof e)return $f(t,e);throw Jf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Xf=new RegExp("[~\\*/\\[\\]]");function $f(t,e,n){if(e.search(Xf)>=0)throw Jf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Of.bind.apply(Of,Object(Kr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Jf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Jf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Qr(zr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Zf(t,e){return t.some(function(t){return t.isEqual(e)})}var td=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new hf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new ed(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(nd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),ed=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(td);function nd(t,e){return"string"==typeof e?$f(t,e):e instanceof Of?e._internalPath:e._delegate._internalPath}var rd=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),id=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Kr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new od(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(nd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(td),od=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(id),sd=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new rd(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new od(n._firestore,n._userDataWriter,r.key,r,new rd(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Qr(zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new od(t._firestore,t._userDataWriter,e.doc.key,e.doc,new rd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new od(t._firestore,t._userDataWriter,e.doc.key,e.doc,new rd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:ad(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function ad(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zr()}}function ud(t,e){return t instanceof id&&e instanceof id?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof sd&&e instanceof sd&&t._firestore===e._firestore&&gf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function cd(t){if(mo(t)&&0===t.explicitOrderBy.length)throw new Qr(zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var hd=function(){};function ld(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var fd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Kc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(Kr.c)(e,t),e.prototype._apply=function(t){var e=Rf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){bd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(vd(r,t,h[c]));a={arrayValue:{values:u}}}else a=vd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||bd(s,o),a=Gf(n,"where",s,"in"===o||"not-in"===o);var l=$i.create(i,o,a);return function(t,e){if(e.g()){var n=bo(t);if(null!==n&&!n.isEqual(e.field))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=vo(t);null!==r&&wd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Qr(zr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Kc,this.jc,this.Wc);return new lf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(hd),dd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Kc=e,r.Gc=n,r.type="orderBy",r}return Object(Kr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new uo(e,n);return function(t,e){if(null===vo(t)){var n=bo(t);null!==n&&wd(0,n,e.field)}}(t,r),r}(t._query,this.Kc,this.Gc);return new lf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(hd),pd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(Kr.c)(e,t),e.prototype._apply=function(t){return new lf(t.firestore,t.converter,Eo(t._query,this.zc,this.Hc))},e}(hd),yd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(Kr.c)(e,t),e.prototype._apply=function(t){var e=md(t,this.type,this.Jc,this.Yc);return new lf(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(hd),gd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(Kr.c)(e,t),e.prototype._apply=function(t){var e=md(t,this.type,this.Jc,this.Yc);return new lf(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(hd);function md(t,e,n,r){if(n[0]=Object(j.h)(n[0]),n[0]instanceof td)return function(t,e,n,r,i){if(!r)throw new Qr(zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=To(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ui(e,r.key));else{var c=r.data.field(u.field);if(Ii(c))throw new Qr(zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new so(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Rf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Qr(zr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!wo(t)&&-1!==c.indexOf("/"))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(di.fromString(c));if(!ki.isDocumentKey(h))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ki(h);a.push(Ui(e,l))}else{var f=Gf(n,r,c);a.push(f)}}return new so(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function vd(t,e,n){if("string"==typeof(n=Object(j.h)(n))){if(""===n)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!wo(e)&&-1!==n.indexOf("/"))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(di.fromString(n));if(!ki.isDocumentKey(r))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ui(t,new ki(r))}if(n instanceof hf)return Ui(t,n._key);throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+of(n)+".")}function bd(t,e){if(!Array.isArray(t)||0===t.length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function wd(t,e,n){if(!n.isEqual(e))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Td=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ni(t)){case 0:return null;case 1:return t.booleanValue;case 2:return wi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ti(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Zr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return hi(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Df(wi(t.latitude),wi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Ei(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Oi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=bi(t);return new ai(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=di.fromString(t);ti(ya(n));var r=new zl(n.get(1),n.get(3)),i=new ki(n.popFirst(5));return r.isEqual(e)||Xr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Id(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ed=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Kr.c)(e,t),e.prototype.convertBytes=function(t){return new _f(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new hf(this.firestore,null,e)},e}(Td),Od=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Rf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=_d(t,this._firestore),i=Id(r.converter,e,n),o=Pf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Ho.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=_d(t,this._firestore);return o="string"==typeof(e=Object(j.h)(e))||e instanceof Of?Kf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Bf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Ho.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=_d(t,this._firestore);return this._mutations=this._mutations.concat(new us(e._key,Ho.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Qr(zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function _d(t,e){if((t=Object(j.h)(t)).firestore!==e)throw new Qr(zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Sd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Kr.c)(e,t),e.prototype.convertBytes=function(t){return new _f(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new hf(this.firestore,null,e)},e}(Td);function Dd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=sf(t,hf);var o=sf(t.firestore,bf),s=Rf(o);return Nd(o,[("string"==typeof(e=Object(j.h)(e))||e instanceof Of?Kf(s,"updateDoc",t._key,e,n,r):Bf(s,"updateDoc",t._key,e)).toMutation(t._key,Ho.exists(!0))])}function kd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(j.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||vf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(vf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof hf)c=sf(t.firestore,bf),h=yo(t._key.path),u={next:function(e){i[a]&&i[a](Ad(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=sf(t,lf);c=sf(d.firestore,bf),h=d._query;var p=new Sd(c);u={next:function(t){i[a]&&i[a](new sd(c,p,d,t))},error:i[a+1],complete:i[a+2]},cd(t._query)}return function(t,e,n,r){var i=this,o=new Nl(r),s=new Fh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(i,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e=Rh,[4,ql(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(i,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e=Ph,[4,ql(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(wf(c),h,l,u)}function Nd(t,e){return function(t,e){var n=this,r=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var n;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return n=$h,[4,Vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(wf(t),e)}function Ad(t,e,n){var r=n.docs.get(e._key),i=new Sd(t);return new id(t,i,e._key,r,new rd(n.hasPendingWrites,n.fromCache),e.converter)}var xd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Kr.c)(e,t),e.prototype.get=function(e){var n=this,r=_d(e,this._firestore),i=new Sd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new id(n._firestore,i,r._key,t._document,new rd(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Rf(t)}return t.prototype.get=function(t){var e=this,n=_d(t,this._firestore),r=new Ed(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Zr();var i=t[0];if(i.isFoundDocument())return new td(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new td(e._firestore,r,n._key,null,n.converter);throw Zr()})},t.prototype.set=function(t,e,n){var r=_d(t,this._firestore),i=Id(r.converter,e,n),o=Pf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=_d(t,this._firestore);return o="string"==typeof(e=Object(j.h)(e))||e instanceof Of?Kf(this._dataReader,"Transaction.update",s._key,e,n,r):Bf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=_d(t,this._firestore);return this._transaction.delete(e._key),this},t}());function jd(){if("undefined"==typeof Uint8Array)throw new Qr(zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Cd(){if("undefined"==typeof atob)throw new Qr(zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Rd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Cd(),new t(_f.fromBase64String(e))},t.fromUint8Array=function(e){return jd(),new t(_f.fromUint8Array(e))},t.prototype.toBase64=function(){return Cd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return jd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Pd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Ef(t=sf(t,bf));var n=wf(t),r=t._freezeSettings(),i=new kl;return If(n,i,new Sl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Ef(t=sf(t,bf));var e=wf(t),n=t._freezeSettings(),r=new kl;return If(e,r,new Dl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Qr(zr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Fa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Kr.b)(e,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Kr.b)(this,void 0,void 0,function(){return Object(Kr.d)(this,function(e){switch(e.label){case 0:return Ba.yt()?[4,Ba.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Zu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Ud=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof zl||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||$r("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=sf(t,cf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&$r("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(j.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Qr(zr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Yl(new Hl(o,new Ac(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Kr.b)(e,void 0,void 0,function(){var e,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return[4,Ll(t)];case 1:return e=r.sent(),[4,Fl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=ei(t);return e.Or.delete(0),nh(e)}(n))]}})})})}(wf(sf(this._delegate,bf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Kr.b)(e,void 0,void 0,function(){var e,n;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return[4,Ll(t)];case 1:return e=r.sent(),[4,Fl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Kr.b)(this,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return(e=ei(t)).Or.add(0),[4,rh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(wf(sf(this._delegate,bf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ef("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(e,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(r){switch(r.label){case 0:return e=rl,[4,Vl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(wf(sf(this._delegate,bf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Nl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ei(t).Gr.add(e),e.next()},[4,ql(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var e;return Object(Kr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ei(t).Gr.delete(e)},[4,ql(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(wf(t=sf(t,bf)),vf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new Qr(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Xd(this,df(this._delegate,t))}catch(t){throw Bd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new qd(this,pf(this._delegate,t))}catch(t){throw Bd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Hd(this,function(t,e){if(t=sf(t,cf),Zl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Qr(zr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new lf(t,null,function(t){return new fo(di.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Bd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var n;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Ul(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new xl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(wf(t),function(n){return e(new xd(t,n))})}(this._delegate,function(n){return t(new Md(e,n))})},t.prototype.batch=function(){var t=this;return wf(this._delegate),new Fd(new Od(this._delegate,function(e){return Nd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Qr(zr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Qr(zr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Ld=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Kr.c)(e,t),e.prototype.convertBytes=function(t){return new Rd(new _f(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return qd.tu(e,this.firestore,null)},e}(Td),Md=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.prototype.get=function(t){var e=this,n=$d(t);return this._delegate.get(n).then(function(t){return new zd(e._firestore,new id(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=$d(t);return n?(tf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=$d(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Kr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=$d(t);return this._delegate.delete(e),this},t}(),Fd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=$d(t);return n?(tf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=$d(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Kr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=$d(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Vd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new od(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Qd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Ld(e),n),i.set(n,o)),o},t}();Vd.nu=new WeakMap;var qd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new Qr(zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new hf(n._delegate,r,new ki(e)))},t.tu=function(e,n,r){return new t(n,new hf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Xd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Xd(this.firestore,df(this._delegate,t))}catch(t){throw Bd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(j.h)(t))instanceof hf&&yf(this._delegate,t)},t.prototype.set=function(t,e){e=tf("DocumentReference.set",e);try{return function(t,e,n){t=sf(t,hf);var r=sf(t.firestore,bf),i=Id(t.converter,e,n);return Nd(r,[Pf(Rf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Ho.none())])}(this._delegate,t,e)}catch(t){throw Bd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Dd(this._delegate,t):Dd.apply(void 0,Object(Kr.f)([this._delegate,t,e],n))}catch(t){throw Bd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Nd(sf((t=this._delegate).firestore,bf),[new us(t._key,Ho.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Kd(e),i=Gd(e,function(e){return new zd(t.firestore,new id(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return kd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=sf(t,hf);var e=sf(t.firestore,bf),n=wf(e),r=new Sd(e);return function(t,e){var n=this,r=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var n;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i;return Object(Kr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=ei(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Qr(zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=kh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Ml(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new id(e,r,t._key,n,new rd(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=sf(t,hf);var e=sf(t.firestore,bf);return Bl(wf(e),t._key,{source:"server"}).then(function(n){return Ad(e,t,n)})}(this._delegate):function(t){t=sf(t,hf);var e=sf(t.firestore,bf);return Bl(wf(e),t._key).then(function(n){return Ad(e,t,n)})}(this._delegate)).then(function(t){return new zd(e.firestore,new id(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Vd.eu(this.firestore,e):null))},t}();function Bd(t,e,n){return t.message=t.message.replace(e,n),t}function Kd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!vf(r))return r}return{}}function Gd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=vf(t[0])?t[0]:vf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var zd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new qd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return ud(this._delegate,t._delegate)},t}(),Qd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Kr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(zd),Hd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,ld(this._delegate,function(t,e,n){var r=e,i=nd("where",t);return new fd(i,r,n)}(e,n,r)))}catch(e){throw Bd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,ld(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=nd("orderBy",t);return new dd(r,n)}(e,n)))}catch(e){throw Bd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,ld(this._delegate,function(t){return af("limit",t),new pd("limit",t,"F")}(e)))}catch(e){throw Bd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,ld(this._delegate,function(t){return af("limitToLast",t),new pd("limitToLast",t,"L")}(e)))}catch(e){throw Bd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ld(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Bd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ld(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Bd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ld(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Bd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ld(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Bd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return gf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=sf(t,lf);var e=sf(t.firestore,bf),n=wf(e),r=new Sd(e);return function(t,e){var n=this,r=new Fa;return t.asyncQueue.enqueueAndForget(function(){return Object(Kr.b)(n,void 0,void 0,function(){var n;return Object(Kr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Kr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Kr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,pc(t,e,!0)];case 1:return a=u.sent(),r=new Gh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=kh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Ml(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new sd(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=sf(t,lf);var e=sf(t.firestore,bf),n=wf(e),r=new Sd(e);return Kl(n,t._query,{source:"server"}).then(function(n){return new sd(e,r,t,n)})}(this._delegate):function(t){t=sf(t,lf);var e=sf(t.firestore,bf),n=wf(e),r=new Sd(e);return cd(t._query),Kl(n,t._query).then(function(n){return new sd(e,r,t,n)})}(this._delegate)).then(function(t){return new Yd(e.firestore,new sd(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Kd(e),i=Gd(e,function(e){return new Yd(t.firestore,new sd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return kd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Vd.eu(this.firestore,e):null))},t}(),Wd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Qd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Yd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Hd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Qd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Wd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Qd(n._firestore,r))})},t.prototype.isEqual=function(t){return ud(this._delegate,t._delegate)},t}(),Xd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Kr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new qd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new qd(this.firestore,void 0===t?pf(this._delegate):pf(this._delegate,t))}catch(t){throw Bd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=sf(t.firestore,bf),r=pf(t),i=Id(t.converter,e);return Nd(n,[Pf(Rf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Ho.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new qd(e.firestore,t)})},e.prototype.isEqual=function(t){return yf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Vd.eu(this.firestore,t):null))},e}(Hd);function $d(t){return sf(t,hf)}var Jd,Zd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Of.bind.apply(Of,Object(Kr.f)([void 0],t)))}return t.documentId=function(){return new t(yi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(j.h)(t))instanceof Of&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),tp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Mf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Uf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ff("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new qf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),ep=n("/6Yf"),np={Firestore:Ud,GeoPoint:Df,Timestamp:ai,Blob:Rd,Transaction:Md,WriteBatch:Fd,DocumentReference:qd,DocumentSnapshot:zd,Query:Hd,QueryDocumentSnapshot:Qd,QuerySnapshot:Yd,CollectionReference:Xd,FieldPath:Zd,FieldValue:tp,setLogLevel:function(t){Hr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new ep.a("firestore",function(t){return function(t,e){return new Ud(t,new bf(t,e),new Pd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},np)))})(Jd=x.a),Jd.registerVersion("@firebase/firestore","2.3.7");var rp=n("VRCc");function ip(t,e){return function(t,e=v.b){return new b.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function op(t,e){return ip(t,e).pipe(Object(O.a)(t=>({payload:t,type:"query"})))}function sp(t,e){return op(t,e).pipe(Object(I.a)(void 0),Object(E.a)(),Object(O.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function ap(t,e,n){return sp(t,n).pipe(Object(_.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return up(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return up(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return up(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(S.a)(),Object(O.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function up(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function cp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class hp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=sp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(O.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(I.a)(void 0),Object(E.a)(),Object(D.a)(([t,e])=>e.length>0||!t),Object(O.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(_.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=cp(t);return ap(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return op(this.query,this.afs.schedulers.outsideAngular).pipe(Object(O.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(w.a)(this.query.get(t)).pipe(Object(k.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new lp(this.ref.doc(t),this.afs)}}class lp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=mp(n,e);return new hp(r,i,this.afs)}snapshotChanges(){return ip(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(I.a)(void 0),Object(E.a)(),Object(O.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(O.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(w.a)(this.ref.get(t)).pipe(Object(k.b)(this.afs.schedulers.insideAngular))}}class fp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?sp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(O.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(D.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):sp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(_.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=cp(t);return ap(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return op(this.query,this.afs.schedulers.outsideAngular).pipe(Object(O.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(w.a)(this.query.get(t)).pipe(Object(k.b)(this.afs.schedulers.insideAngular))}}const dp=new i.s("angularfire2.enableFirestorePersistence"),pp=new i.s("angularfire2.firestore.persistenceSettings"),yp=new i.s("angularfire2.firestore.settings"),gp=new i.s("angularfire2.firestore.use-emulator");function mp(t,e=(t=>t)){return{query:e(t),ref:t}}let vp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new N.d(s),this.keepUnstableUntilFirst=Object(N.h)(this.schedulers);const h=Object(N.g)(t,s,e);!A.a.auth&&c&&Object(N.j)();const l=u;[this.firestore,this.persistenceEnabled$]=Object(N.f)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!Object(r.u)(o)){const e=()=>{try{return Object(w.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(Jd){return"undefined"!=typeof console&&console.warn(Jd),Object(T.a)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,Object(T.a)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=mp(n,e),o=this.schedulers.ngZone.run(()=>r);return new hp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new fp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new lp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.Yb(N.c),i.Yb(N.b,8),i.Yb(dp,8),i.Yb(yp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(pp,8),i.Yb(gp,8),i.Yb(rp.b,8))},t.\u0275prov=i.Kb({factory:function(){return new t(i.Yb(N.c),i.Yb(N.b,8),i.Yb(dp,8),i.Yb(yp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(pp,8),i.Yb(gp,8),i.Yb(rp.b,8))},token:t,providedIn:"any"}),t})();var bp=n("kmnG"),wp=n("qFsG"),Tp=n("3Pt+");let Ip=(()=>{class t{constructor(t,e,n,r){this.dialogRef=t,this.data=e,this.db=n,this.auth=r,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("books").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else this.db.collection("books/").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat memperbarui data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.g),i.Ob(m.a),i.Ob(vp),i.Ob(rp.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product-detail"]],decls:36,vars:9,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","type","number",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.Ub(0,"h3",0),i.yc(1," Detail Product "),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"mat-form-field",2),i.Ub(4,"mat-label"),i.yc(5,"ID Buku"),i.Tb(),i.Ub(6,"input",3),i.bc("ngModelChange",function(t){return e.data.Kode=t}),i.Tb(),i.Tb(),i.Ub(7,"mat-form-field",2),i.Ub(8,"mat-label"),i.yc(9,"Judul"),i.Tb(),i.Ub(10,"input",3),i.bc("ngModelChange",function(t){return e.data.title=t}),i.Tb(),i.Tb(),i.Ub(11,"mat-form-field",2),i.Ub(12,"mat-label"),i.yc(13,"Penulis"),i.Tb(),i.Ub(14,"input",3),i.bc("ngModelChange",function(t){return e.data.author=t}),i.Tb(),i.Tb(),i.Ub(15,"mat-form-field",2),i.Ub(16,"mat-label"),i.yc(17,"Penerbit"),i.Tb(),i.Ub(18,"input",3),i.bc("ngModelChange",function(t){return e.data.publisher=t}),i.Tb(),i.Tb(),i.Ub(19,"mat-form-field",2),i.Ub(20,"mat-label"),i.yc(21,"Tahun terbit"),i.Tb(),i.Ub(22,"input",3),i.bc("ngModelChange",function(t){return e.data.year=t}),i.Tb(),i.Tb(),i.Ub(23,"mat-form-field",2),i.Ub(24,"mat-label"),i.yc(25,"ISBN"),i.Tb(),i.Ub(26,"input",3),i.bc("ngModelChange",function(t){return e.data.isbn=t}),i.Tb(),i.Tb(),i.Ub(27,"mat-form-field",2),i.Ub(28,"mat-label"),i.yc(29,"Harga"),i.Tb(),i.Ub(30,"input",4),i.bc("ngModelChange",function(t){return e.data.price=t}),i.Tb(),i.Tb(),i.Tb(),i.Ub(31,"div",5),i.Ub(32,"button",6),i.yc(33,"Batal"),i.Tb(),i.Ub(34,"button",7),i.bc("click",function(){return e.saveData()}),i.yc(35),i.Tb(),i.Tb()),2&t&&(i.Db(6),i.kc("ngModel",e.data.Kode),i.Db(4),i.kc("ngModel",e.data.title),i.Db(4),i.kc("ngModel",e.data.author),i.Db(4),i.kc("ngModel",e.data.publisher),i.Db(4),i.kc("ngModel",e.data.year),i.Db(4),i.kc("ngModel",e.data.isbn),i.Db(4),i.kc("ngModel",e.data.price),i.Db(4),i.kc("disabled",e.loading),i.Db(1),i.zc(e.loading?"Menyimpan..":"Simpan"))},directives:[m.h,m.e,bp.b,bp.e,wp.b,Tp.c,Tp.j,Tp.l,Tp.m,m.c,c.a,m.d],styles:[""]}),t})();var Ep=n("Xa2L"),Op=n("Wp6s");function _p(t,e){1&t&&(i.Ub(0,"div",2),i.Pb(1,"mat-spinner"),i.Tb())}function Sp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"tr"),i.Pb(1,"td"),i.Ub(2,"td"),i.yc(3),i.Tb(),i.Ub(4,"td"),i.yc(5),i.Tb(),i.Ub(6,"td"),i.yc(7),i.Tb(),i.Ub(8,"td"),i.yc(9),i.Tb(),i.Ub(10,"td"),i.yc(11),i.Tb(),i.Ub(12,"td"),i.yc(13),i.Tb(),i.Ub(14,"td"),i.yc(15),i.Tb(),i.Ub(16,"td"),i.yc(17),i.Tb(),i.Ub(18,"td",7),i.Ub(19,"button",9),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).ProductDetail(n,r)}),i.yc(20,"Edit"),i.Tb(),i.Ub(21,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).DeleteProduct(n.id,r)}),i.yc(22),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=i.fc(2);i.Db(3),i.zc(n+1),i.Db(2),i.zc(t.Kode),i.Db(2),i.zc(t.title),i.Db(2),i.zc(t.author),i.Db(2),i.zc(t.publisher),i.Db(2),i.zc(t.year),i.Db(2),i.zc(t.isbn),i.Db(2),i.zc(t.price),i.Db(4),i.kc("disabled",r.loadingDelete[n]),i.Db(1),i.zc(r.loadingDelete[n]?"Menghapus..":"Delete")}}function Dp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"mat-card"),i.Ub(1,"mat-card-header"),i.Ub(2,"mat-card-title"),i.yc(3),i.Tb(),i.Tb(),i.Ub(4,"mat-card-content"),i.Ub(5,"div",3),i.Pb(6,"span",4),i.Ub(7,"button",5),i.bc("click",function(){return i.rc(t),i.fc().ProductDetail({},-1)}),i.yc(8,"Tambah Product"),i.Tb(),i.Tb(),i.Ub(9,"table",6),i.Ub(10,"thead"),i.Pb(11,"th"),i.Ub(12,"th"),i.yc(13,"No"),i.Tb(),i.Ub(14,"th"),i.yc(15,"Kode Buku"),i.Tb(),i.Ub(16,"th"),i.yc(17,"Judul"),i.Tb(),i.Ub(18,"th"),i.yc(19,"Penulis"),i.Tb(),i.Ub(20,"th"),i.yc(21,"Penerbit"),i.Tb(),i.Ub(22,"th"),i.yc(23,"Tahun Terbit"),i.Tb(),i.Ub(24,"th"),i.yc(25,"ISBN"),i.Tb(),i.Ub(26,"th"),i.yc(27,"Harga"),i.Tb(),i.Pb(28,"th",7),i.Tb(),i.Ub(29,"tbody"),i.xc(30,Sp,23,10,"tr",8),i.Tb(),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=i.fc();i.Db(3),i.zc(t.title),i.Db(27),i.kc("ngForOf",t.books)}}let kp=(()=>{class t{constructor(t,e,n){this.dialog=t,this.db=e,this.auth=n,this.books=[],this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Produk",this.auth.user.subscribe(t=>{this.userData=t,this.getBooks()})}getBooks(){this.loading=!0,this.db.collection("books",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.books=t,this.loading=!1},t=>{this.loading=!1})}ProductDetail(t,e){this.dialog.open(Ip,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}DeleteProduct(t,e){confirm("Delete item?")&&this.db.collection("books/").doc(t).delete().then(t=>{this.books.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.b),i.Ob(vp),i.Ob(rp.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"disabled","click"]],template:function(t,e){1&t&&(i.xc(0,_p,2,0,"div",0),i.xc(1,Dp,31,2,"mat-card",1)),2&t&&(i.kc("ngIf",e.loading),i.Db(1),i.kc("ngIf",!e.loading))},directives:[r.k,Ep.b,Op.a,Op.c,Op.e,Op.b,c.a,r.j],styles:[""]}),t})(),Np=(()=>{class t{constructor(t,e,n,r){this.dialogRef=t,this.data=e,this.db=n,this.auth=r,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}simpanData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("Pinjams").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else this.db.collection("Pinjams/").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat memperbarui data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.g),i.Ob(m.a),i.Ob(vp),i.Ob(rp.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-pinjam-detail"]],decls:48,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","type","date",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.Ub(0,"h3",0),i.yc(1," Detail Product "),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"mat-form-field",2),i.Ub(4,"mat-label"),i.yc(5,"ID Transaksi"),i.Tb(),i.Ub(6,"input",3),i.bc("ngModelChange",function(t){return e.data.IDTransaksi=t}),i.Tb(),i.Tb(),i.Ub(7,"mat-form-field",2),i.Ub(8,"mat-label"),i.yc(9,"ID Anggota"),i.Tb(),i.Ub(10,"input",3),i.bc("ngModelChange",function(t){return e.data.IDAnggota=t}),i.Tb(),i.Tb(),i.Ub(11,"mat-form-field",2),i.Ub(12,"mat-label"),i.yc(13,"Nama"),i.Tb(),i.Ub(14,"input",3),i.bc("ngModelChange",function(t){return e.data.Nama=t}),i.Tb(),i.Tb(),i.Ub(15,"mat-form-field",2),i.Ub(16,"mat-label"),i.yc(17,"No Hp"),i.Tb(),i.Ub(18,"input",3),i.bc("ngModelChange",function(t){return e.data.NoHp=t}),i.Tb(),i.Tb(),i.Ub(19,"mat-form-field",2),i.Ub(20,"mat-label"),i.yc(21,"Alamat"),i.Tb(),i.Ub(22,"input",3),i.bc("ngModelChange",function(t){return e.data.Alamat=t}),i.Tb(),i.Tb(),i.Ub(23,"mat-form-field",2),i.Ub(24,"mat-label"),i.yc(25,"Judul Buku"),i.Tb(),i.Ub(26,"input",3),i.bc("ngModelChange",function(t){return e.data.JudulBuku=t}),i.Tb(),i.Tb(),i.Ub(27,"mat-form-field",2),i.Ub(28,"mat-label"),i.yc(29,"Kode Buku"),i.Tb(),i.Ub(30,"input",3),i.bc("ngModelChange",function(t){return e.data.KodeBuku=t}),i.Tb(),i.Tb(),i.Ub(31,"mat-form-field",2),i.Ub(32,"mat-label"),i.yc(33,"Tanggal Pinjam"),i.Tb(),i.Ub(34,"input",4),i.bc("ngModelChange",function(t){return e.data.TanggalPinjam=t}),i.Tb(),i.Tb(),i.Ub(35,"mat-form-field",2),i.Ub(36,"mat-label"),i.yc(37,"Tanggal Kembali"),i.Tb(),i.Ub(38,"input",4),i.bc("ngModelChange",function(t){return e.data.TanggalKembali=t}),i.Tb(),i.Tb(),i.Ub(39,"mat-form-field",2),i.Ub(40,"mat-label"),i.yc(41,"Status"),i.Tb(),i.Ub(42,"input",3),i.bc("ngModelChange",function(t){return e.data.Status=t}),i.Tb(),i.Tb(),i.Tb(),i.Ub(43,"div",5),i.Ub(44,"button",6),i.yc(45,"Batal"),i.Tb(),i.Ub(46,"button",7),i.bc("click",function(){return e.simpanData()}),i.yc(47),i.Tb(),i.Tb()),2&t&&(i.Db(6),i.kc("ngModel",e.data.IDTransaksi),i.Db(4),i.kc("ngModel",e.data.IDAnggota),i.Db(4),i.kc("ngModel",e.data.Nama),i.Db(4),i.kc("ngModel",e.data.NoHp),i.Db(4),i.kc("ngModel",e.data.Alamat),i.Db(4),i.kc("ngModel",e.data.JudulBuku),i.Db(4),i.kc("ngModel",e.data.KodeBuku),i.Db(4),i.kc("ngModel",e.data.TanggalPinjam),i.Db(4),i.kc("ngModel",e.data.TanggalKembali),i.Db(4),i.kc("ngModel",e.data.Status),i.Db(4),i.kc("disabled",e.loading),i.Db(1),i.zc(e.loading?"Menyimpan..":"Simpan"))},directives:[m.h,m.e,bp.b,bp.e,wp.b,Tp.c,Tp.j,Tp.l,m.c,c.a,m.d],styles:[""]}),t})();function Ap(t,e){1&t&&(i.Ub(0,"div",2),i.Pb(1,"mat-spinner"),i.Tb())}function xp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"tr"),i.Pb(1,"td"),i.Ub(2,"td"),i.yc(3),i.Tb(),i.Ub(4,"td"),i.yc(5),i.Tb(),i.Ub(6,"td"),i.yc(7),i.Tb(),i.Ub(8,"td"),i.yc(9),i.Tb(),i.Ub(10,"td"),i.yc(11),i.Tb(),i.Ub(12,"td"),i.yc(13),i.Tb(),i.Ub(14,"td"),i.yc(15),i.Tb(),i.Ub(16,"td"),i.yc(17),i.Tb(),i.Ub(18,"td"),i.yc(19),i.Tb(),i.Ub(20,"td"),i.yc(21),i.Tb(),i.Ub(22,"td"),i.yc(23),i.Tb(),i.Ub(24,"td",7),i.Ub(25,"button",9),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).PinjamDetail(n,r)}),i.yc(26,"Edit"),i.Tb(),i.Ub(27,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).DeleteProduct(n.id,r)}),i.yc(28),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=i.fc(2);i.Db(3),i.zc(n+1),i.Db(2),i.zc(t.IDTransaksi),i.Db(2),i.zc(t.IDAnggota),i.Db(2),i.zc(t.Nama),i.Db(2),i.zc(t.NoHp),i.Db(2),i.zc(t.Alamat),i.Db(2),i.zc(t.JudulBuku),i.Db(2),i.zc(t.KodeBuku),i.Db(2),i.zc(t.TanggalPinjam),i.Db(2),i.zc(t.TanggalKembali),i.Db(2),i.zc(t.Status),i.Db(4),i.kc("disabled",r.loadingDelete[n]),i.Db(1),i.zc(r.loadingDelete[n]?"Menghapus..":"Delete")}}function jp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"mat-card"),i.Ub(1,"mat-card-header"),i.Ub(2,"mat-card-title"),i.yc(3),i.Tb(),i.Tb(),i.Ub(4,"mat-card-content"),i.Ub(5,"div",3),i.Pb(6,"span",4),i.Ub(7,"button",5),i.bc("click",function(){return i.rc(t),i.fc().PinjamDetail({},-1)}),i.yc(8,"Tambah Peminjam"),i.Tb(),i.Tb(),i.Ub(9,"table",6),i.Ub(10,"thead"),i.Pb(11,"th"),i.Ub(12,"th"),i.yc(13,"No"),i.Tb(),i.Ub(14,"th"),i.yc(15,"ID Transaksi"),i.Tb(),i.Ub(16,"th"),i.yc(17,"ID Anggota"),i.Tb(),i.Ub(18,"th"),i.yc(19,"Nama"),i.Tb(),i.Ub(20,"th"),i.yc(21,"No Hp"),i.Tb(),i.Ub(22,"th"),i.yc(23,"Alamat"),i.Tb(),i.Ub(24,"th"),i.yc(25,"Judul Buku"),i.Tb(),i.Ub(26,"th"),i.yc(27,"Kode Buku"),i.Tb(),i.Ub(28,"th"),i.yc(29,"Tanggal Pinjam"),i.Tb(),i.Ub(30,"th"),i.yc(31,"Tanggal Kembali"),i.Tb(),i.Ub(32,"th"),i.yc(33,"Status"),i.Tb(),i.Pb(34,"th",7),i.Tb(),i.Ub(35,"tbody"),i.xc(36,xp,29,13,"tr",8),i.Tb(),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=i.fc();i.Db(3),i.zc(t.title),i.Db(33),i.kc("ngForOf",t.Pinjams)}}const Cp=[{path:"",component:p,children:[{path:"dashboard",component:y.a},{path:"product",component:kp},{path:"pinjam",component:(()=>{class t{constructor(t,e,n){this.dialog=t,this.db=e,this.auth=n,this.Pinjams=[],this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Peminjam",this.auth.user.subscribe(t=>{this.userData=t,this.getPinjams()})}getPinjams(){this.loading=!0,this.db.collection("Pinjams",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.Pinjams=t,this.loading=!1},t=>{this.loading=!1})}PinjamDetail(t,e){this.dialog.open(Np,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}DeleteProduct(t,e){confirm("Delete item?")&&this.db.collection("Pinjams/").doc(t).delete().then(t=>{this.Pinjams.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(m.b),i.Ob(vp),i.Ob(rp.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-pinjam"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"disabled","click"]],template:function(t,e){1&t&&(i.xc(0,Ap,2,0,"div",0),i.xc(1,jp,37,2,"mat-card",1)),2&t&&(i.kc("ngIf",e.loading),i.Db(1),i.kc("ngIf",!e.loading))},directives:[r.k,Ep.b,Op.a,Op.c,Op.e,Op.b,c.a,r.j],styles:[""]}),t})()},{path:"",pathMatch:"full",redirectTo:"/admiin/dashboard"}]}];let Rp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.c,a.c.forChild(Cp),g.a,Tp.f,o.b]]}),t})()}}]);